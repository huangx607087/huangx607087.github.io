

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="huangx607087">
  <meta name="keywords" content="">
  
    <meta name="description" content="huangx607087学习ECC的笔记30.About一个密码学fw的学习笔记，很菜（ 这一系列主要介绍几种ECC的加密方法，以及通过对RSA的类比，将RSA中常见的几种攻击方法应用于ECC上。 3月23日，自己进了X1c，感谢Am4师傅一路带我，自己后面要更加努力。然而自己还有6月的六级和期末考试，（我这个fw一定要过六级，期末考试一定要全过。。不过可以确定的是，自己会在暑假寻求一个突破。在9">
<meta property="og:type" content="article">
<meta property="og:title" content="ECCNotes3">
<meta property="og:url" content="http://example.com/2021/03/25/ECCNotes3/index.html">
<meta property="og:site_name" content="huangx607087&#39;s Blog">
<meta property="og:description" content="huangx607087学习ECC的笔记30.About一个密码学fw的学习笔记，很菜（ 这一系列主要介绍几种ECC的加密方法，以及通过对RSA的类比，将RSA中常见的几种攻击方法应用于ECC上。 3月23日，自己进了X1c，感谢Am4师傅一路带我，自己后面要更加努力。然而自己还有6月的六级和期末考试，（我这个fw一定要过六级，期末考试一定要全过。。不过可以确定的是，自己会在暑假寻求一个突破。在9">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-25T15:03:28.000Z">
<meta property="article:modified_time" content="2022-04-01T08:38:11.099Z">
<meta property="article:author" content="huangx607087">
<meta property="article:tag" content="Notes">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ECCNotes3 - huangx607087&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>huangx607087</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/friends/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/site/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>更新日志</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ECCNotes3"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-03-25 23:03" pubdate>
          2021/03/25 23:03:28 
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          29 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ECCNotes3</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="huangx607087学习ECC的笔记3"><a href="#huangx607087学习ECC的笔记3" class="headerlink" title="huangx607087学习ECC的笔记3"></a>huangx607087学习ECC的笔记3</h1><h2 id="0-About"><a href="#0-About" class="headerlink" title="0.About"></a>0.About</h2><p>一个密码学fw的学习笔记，很菜（</p>
<p>这一系列主要介绍几种ECC的加密方法，以及通过对RSA的类比，将RSA中常见的几种攻击方法应用于ECC上。</p>
<p>3月23日，自己进了X1c，感谢Am4师傅一路带我，自己后面要更加努力。然而自己还有6月的六级和期末考试，（我这个fw一定要过六级，期末考试一定要全过。。不过可以确定的是，自己会在暑假寻求一个突破。在9月能够成为Am4师傅那样（x</p>
<h2 id="1-椭圆曲线上的除式"><a href="#1-椭圆曲线上的除式" class="headerlink" title="1.椭圆曲线上的除式"></a>1.椭圆曲线上的除式</h2><p>在椭圆曲线$y^2=x^3+ax+b$上，我们可以定义这样的除式：<br>$$<br>F_{-1},F_0,F_1,F_2,F_3=-1,0,1,2y,3x^4+6ax^2+12bx-a^2<br>$$</p>
<p>$$<br>F_4=4y(x^6+5ax^4+20bx^3-5a^2x^2-4abx-8b^2-a^3)<br>$$</p>
<p>$$<br>F_{2i}=F_{i+2}F_{i}^3-F_{i+1}^3F_{i-1}<br>$$</p>
<p>$$<br>F_{2i+1}=\dfrac{F_i(F_{i+2}F_{i-1}^2-F_{i-2}F^2_{i+1})}{2y}<br>$$</p>
<p>顺便我们在定义一下多项式$G,H$<br>$$<br>G_{i}=xF_i^2-F_{i+1}F_{i-1}<br>$$</p>
<p>$$<br>H_i=(F_{i+2}F_{i-1}^2-F_{i-2}F^2_{i+1}) /4y<br>$$</p>
<p>所以，我们可以得到以下的式子：<br>$$<br>mP=(\dfrac{G_m(P)}{F_m^2(P)},\dfrac{H_m(P)}{F_m^3(P)})<br>$$<br>而这个式子如果想实现的话，可以调用sagemath中的<code>_multiple_x_numerator</code>,<code>_multiple_x_denominator</code>两个函数来实现对$x$坐标的数乘的多项式（最终用$x$表示）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">E=EllipticCurve(GF(<span class="hljs-number">10007</span>),[<span class="hljs-number">5362</span>,<span class="hljs-number">7045</span>])<br>Fz=E._multiple_x_numerator(<span class="hljs-number">7</span>)<br>Fz<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">x^49 + 9573*x^47 + 1673*x^46 + 9230*x^45 + 7088*x^44 + 2559*x^43 + 1491*x^42 + 1730*x^41 + 1886*x^40 + 8655*x^39 + 9529*x^38 + 2785*x^37 + 3587*x^36 + 3847*x^35 + 3439*x^34 + 1171*x^33 + 7340*x^32 + 2033*x^31 + 5346*x^30 + 3021*x^29 + 6843*x^28 + 1123*x^27 + 6261*x^26 + 4150*x^25 + 5110*x^24 + 9659*x^23 + 8409*x^22 + 6218*x^21 + 1501*x^20 + 4233*x^19 + 4240*x^18 + 5172*x^17 + 2625*x^16 + 1767*x^15 + 5499*x^14 + 7768*x^13 + 308*x^12 + 1527*x^11 + 2631*x^10 + 6193*x^9 + 6584*x^8 + 9405*x^7 + 1509*x^6 + 7683*x^5 + 3994*x^4 + 8777*x^3 + 2600*x^2 + 3465*x + 993</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>经过数据的观察可以看出，$mP$中$x$坐标的分子表达式次数总是$m^2$，分母次数总是$m^2-1$，这也印证了之前<strong>笔记1</strong>中提到的$\ln u$正比于$m^2$的结论。</p>
<p>一般情况下，对椭圆曲线上的点加密的时候，我们可以选择横坐标$x$，然后在椭圆曲线上找点。</p>
<p>我们可以选取一个整数$k$，明文$m$，我们可以计算$m^3+am+b$是否是模$q$的二次剩余。如果是的话，直接对结果开平方即可（见我之前数论笔记）。如果不是的话，我们计算$m+1$，直到找到符合的$m$值。根据二次剩余的分布可知，我们找不到的期望值为$\dfrac 1 {2^k}$。</p>
<h2 id="2-几种ECC加密算法"><a href="#2-几种ECC加密算法" class="headerlink" title="2.几种ECC加密算法"></a>2.几种ECC加密算法</h2><p>之前我们讲过DH密钥交换和Elgamal加密系统，这里我们多介绍几个基于ECC的加密系统。</p>
<h3 id="0x01-Demytko加密"><a href="#0x01-Demytko加密" class="headerlink" title="0x01 Demytko加密"></a>0x01 Demytko加密</h3><h4 id="1-加密"><a href="#1-加密" class="headerlink" title="1.加密"></a>1.加密</h4><p>寻找两个大素数$p,q$，然后计算$n=pq$。然后确定椭圆曲线的系数$a,b$，并保证$\gcd(4a^3+27b^2,n)=1$。</p>
<p>然后我们计算$N_1,N_2,N_3,N_4=|E_p|,2p+2-N_1,|E_q|,2q+2-N_3$。 由于自己博客中某些符号无法打出来，因此我们借用符号$|D|$表示集合$D$中的元素个数而不是我打不出来的那个符号<del>（因为打那个符号博客处理时会出严重问题导致markdown混乱</del></p>
<p>接着选取$e$保证$\gcd(e,N_i)=1$即可。其中$i$为$1$到$4$。同时计算$d_1,d_2,d_3,d_4$分别为$e$在模$\dfrac{N_1N_3}{\gcd(N_1N_3)},\dfrac{N_1N_4}{\gcd(N_1N_4)},\dfrac{N_2N_3}{\gcd(N_2N_3)},\dfrac{N_2N_4}{\gcd(N_2N_4)}$下的逆元。</p>
<p>计算出这些数值之后，我们把$n,e,u$作为公钥，$p,q,d_1,d_2,d_3,d_4$作为私钥。</p>
<p>加密时，选取点$P$满足其横坐标为$m$，然后计算$c=(eP)_x$。</p>
<h4 id="2-解密"><a href="#2-解密" class="headerlink" title="2.解密"></a>2.解密</h4><p>解密方计算$w=c^3+ac+b$，然后在$d_1$到$d_4$中选择一个这样的私钥用于解密，方法如下。为与分数的出发区分开，以下用$\mathrm{lgd}(\dfrac{a}{b})$来表示$a$是否是$b$的二次剩余，若是值为$1$，不是的话值为$-1$。相关内容可见<strong>0xGame Div 4</strong>。</p>
<table>
<thead>
<tr>
<th align="center">$\mathrm{lgd}(\dfrac{w}{p})$</th>
<th align="center">$\mathrm{lgd}(\dfrac{w}{q})$</th>
<th align="center">选取私钥$d$</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$1$</td>
<td align="center">$1$</td>
<td align="center">$d_1$</td>
</tr>
<tr>
<td align="center">$1$</td>
<td align="center">$-1$</td>
<td align="center">$d_2$</td>
</tr>
<tr>
<td align="center">$-1$</td>
<td align="center">$1$</td>
<td align="center">$d_3$</td>
</tr>
<tr>
<td align="center">$-1$</td>
<td align="center">$-1$</td>
<td align="center">$d_4$</td>
</tr>
</tbody></table>
<p>然后选取点$Q$使得其横坐标为$c^3+ac+b$，然后计算$dQ$即可，其横坐标就是$m$。</p>
<p>为了快速地算出$|E_p|,|E_q|$，我们可以选取$p\equiv q\equiv 2 \pmod 3$且$a=0$或者$p\equiv q\equiv 3 \pmod 4$且$a=0$，那么$|E_p|=p+1,|E_q|=q+1$。</p>
<h3 id="0x02-KMOV算法"><a href="#0x02-KMOV算法" class="headerlink" title="0x02 KMOV算法"></a>0x02 KMOV算法</h3><h4 id="1-加密-1"><a href="#1-加密-1" class="headerlink" title="1.加密"></a>1.加密</h4><p>寻找两个大素数$p,q$，然后计算$n=pq$。然后确定椭圆曲线的系数$a,b$，并保证$\gcd(4a^3+27b^2,n)=1$。</p>
<p>然后计算$N_1,N_2=|E_p|,|E_q|$。并选择$e$使得$\gcd(e,N_1)=\gcd(e,N_2)=1$。同时计算$d$是$e$模$\dfrac{N_1N_2}{\gcd{N_1N_2}}$的逆元。</p>
<p>其中公钥为$n,e,a,b$，私钥为$p,q,d$。</p>
<p>加密时，直接计算$C=eP$的值即可。</p>
<h4 id="2-解密-1"><a href="#2-解密-1" class="headerlink" title="2.解密"></a>2.解密</h4><p>直接计算$dC=P$。</p>
<p>然而，这个加密算法有一个比较大的缺点，就是除非使用了特殊的曲线和特殊的素数，不然计算$|E_p|,|E_q|$式一件非常难的事情。因此，1991年有人对这个系统进行了改进，给出了KMOV91。</p>
<h4 id="3-KMOV91"><a href="#3-KMOV91" class="headerlink" title="3.KMOV91"></a>3.KMOV91</h4><p>在KMOV91中，直接选取$p\equiv q\equiv 2 \pmod 3$，使得$N_1,N_2=p+1,q+1$。其中$n,e$为公钥，$p,q,d$为私钥。而使用椭圆曲线$y^2=x^3+b,b=P_y^2-P_x^3$。最后保证$P_x^3 \not \equiv  P_y^2 \pmod n$即可进行加密。其他过程与原来一样。</p>
<h2 id="3-近期CTF中基于椭圆曲线的攻击方法"><a href="#3-近期CTF中基于椭圆曲线的攻击方法" class="headerlink" title="3.近期CTF中基于椭圆曲线的攻击方法"></a>3.近期CTF中基于椭圆曲线的攻击方法</h2><h3 id="1-ECC低指数广播攻击-NepCTF-lowExpoent"><a href="#1-ECC低指数广播攻击-NepCTF-lowExpoent" class="headerlink" title="1. ECC低指数广播攻击 NepCTF lowExpoent"></a>1. ECC低指数广播攻击 NepCTF lowExpoent</h3><h4 id="0o01-分析题目"><a href="#0o01-分析题目" class="headerlink" title="0o01.分析题目"></a>0o01.分析题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sagemath</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Encrypt</span>(<span class="hljs-params">e, nbits, msg</span>):<br>    p, q = [getPrime(<span class="hljs-built_in">int</span>(nbits)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br>    N = p*q<br>    x = <span class="hljs-built_in">int</span>(msg)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        a, b = [getRandomRange(<span class="hljs-number">1</span>, N) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br>        P.&lt;Yp&gt; = PolynomialRing(Zmod(p))<br>        fp = x^<span class="hljs-number">3</span> + a*x + b - Yp^<span class="hljs-number">2</span><br>        P.&lt;Yq&gt; = PolynomialRing(Zmod(q))<br>        fq = x^<span class="hljs-number">3</span> + a*x + b - Yq^<span class="hljs-number">2</span><br>        <span class="hljs-keyword">try</span>:<br>            yp, yq = <span class="hljs-built_in">int</span>(fp.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]), <span class="hljs-built_in">int</span>(fq.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br>            y = crt([yp, yq], [p, q])<br>            E = EllipticCurve(IntegerModRing(N), [a, b])<br>            msg_point = E.point((x, y))<br>            Ep = EllipticCurve(IntegerModRing(p), [a, b])<br>            Eq = EllipticCurve(IntegerModRing(q), [a, b])<br>            N1 = Ep.order()<br>            N2 = <span class="hljs-number">2</span>*p+<span class="hljs-number">2</span>-N1<br>            N3 = Eq.order()<br>            N4 = <span class="hljs-number">2</span>*q+<span class="hljs-number">2</span>-N3<br>            d = &#123;<br>                ( <span class="hljs-number">1</span>, <span class="hljs-number">1</span>): inverse_mod(e, lcm(N1, N3)),<br>                ( <span class="hljs-number">1</span>,-<span class="hljs-number">1</span>): inverse_mod(e, lcm(N1, N4)),<br>                (-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>): inverse_mod(e, lcm(N2, N3)),<br>                (-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>): inverse_mod(e, lcm(N2, N4))<br>            &#125;<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>    cip_point = e*msg_point<br>    ciphertext = cip_point.xy()[<span class="hljs-number">0</span>]<br>    privKey = (d, p, q)<br>    pubKey = (a, b, N)<br>    <span class="hljs-keyword">return</span> (ciphertext, pubKey, privKey)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Decrypt</span>(<span class="hljs-params">ciphertext, pubKey, privKey</span>):<br>    d, p, q = privKey<br>    a, b, N = pubKey<br>    x = ciphertext<br>    w = x^<span class="hljs-number">3</span> + a*x + b % N<br>    P.&lt;Yp&gt; = PolynomialRing(Zmod(p))<br>    fp = x^<span class="hljs-number">3</span> + a*x + b -Yp^<span class="hljs-number">2</span><br>    yp = fp.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    P.&lt;Yq&gt; = PolynomialRing(Zmod(q))<br>    fq = x^<span class="hljs-number">3</span> + a*x + b -Yq^<span class="hljs-number">2</span><br>    yq = fq.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    y = crt([<span class="hljs-built_in">int</span>(yp), <span class="hljs-built_in">int</span>(yq)], [p, q])<br>    E = EllipticCurve(IntegerModRing(N), [a, b])<br>    cip_point = E.point([x, y])<br>    legendre_symbol_p = legendre_symbol(w, p)<br>    legendre_symbol_q = legendre_symbol(w, q)<br>    msg_point = d[(legendre_symbol_p, legendre_symbol_q)]*cip_point<br>    <span class="hljs-keyword">return</span> msg_point.xy()[<span class="hljs-number">0</span>]<br>msg = bytes_to_long(flag)<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>):<br>    current_st = time()<br>    cipher = Encrypt(<span class="hljs-number">3</span>, <span class="hljs-number">256</span>, msg)<br>    f.writelines(<span class="hljs-string">&quot;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(cipher[<span class="hljs-number">0</span>],*cipher[<span class="hljs-number">1</span>]))<br>f.close()<br></code></pre></td></tr></table></figure>

<p>然后题目最终给出了$70$组不同的$(c,a,b,n)$的四元组，均为对同一明文$x$的加密。</p>
<p>那么这道题，我们可以首先构造关于$x$的多项式。我们刚才看到了，$F_3(x)=3x^4+6ax^2+12bx-a^2$，那么我们可以得到分子的值和分母的值<br>$$<br>G=x(3x^4+6ax^2+12bx-a^2)^2-8(x^3+ax+b)(x^6+5ax^4+20bx^3-5ax^2-4ab-8b^2-a^3)<br>$$</p>
<p>$$<br>F^2=(3x^4+6ax^2+12bx-a)^2<br>$$</p>
<p>然后我们由$c\equiv\dfrac G {F^2} \pmod n$，那么有$G-cF^2\equiv 0 \pmod n$。由于$F^2$是八次式，$G$是九次式，因此我们可以构造出$70$个九次式（不过最好保证构造出来的$G$均为<code>monic</code>，也就是最高次项九次项为$1$。</p>
<p>然后，我们继续类比RSA中低指数广播攻击的方法，可以分别对常数项到九次项分别进行中国剩余定理，并将所有的模数相乘，得到一个所有的系数都很大的一个多项式。（当然九次项系数还是$1$）。然后我们可以看到，这个$N=\prod_{i=1}^{70} n$，由于$n$的比特数大概是$512$，也就是$\ln n=355$，那么$\ln N=24842$，而我们需要密文的规模不超过$\ln m=355$。次数为$9$次式，因此根据Copeersmith定理：只要$\ln x&lt;2760 $，就可以求出这个式子的一个根。很显然$m$的值是符合条件的。</p>
<p>因此这个过程就转化成了求多项式的小根，直接用<code>small_roots</code>就可以解出来了。不过Sagemath中的这些命令也并不是特别好用的<del>我还是调程序调了半天</del>。因此建议通过LLL算法手写一个求多项式小根的脚本。。。。。。</p>
<h4 id="0o02-自己的exp"><a href="#0o02-自己的exp" class="headerlink" title="0o02.自己的exp"></a>0o02.自己的exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sagemath</span><br>c=[]<br>a=[]<br>b=[]<br>n=[]<br>Fzlist=[]<br>Fmlist=[]<br>Dlist=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>):<br>    R.&lt;x&gt;=PolynomialRing(Zmod(n[i]))<br>    Fz=x*(<span class="hljs-number">3</span>*x^<span class="hljs-number">4</span>+<span class="hljs-number">6</span>*a[i]*x^<span class="hljs-number">2</span>+<span class="hljs-number">12</span>*b[i]*x-a[i]^<span class="hljs-number">2</span>)^<span class="hljs-number">2</span>-<span class="hljs-number">8</span>*(x^<span class="hljs-number">3</span>+a[i]*x+b[i])*(x^<span class="hljs-number">6</span>+<span class="hljs-number">5</span>*a[i]*x^<span class="hljs-number">4</span>+<span class="hljs-number">20</span>*b[i]*x^<span class="hljs-number">3</span>-<span class="hljs-number">5</span>*a[i]^<span class="hljs-number">2</span>*x^<span class="hljs-number">2</span>-<span class="hljs-number">4</span>*a[i]*b[i]*x-<span class="hljs-number">8</span>*b[i]^<span class="hljs-number">2</span>-a[i]^<span class="hljs-number">3</span>)<br>    Fm=(<span class="hljs-number">3</span>*x^<span class="hljs-number">4</span>+<span class="hljs-number">6</span>*a[i]*x^<span class="hljs-number">2</span>+<span class="hljs-number">12</span>*b[i]*x-a[i]^<span class="hljs-number">2</span>)^<span class="hljs-number">2</span><br>    Fzlist.append(Fz)<br>    Fmlist.append(Fm*c[i])<br>    Dlist.append(Fz-c[i]*Fm)<br>Crtlist=[[<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>)] <span class="hljs-keyword">for</span> __ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        Crtlist[j][i]=ZZ(Dlist[i][j])<br>A=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    A.append(CRT(Crtlist[i],n))<br>N=<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> n:<br>    N*=i<br>O.&lt;y&gt;=PolynomialRing(Zmod(N))<br>S=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    S+=A[i]*y^i<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finding Roots&#x27;</span>)<br>oo,oooo,ooooo=<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><br>S.small_roots(epsilon=<span class="hljs-number">1</span>/<span class="hljs-number">16</span>)<br>[<span class="hljs-number">3088969433059681806521206959873975785377227976800172674306727155831805513908352148702210247662586117242206183337522557</span>]<br></code></pre></td></tr></table></figure>

<h4 id="0o03-出题人Am4的官方wp"><a href="#0o03-出题人Am4的官方wp" class="headerlink" title="0o03 出题人Am4的官方wp"></a>0o03 出题人Am4的官方wp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>)<br>ciphertext = []<br>a, b, n = [], [], []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>):<br>ci, ai, bi, ni = [<span class="hljs-built_in">int</span>(num) <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> f.readline().strip().split(<span class="hljs-string">&quot;, &quot;</span>)]<br>ciphertext.append(ci)<br>a.append(ai)<br>b.append(bi)<br>n.append(ni)<br>e = <span class="hljs-number">3</span><br>deg = <span class="hljs-number">9</span><br>coeffi = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>):<br>E = EllipticCurve(IntegerModRing(n[i]), [a[i], b[i]])<br>P.&lt;m&gt; = PolynomialRing(Zmod(n[i]))<br>f = ciphertext[i]*E._multiple_x_denominator(e, m) -<br>E._multiple_x_numerator(e, m)<br>coeffi.append(f.coefficients(sparse=<span class="hljs-literal">False</span>))<br>large_coeffi = [crt([<span class="hljs-built_in">int</span>(coeffi[j][i]) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>)], [n[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span><br><span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>)]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg+<span class="hljs-number">1</span>)]<br>N_bitlength = <span class="hljs-built_in">sum</span>([n[i].bit_length() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">70</span>)])<br>min_n = <span class="hljs-built_in">min</span>(n)<br>N = reduce(<span class="hljs-keyword">lambda</span> x, y: x*y, n)<br>Sc = large_coeffivar(<span class="hljs-string">&quot;x&quot;</span>)<br>assume(x, <span class="hljs-string">&#x27;integer&#x27;</span>)<br>f =<br>Sc[<span class="hljs-number">9</span>]*x^<span class="hljs-number">9</span>+Sc[<span class="hljs-number">8</span>]*x^<span class="hljs-number">8</span>+Sc[<span class="hljs-number">7</span>]*x^<span class="hljs-number">7</span>+Sc[<span class="hljs-number">6</span>]*x^<span class="hljs-number">6</span>+Sc[<span class="hljs-number">5</span>]*x^<span class="hljs-number">5</span>+Sc[<span class="hljs-number">4</span>]*x^<span class="hljs-number">4</span>+Sc[<span class="hljs-number">3</span>]*x^<span class="hljs-number">3</span>+Sc[<span class="hljs-number">2</span>]*x^<span class="hljs-number">2</span><br>+Sc[<span class="hljs-number">1</span>]*x+Sc[<span class="hljs-number">0</span>]<br>lat = []<br>lat.append([large_coeffi[i]*min_n**i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg+<span class="hljs-number">1</span>)]+[<span class="hljs-number">1</span>/(deg+<span class="hljs-number">1</span>)])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg+<span class="hljs-number">1</span>):<br>lat.append([((min_n**j)*N <span class="hljs-keyword">if</span> (i==j) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg+<span class="hljs-number">1</span>)]+[<span class="hljs-number">0</span>])<br>Mat = matrix(lat)<br>Mat_LLL = Mat.LLL()<br><span class="hljs-keyword">for</span> lin <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg):<br>Sc = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> Mat_LLL[lin]]<br>Sc = [(Sc[i]//(min_n**i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deg+<span class="hljs-number">1</span>)]<br>var(<span class="hljs-string">&quot;x&quot;</span>)<br>assume(x, <span class="hljs-string">&#x27;integer&#x27;</span>)<br>f =<br>Sc[<span class="hljs-number">9</span>]*x^<span class="hljs-number">9</span>+Sc[<span class="hljs-number">8</span>]*x^<span class="hljs-number">8</span>+Sc[<span class="hljs-number">7</span>]*x^<span class="hljs-number">7</span>+Sc[<span class="hljs-number">6</span>]*x^<span class="hljs-number">6</span>+Sc[<span class="hljs-number">5</span>]*x^<span class="hljs-number">5</span>+Sc[<span class="hljs-number">4</span>]*x^<span class="hljs-number">4</span>+Sc[<span class="hljs-number">3</span>]*x^<span class="hljs-number">3</span>+Sc[<span class="hljs-number">2</span>]*x^<span class="hljs-number">2</span><br>+Sc[<span class="hljs-number">1</span>]*x+Sc[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(factor(f))<br><span class="hljs-keyword">break</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">m =</span><br><span class="hljs-string">3088969433059681806521206959873975785377227976800172674306727155831805513908352</span><br><span class="hljs-string">148702210247662586117242206183337522557</span><br><span class="hljs-string">print(long_to_bytes(m))</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br></code></pre></td></tr></table></figure>

<h3 id="2-ECC上的相关明文攻击"><a href="#2-ECC上的相关明文攻击" class="headerlink" title="2.ECC上的相关明文攻击"></a>2.ECC上的相关明文攻击</h3><h4 id="0o01-分析题目-1"><a href="#0o01-分析题目-1" class="headerlink" title="0o01 分析题目"></a>0o01 分析题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sagemath</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long, long_to_bytes, getPrime, getRandomRange<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br>flag = bytes_to_long(flag)<br>p, q = [getPrime(<span class="hljs-built_in">int</span>(<span class="hljs-number">256</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br>a, b = [getRandomRange(<span class="hljs-number">1</span>, p*q) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, a, b, p, q, e</span>):<br>        <span class="hljs-variable language_">self</span>.p, <span class="hljs-variable language_">self</span>.q = p, q<br>        <span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b = a, b<br>        <span class="hljs-variable language_">self</span>.N = <span class="hljs-variable language_">self</span>.p*<span class="hljs-variable language_">self</span>.q<br>        <span class="hljs-variable language_">self</span>.e = e<br>        <span class="hljs-variable language_">self</span>.Kbits = <span class="hljs-number">8</span><br>        Ep = EllipticCurve(IntegerModRing(<span class="hljs-variable language_">self</span>.p), [<span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b])<br>        Eq = EllipticCurve(IntegerModRing(<span class="hljs-variable language_">self</span>.q), [<span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b])<br>        N1 = Ep.order()<br>        N2 = <span class="hljs-number">2</span>*<span class="hljs-variable language_">self</span>.p+<span class="hljs-number">2</span>-N1<br>        N3 = Eq.order()<br>        N4 = <span class="hljs-number">2</span>*<span class="hljs-variable language_">self</span>.q+<span class="hljs-number">2</span>-N3<br>        <span class="hljs-variable language_">self</span>.d = &#123;<br>            ( <span class="hljs-number">1</span>, <span class="hljs-number">1</span>): inverse_mod(<span class="hljs-variable language_">self</span>.e, lcm(N1, N3)),<br>            ( <span class="hljs-number">1</span>,-<span class="hljs-number">1</span>): inverse_mod(<span class="hljs-variable language_">self</span>.e, lcm(N1, N4)),<br>            (-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>): inverse_mod(<span class="hljs-variable language_">self</span>.e, lcm(N2, N3)),<br>            (-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>): inverse_mod(<span class="hljs-variable language_">self</span>.e, lcm(N2, N4))<br>        &#125;<br>        <span class="hljs-variable language_">self</span>.E = EllipticCurve(IntegerModRing(<span class="hljs-variable language_">self</span>.N), [<span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Enc</span>(<span class="hljs-params">self, plaintext</span>):<br>        <span class="hljs-keyword">try</span>:<br>            msg_point = <span class="hljs-variable language_">self</span>.msg_to_point(plaintext)<br>            cip_point = <span class="hljs-variable language_">self</span>.e*msg_point<br>            <span class="hljs-keyword">return</span> cip_point.xy()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Dec</span>(<span class="hljs-params">self, ciphertext</span>):<br>        x = ciphertext<br>        w = x^<span class="hljs-number">3</span> + <span class="hljs-variable language_">self</span>.a*x + <span class="hljs-variable language_">self</span>.b % <span class="hljs-variable language_">self</span>.N<br>        P.&lt;Yp&gt; = PolynomialRing(Zmod(<span class="hljs-variable language_">self</span>.p))<br>        fp = x^<span class="hljs-number">3</span> + <span class="hljs-variable language_">self</span>.a*x + <span class="hljs-variable language_">self</span>.b -Yp^<span class="hljs-number">2</span><br>        yp = fp.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>        P.&lt;Yq&gt; = PolynomialRing(Zmod(<span class="hljs-variable language_">self</span>.q))<br>        fq = x^<span class="hljs-number">3</span> + <span class="hljs-variable language_">self</span>.a*x + <span class="hljs-variable language_">self</span>.b -Yq^<span class="hljs-number">2</span><br>        yq = fq.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>        y = crt([<span class="hljs-built_in">int</span>(yp), <span class="hljs-built_in">int</span>(yq)], [<span class="hljs-variable language_">self</span>.p, <span class="hljs-variable language_">self</span>.q])<br>        cip_point = <span class="hljs-variable language_">self</span>.E.point([x, y])<br>        legendre_symbol_p = legendre_symbol(w, <span class="hljs-variable language_">self</span>.p)<br>        legendre_symbol_q = legendre_symbol(w, <span class="hljs-variable language_">self</span>.q)<br>        msg_point = <span class="hljs-variable language_">self</span>.d[(legendre_symbol_p, legendre_symbol_q)]*cip_point<br>        <span class="hljs-keyword">return</span> msg_point.xy()[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-variable language_">self</span>.Kbits<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">msg_to_point</span>(<span class="hljs-params">self, x, shift=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-keyword">if</span> shift:<br>            x &lt;&lt;= <span class="hljs-variable language_">self</span>.Kbits<br>        checkPoint = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>&lt;&lt;<span class="hljs-variable language_">self</span>.Kbits):<br>            P.&lt;Yp&gt; = PolynomialRing(Zmod(<span class="hljs-variable language_">self</span>.p))<br>            fp = x^<span class="hljs-number">3</span> + <span class="hljs-variable language_">self</span>.a*x + <span class="hljs-variable language_">self</span>.b - Yp^<span class="hljs-number">2</span><br>            P.&lt;Yq&gt; = PolynomialRing(Zmod(<span class="hljs-variable language_">self</span>.q))<br>            fq = x^<span class="hljs-number">3</span> + <span class="hljs-variable language_">self</span>.a*x + <span class="hljs-variable language_">self</span>.b - Yq^<span class="hljs-number">2</span><br>            <span class="hljs-keyword">try</span>:<br>                yp, yq = <span class="hljs-built_in">int</span>(fp.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]), <span class="hljs-built_in">int</span>(fq.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br>                y = crt([yp, yq], [<span class="hljs-variable language_">self</span>.p, <span class="hljs-variable language_">self</span>.q])<br>                E = EllipticCurve(IntegerModRing(<span class="hljs-variable language_">self</span>.p*<span class="hljs-variable language_">self</span>.q), [<span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b])<br>                checkPoint = E.point((x, y))<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span>:<br>                x += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> checkPoint<br>delta = <span class="hljs-number">28552609273</span><br>e = <span class="hljs-number">137</span><br>cip = Task(a, b, p, q, e)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;a = <span class="hljs-subst">&#123;a&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;b = <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n = <span class="hljs-subst">&#123;p*q&#125;</span>&quot;</span>)<br>plaintext1 = cip.msg_to_point(flag, shift=<span class="hljs-literal">True</span>).xy()[<span class="hljs-number">0</span>]<br>ciphertext1 = cip.Enc(plaintext1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ciphertext1 = <span class="hljs-subst">&#123;ciphertext1&#125;</span>&quot;</span>)<br>plaintext2 = cip.msg_to_point(flag+delta, shift=<span class="hljs-literal">True</span>).xy()[<span class="hljs-number">0</span>]<br>ciphertext2 = cip.Enc(plaintext2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ciphertext2 = <span class="hljs-subst">&#123;ciphertext2&#125;</span>&quot;</span>)<br>delta = plaintext2 - plaintext1<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;delta = <span class="hljs-subst">&#123;delta&#125;</span>&quot;</span>)<br><span class="hljs-comment"># a = 4281014323581546488462714122303747203636223358897123235803046898862939653328802115362584316327572195541081125920528501180620492421895128401613948866529122</span><br><span class="hljs-comment"># b = 1504110610934153564757355169781343270879282969971532470271782059859117769089994716068562704547770368420258743734175281689611986131092394954948339191589449</span><br><span class="hljs-comment"># n = 6638798722521613809421411597209101115203859862340555482590990067056543831415553727351714220257486793657912537305448979625073630917241320204281256125412671</span><br><span class="hljs-comment"># ciphertext1 = 6327639450575093157999054915625304951894564605402541939450801256931875815282143921161475586010526883609974743159835451980804875847625527741681757415519394</span><br><span class="hljs-comment"># ciphertext2 = 3275348139763310265438126795688591830796510682708632201044899744259822398076574133105844638686347122066389056025294466297206704146167073441486603569471235</span><br><span class="hljs-comment"># delta = 7309467973885</span><br></code></pre></td></tr></table></figure>

<p>很显然，这道题给出了$m$的明文和$m+d$的明文，加密指数为$137$，那么我们就可以用我们刚才提到的函数构造出多项式，然后求多项式的GCD来确定最后的根。</p>
<p>不过整个代码的实现还是挺困难的，因为里面的微操很多，比如要把求出来的多项式先转成list再转回多项式。不然程序运行会出现错误。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sagemath</span><br>a = <span class="hljs-number">4281014323581546488462714122303747203636223358897123235803046898862939653328802115362584316327572195541081125920528501180620492421895128401613948866529122</span><br>b = <span class="hljs-number">1504110610934153564757355169781343270879282969971532470271782059859117769089994716068562704547770368420258743734175281689611986131092394954948339191589449</span><br>n = <span class="hljs-number">6638798722521613809421411597209101115203859862340555482590990067056543831415553727351714220257486793657912537305448979625073630917241320204281256125412671</span><br>c1= <span class="hljs-number">6327639450575093157999054915625304951894564605402541939450801256931875815282143921161475586010526883609974743159835451980804875847625527741681757415519394</span><br>c2= <span class="hljs-number">3275348139763310265438126795688591830796510682708632201044899744259822398076574133105844638686347122066389056025294466297206704146167073441486603569471235</span><br>d = <span class="hljs-number">7309467973885</span><br>E=EllipticCurve(Zmod(n),[a,b])<br>Fz=E._multiple_x_numerator(<span class="hljs-number">137</span>)<br>Fm=E._multiple_x_denominator(<span class="hljs-number">137</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Proof Work Finished&#x27;</span>)<br>Fmlist=<span class="hljs-built_in">list</span>(Fm)<br>Fzlist=<span class="hljs-built_in">list</span>(Fz)<br>R.&lt;t&gt;=PolynomialRing(Zmod(n))<br>Fm1,Fm2,Fz1,Fz2=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Fmlist)):<br>    Fm1+=Fmlist[i]*(t^i)<br>    Fm2+=Fmlist[i]*((t+d)^i)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Fzlist)):<br>    Fz1+=Fzlist[i]*(t^i)<br>    Fz2+=Fzlist[i]*((t+d)^i)<br>G1,G2=c1*Fm1-Fz1,c2*Fm2-Fz2<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcdpro</span>(<span class="hljs-params">g1, g2</span>):<br>    <span class="hljs-keyword">while</span> g2:<br>        g1, g2 = g2, g1 % g2<br>    <span class="hljs-keyword">return</span> g1.monic()<br>    <span class="hljs-comment">#return -gcdpro(g1, g2)[0]</span><br>H=(gcdpro(G1,G2))<br><span class="hljs-built_in">print</span>(H)<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(long_to_bytes(n-H[<span class="hljs-number">0</span>]))<br><span class="hljs-comment">#b&#x27;DASCTF&#123;692d49f84fe5497fa05d6e91a1cf4e3e&#125;\x04&#x27;</span><br></code></pre></td></tr></table></figure>

<p>当然，ECC中也可以通过使用共模攻击和RSA中的Coppersmith来出题。可以预测的是，到目前为止，CTF中ECC的题目的数量并不是特别多。这就。】说明了ECC有可能会成为后面CTF的一个出题热门点。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTFSeason2/" class="category-chain-item">CTFSeason2</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Notes/" class="print-no-link">#Notes</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ECCNotes3</div>
      <div>http://example.com/2021/03/25/ECCNotes3/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>huangx607087</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年3月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/04/09/VNCTF-WriteUp/" title="VNCTF WriteUp">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">VNCTF WriteUp</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/03/04/ECCNotes2/" title="ECCNotes2">
                        <span class="hidden-mobile">ECCNotes2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
