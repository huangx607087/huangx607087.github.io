

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="huangx607087">
  <meta name="keywords" content="">
  
    <meta name="description" content="huangx607087 5月的切题0.Intruduction之前4月准备更新2篇博客的，不过自己因为准备六级所以只能在4月9日写了一篇博客就结束了（。5月份虽然还是紧张地备考，自己还是抽出来了一点点时间来打打CTF。简单做了一些题目。。这个时候距离六级也就剩20几天了。六月份还有期末考试。可以说这个是自己第二阶段CTF的学学习的最后一篇文章。等7月7日的暑假，自己CTF进入第三阶段，到时候争取">
<meta property="og:type" content="article">
<meta property="og:title" content="21May1">
<meta property="og:url" content="http://example.com/2021/05/17/21May1/index.html">
<meta property="og:site_name" content="huangx607087&#39;s Blog">
<meta property="og:description" content="huangx607087 5月的切题0.Intruduction之前4月准备更新2篇博客的，不过自己因为准备六级所以只能在4月9日写了一篇博客就结束了（。5月份虽然还是紧张地备考，自己还是抽出来了一点点时间来打打CTF。简单做了一些题目。。这个时候距离六级也就剩20几天了。六月份还有期末考试。可以说这个是自己第二阶段CTF的学学习的最后一篇文章。等7月7日的暑假，自己CTF进入第三阶段，到时候争取">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/05/17/21May1/201.png">
<meta property="og:image" content="http://example.com/2021/05/17/21May1/202.png">
<meta property="og:image" content="http://example.com/2021/05/17/21May1/1.jpg">
<meta property="article:published_time" content="2021-05-17T14:47:58.000Z">
<meta property="article:modified_time" content="2024-11-08T06:09:53.399Z">
<meta property="article:author" content="huangx607087">
<meta property="article:tag" content="ExpLog">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2021/05/17/21May1/201.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>21May1 - huangx607087&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>huangx607087</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/friends/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/site/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>更新日志</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="21May1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-05-17 22:47" pubdate>
          2021/05/17 22:47:58 
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          47 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">21May1</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="huangx607087-5月的切题"><a href="#huangx607087-5月的切题" class="headerlink" title="huangx607087 5月的切题"></a>huangx607087 5月的切题</h1><h2 id="0-Intruduction"><a href="#0-Intruduction" class="headerlink" title="0.Intruduction"></a>0.Intruduction</h2><p>之前4月准备更新2篇博客的，不过自己因为准备六级所以只能在4月9日写了一篇博客就结束了（。5月份虽然还是紧张地备考，自己还是抽出来了一点点时间来打打CTF。简单做了一些题目。。这个时候距离六级也就剩20几天了。六月份还有期末考试。可以说这个是自己第二阶段CTF的学学习的最后一篇文章。等7月7日的暑假，自己CTF进入第三阶段，到时候争取能跟寒假一样有个突破，然后9月说不定能<del>进线下很显然这是不可能的，被Nu1L大佬压制，注定只有在X1c中摸鱼的份了</del>。</p>
<p><del>5月15日，ciscn做出了三道密码题，1200分，死而无憾</del>（ciscnRSA那道题过于简单，故博客中不放这道题的wp）</p>
<p>本博客常用符号：$|E|$表示集合$E$内元素的个数，或者椭圆曲线上的点数。$\dfrac{\ln}{\ln 2}$表示某个数字的比特位数，$\dfrac{\ln}{\ln 10}$表示十进制位数，$\mathrm{int}(x)$表示向下取整，$\mathrm{int}(x+0.5)$表示四舍五入</p>
<h2 id="1-CISCN-2021-imageencrypt"><a href="#1-CISCN-2021-imageencrypt" class="headerlink" title="1.[CISCN 2021]imageencrypt"></a>1.[CISCN 2021]imageencrypt</h2><p>这道题是一个对一张图片的加密（实际上是对一个数组的加密），题目给出了加密代码、附加明文和附加密文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Chall.py</span><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag,image,r,key1,key2<br><span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">assert</span>(flag[:<span class="hljs-number">5</span>]==<span class="hljs-string">&#x27;CISCN&#x27;</span>)<br><span class="hljs-keyword">assert</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(r))==<span class="hljs-number">3</span>)<br>data = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">chr</span>,image))<br><span class="hljs-keyword">assert</span>(flag[<span class="hljs-number">6</span>:-<span class="hljs-number">1</span>] == md5.new(data).hexdigest())<br><span class="hljs-keyword">assert</span>(key1&lt;<span class="hljs-number">256</span>)<br><span class="hljs-keyword">assert</span>(key2&lt;<span class="hljs-number">256</span>)<br>x0 = random.random()<br>x0 = <span class="hljs-built_in">round</span>(x0,<span class="hljs-number">6</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(r*x*(<span class="hljs-number">3</span>-x),<span class="hljs-number">6</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">pixel,key1,key2,x0,m,n</span>):<br>    num = m*n/<span class="hljs-number">8</span>    <br>    seqs = []<br>    x = x0<br>    bins = <span class="hljs-string">&#x27;&#x27;</span><br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num):<br>        x = generate(x)<br>        tmp.append(x)<br>        seqs.append(<span class="hljs-built_in">int</span>(x*<span class="hljs-number">22000</span>))<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> seqs:<br>        bin_x  = <span class="hljs-built_in">bin</span>(x)[<span class="hljs-number">2</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bin_x) &lt; <span class="hljs-number">16</span>:<br>            bin_x = <span class="hljs-string">&#x27;0&#x27;</span>*(<span class="hljs-number">16</span>-<span class="hljs-built_in">len</span>(bin_x))+bin_x<br>        bins += bin_x<br>    <span class="hljs-keyword">assert</span>(<span class="hljs-built_in">len</span>(pixel) == m*n)<br>    cipher = [ <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            index = n*i+j<br>            ch = <span class="hljs-built_in">int</span>(bins[<span class="hljs-number">2</span>*index:<span class="hljs-number">2</span>*index+<span class="hljs-number">2</span>],<span class="hljs-number">2</span>)<br>            pix = pixel[index]<br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-number">0</span>:<br>                pix = (pix^key1)&amp;<span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-number">1</span>:<br>                pix = (~pix^key1)&amp;<span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-number">2</span>:<br>                pix = (pix^key2)&amp;<span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-number">3</span>:<br>                pix = (~pix^key2)&amp;<span class="hljs-number">0xff</span><br>            cipher[index] = pix <br>    <span class="hljs-keyword">return</span> cipher<br>flagimage = image<br>testimage = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>*<span class="hljs-number">16</span>):<br>    testimage.append(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>))<br><span class="hljs-built_in">print</span> testimage<br><span class="hljs-built_in">print</span> encrypt(testimage,key1,key2,x0,<span class="hljs-number">16</span>,<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> encrypt(flagimage,key1,key2,x0,<span class="hljs-number">24</span>,<span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure>

<p>通过审计代码可以发现：题目中一共有4个未知量：$x_0,r,key_1,key_2$。加密过程也很简单：通过$x_0,r$两个数字通过函数$f(x)&#x3D;rx(3-x)$不断迭代生成一个序列，然后根-据序列里的值来确定明文对哪个值进行异或。</p>
<h3 id="Step-1-求-key-值"><a href="#Step-1-求-key-值" class="headerlink" title="Step 1:求$key$值"></a>Step 1:求$key$值</h3><p>根据个人做题习惯：先将给出来的附加明文、附加密文、flag密文写入<code>given.py</code>，分别命名为<code>Pg,Cg,Cf</code>。</p>
<p>很显然，由于对明文的加密仅仅是对$key_1,key_2$的异或操作，因此我们可以先对$Pg,Cg$两个数组进行一次异或，可以得到$key_1,key_2$在集合$(78,177,86,169)$中。其中不难发现$78$的取反是$177$，$86$的取反是$169$。所以$key_1$的取值有两种$(78,177)$，$key_2$的取值有两种$(86,169)$，并且$key_1,key_2$的值进行调换是不等价的，也就是要关注顺序，又是两种可能性。因此，可能的$(key_1,key_2)$的数对一共有$8$种，因此我们可以利用这$8$种组合生成对应的加密指令串，也就是题目<code>encrypt</code>函数中的<code>bins</code></p>
<p>这一步的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> given <span class="hljs-keyword">import</span> Pg,Cg<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Generate</span>(<span class="hljs-params">key1,key2</span>):<br>    <span class="hljs-keyword">global</span> K1<br>    s=<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> K1:<br>        <span class="hljs-keyword">if</span>(i==key1):<br>            s+=<span class="hljs-string">&quot;00&quot;</span><br>        <span class="hljs-keyword">if</span>(i==(<span class="hljs-number">255</span>-key1)):<br>            s+=<span class="hljs-string">&quot;01&quot;</span><br>        <span class="hljs-keyword">if</span>(i==key2):<br>            s+=<span class="hljs-string">&quot;10&quot;</span><br>        <span class="hljs-keyword">if</span>(i==(<span class="hljs-number">255</span>-key2)):<br>            s+=<span class="hljs-string">&quot;11&quot;</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s)==<span class="hljs-number">512</span><br>    <span class="hljs-built_in">print</span>(s)<br>K1,K2=[],[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Pg)):<br>    K1.append((Pg[i]^Cg[i])&amp;<span class="hljs-number">0xff</span>)<br>    K2.append((~Pg[i]^Cg[i])&amp;<span class="hljs-number">0xff</span>)<br><span class="hljs-built_in">print</span>(K1)<br><span class="hljs-built_in">print</span>(K2)<br>Generate(<span class="hljs-number">78</span>,<span class="hljs-number">86</span>)<br>Generate(<span class="hljs-number">78</span>,<span class="hljs-number">169</span>)<br>Generate(<span class="hljs-number">177</span>,<span class="hljs-number">86</span>)<br>Generate(<span class="hljs-number">177</span>,<span class="hljs-number">169</span>)<br>Generate(<span class="hljs-number">86</span>,<span class="hljs-number">78</span>)<br>Generate(<span class="hljs-number">86</span>,<span class="hljs-number">177</span>)<br>Generate(<span class="hljs-number">169</span>,<span class="hljs-number">78</span>)<br>Generate(<span class="hljs-number">169</span>,<span class="hljs-number">177</span>)<br></code></pre></td></tr></table></figure>

<p>我们可以将生成的$8$个字符串写如<code>possible.py</code>文件中，定义数组<code>psb</code>储存这$8$个字符串，分别对应上面的八个可能的组合密钥，<code>possible.py</code>文件内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">psb=[<span class="hljs-string">&#x27;0001...1001&#x27;</span>,<br><span class="hljs-string">&#x27;0001...1101&#x27;</span>,<br><span class="hljs-string">&#x27;0100...1000&#x27;</span>,<br><span class="hljs-string">&#x27;0100...1100&#x27;</span>,<br><span class="hljs-string">&#x27;1011...0011&#x27;</span>,<br><span class="hljs-string">&#x27;1110...0010&#x27;</span>,<br><span class="hljs-string">&#x27;1011...0111&#x27;</span>,<br><span class="hljs-string">&#x27;1110...0110&#x27;</span>,]<br></code></pre></td></tr></table></figure>

<h3 id="Step-2-求-r-x-0-值"><a href="#Step-2-求-r-x-0-值" class="headerlink" title="Step 2:求$r,x_0$值"></a>Step 2:求$r,x_0$值</h3><p>也就是说，我们已经知道了密钥对$(key_1,key_2)$的八个可能组合，现在还有$(x_0,r)$这个组合我们还不知道，$x_0$是六位小数在区间内$[0.000000,0.999999]$，$r$是一个未知的数字。</p>
<p>根据题目中<code>assert(len(str(r))==3)</code>可知：$r$的取值有两个范围，一个是$[0.0,9.9]$内的一位小数，还有一个是$[100,999]$之间的三位数。不过根据简单的分析，由于题目中对产生的小数有乘$22000$的操作，假设当$x&#x3D;0.1$时，$100×0.1×2.9×22000&#x3D;638000$，远超$16$位整数最大值$65536$，因此$r$只有$[0.1,9.9]$之间。</p>
<p>我一开始猜的$r&#x3D;5.3$，结果运行加密脚本突然报错了，然后通过输出的数据，我发现迭代几次之后，数字的值就远远超过了$10^{300}$的数量级。说明$r$一定是有个范围的。</p>
<p>自己尝试了一下，发现当$r≤1.3$的时候整个迭代序列是收敛的，$r&gt;1.3$的时候迭代序列是发散的（因为函数图像左边可以走到负无穷）。所以，我们可以得出：$r$一共有$13$种取值方案，$x_0$一共有$10^6$中可能取值，因此对于一组密钥的枚举，一共是一千三百万种可能性，进行简单的剪枝还是可枚举的——只需要枚举一位根据可能性判断一位，一旦不符合直接<code>return 0</code>，进行下一轮的枚举即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> possible <span class="hljs-keyword">import</span> *<br>answer=psb[<span class="hljs-number">0</span>]<br>keyz=[(<span class="hljs-number">78</span>,<span class="hljs-number">86</span>),(<span class="hljs-number">78</span>,<span class="hljs-number">169</span>),(<span class="hljs-number">177</span>,<span class="hljs-number">86</span>),(<span class="hljs-number">177</span>,<span class="hljs-number">169</span>),(<span class="hljs-number">86</span>,<span class="hljs-number">78</span>),(<span class="hljs-number">86</span>,<span class="hljs-number">177</span>),(<span class="hljs-number">169</span>,<span class="hljs-number">78</span>),(<span class="hljs-number">169</span>,<span class="hljs-number">177</span>)]<br>Standard=[]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">x,r</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(r*x*(<span class="hljs-number">3</span>-x),<span class="hljs-number">6</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">BruteForce</span>(<span class="hljs-params">key1,key2,x0,m,n,r</span>):<br>    num = m*n//<span class="hljs-number">8</span>    <br>    seqs = []<br>    x = x0<br>    bins = <span class="hljs-string">&#x27;&#x27;</span><br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num):<br>        x = generate(x,r)<br>        tmp.append(x)<br>        seqs.append(<span class="hljs-built_in">int</span>(x*<span class="hljs-number">22000</span>))<br>        <span class="hljs-keyword">if</span>(seqs!=Standard[:<span class="hljs-built_in">len</span>(seqs)]):<br>           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> T <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Breaking &#x27;</span>+<span class="hljs-built_in">str</span>(T+<span class="hljs-number">1</span>)+<span class="hljs-string">&#x27;th Possibility&#x27;</span>)<br>    k1,k2=keyz[T]<br>    answer=psb[T]<br>    Standard=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(answer),<span class="hljs-number">16</span>):<br>        Standard.append(<span class="hljs-built_in">int</span>(answer[i:i+<span class="hljs-number">16</span>],<span class="hljs-number">2</span>))<br>    x0=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> x0&lt;<span class="hljs-number">0.999999</span>:<br>        x0=<span class="hljs-built_in">round</span>(x0+<span class="hljs-number">0.000001</span>,<span class="hljs-number">6</span>)<br>        r=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> r&lt;<span class="hljs-number">1.3</span>:<br>            r=r+<span class="hljs-number">0.1</span><br>            <span class="hljs-keyword">if</span>(BruteForce(k1,k2,x0,<span class="hljs-number">16</span>,<span class="hljs-number">16</span>,r)):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Find(k1,k2,x0,r)!\n&#x27;</span>,k1,k2,x0,r)<br>                <span class="hljs-keyword">break</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Result:</span><br><span class="hljs-string">Breaking 7th Possibility</span><br><span class="hljs-string">Find(k1,k2,x0,r)!</span><br><span class="hljs-string"> 169 78 0.840264 1.2</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="Step-3-整合结果，求出答案"><a href="#Step-3-整合结果，求出答案" class="headerlink" title="Step 3:整合结果，求出答案"></a>Step 3:整合结果，求出答案</h3><p>我们成功找出了$x_0&#x3D;0.840264,r&#x3D;1.2$，这样四个未知数所有的内容就全被我们知道了。扩展一下操作串，然后解密回去就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> given <span class="hljs-keyword">import</span> Cf<br>x0,r=<span class="hljs-number">0.840264</span>,<span class="hljs-number">1.2</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(r*x*(<span class="hljs-number">3</span>-x),<span class="hljs-number">6</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">key1,key2,x0,m,n</span>):<br>    num = m*n//<span class="hljs-number">8</span>    <br>    seqs = []<br>    x = x0<br>    bins = <span class="hljs-string">&#x27;&#x27;</span><br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num):<br>        x = generate(x)<br>        tmp.append(x)<br>        seqs.append(<span class="hljs-built_in">int</span>(x*<span class="hljs-number">22000</span>))<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> seqs:<br>        bin_x  = <span class="hljs-built_in">bin</span>(x)[<span class="hljs-number">2</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bin_x) &lt; <span class="hljs-number">16</span>:<br>            bin_x = <span class="hljs-string">&#x27;0&#x27;</span>*(<span class="hljs-number">16</span>-<span class="hljs-built_in">len</span>(bin_x))+bin_x<br>        bins += bin_x<br>    <span class="hljs-keyword">return</span> bins<br>decstr=encrypt(<span class="hljs-number">169</span>,<span class="hljs-number">78</span>,<span class="hljs-number">0.840264</span>,<span class="hljs-number">24</span>,<span class="hljs-number">16</span>)<br>Pf=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Cf)):<br>    op=<span class="hljs-built_in">int</span>(decstr[i*<span class="hljs-number">2</span>:i*<span class="hljs-number">2</span>+<span class="hljs-number">2</span>],<span class="hljs-number">2</span>)<br>    <span class="hljs-comment">#print(op)</span><br>    <span class="hljs-keyword">if</span>(op==<span class="hljs-number">0</span>):<br>        Pf.append(Cf[i]^<span class="hljs-number">169</span>)<br>    <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>):<br>        Pf.append(Cf[i]^<span class="hljs-number">86</span>)<br>    <span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>):<br>        Pf.append(Cf[i]^<span class="hljs-number">78</span>)<br>    <span class="hljs-keyword">if</span>(op==<span class="hljs-number">3</span>):<br>        Pf.append(Cf[i]^<span class="hljs-number">177</span>)<br><span class="hljs-built_in">print</span>(Pf)<br>S=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> Pf:<br>   S*=<span class="hljs-number">256</span><br>   S+=i<br>S=long_to_bytes(S)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;CISCN&#123;&#x27;</span>+md5(S).hexdigest()+<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br><span class="hljs-comment">#CISCN&#123;7fa176002ced947e49f1752c1eb9dd62&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-CopperMove"><a href="#2-CopperMove" class="headerlink" title="2.CopperMove"></a>2.CopperMove</h2><h3 id="Step-1：初步观察代码，确定算法"><a href="#Step-1：初步观察代码，确定算法" class="headerlink" title="Step 1：初步观察代码，确定算法"></a>Step 1：初步观察代码，确定算法</h3><p>还是先看一下题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> sqrt, gcd<br><span class="hljs-keyword">import</span> random<br>BITS = <span class="hljs-number">512</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>)<br>flag = f.read()<br>f.close()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_prime</span>(<span class="hljs-params">nbit</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        p = getPrime(nbit)<br>        <span class="hljs-keyword">if</span> p % <span class="hljs-number">3</span> == <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">return</span> p<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>(<span class="hljs-params">nbit</span>):<br>    p = get_prime(nbit)<br>    q = get_prime(nbit)<br>    <span class="hljs-keyword">if</span> q &gt; p:<br>        p, q = q, p<br>    n = p * q<br>    bound = <span class="hljs-built_in">int</span>(sqrt(<span class="hljs-number">2</span> * n)) // <span class="hljs-number">12</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        x = random.randint(<span class="hljs-number">1</span>, <span class="hljs-built_in">round</span>(sqrt(bound)))<br>        y = random.randint(<span class="hljs-number">1</span>, bound) // x<br>        zbound = <span class="hljs-built_in">int</span>(((p - q) * <span class="hljs-built_in">round</span>(n ** <span class="hljs-number">0.25</span>) * y) // (<span class="hljs-number">3</span> * (p + q)))<br>        z = zbound - ((p + <span class="hljs-number">1</span>) * (q + <span class="hljs-number">1</span>) * y + zbound) % x<br>        e = ((p + <span class="hljs-number">1</span>) * (q + <span class="hljs-number">1</span>) * y + z) // x<br>        <span class="hljs-keyword">if</span> gcd(e, (p + <span class="hljs-number">1</span>) * (q + <span class="hljs-number">1</span>)) == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">break</span><br>    gifts = [<span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(p)[<span class="hljs-number">2</span>:][:<span class="hljs-number">22</span>], <span class="hljs-number">2</span>), <span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(p)[<span class="hljs-number">2</span>:][<span class="hljs-number">256</span>:<span class="hljs-number">276</span>], <span class="hljs-number">2</span>)]<br>    <span class="hljs-keyword">return</span> n, e, gifts<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">p1, p2</span>):<span class="hljs-comment"># ECC Add</span><br>    <span class="hljs-keyword">if</span> p1 == (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">return</span> p2<br>    <span class="hljs-keyword">if</span> p2 == (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">return</span> p1<br>    <span class="hljs-keyword">if</span> p1[<span class="hljs-number">0</span>] == p2[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> (p1[<span class="hljs-number">1</span>] != p2[<span class="hljs-number">1</span>] <span class="hljs-keyword">or</span> p1[<span class="hljs-number">1</span>] == <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">if</span> p1[<span class="hljs-number">0</span>] == p2[<span class="hljs-number">0</span>]:<br>        tmp = (<span class="hljs-number">3</span> * p1[<span class="hljs-number">0</span>] * p1[<span class="hljs-number">0</span>]) * inverse(<span class="hljs-number">2</span> * p1[<span class="hljs-number">1</span>], n) % n<br>    <span class="hljs-keyword">else</span>:<br>        tmp = (p2[<span class="hljs-number">1</span>] - p1[<span class="hljs-number">1</span>]) * inverse(p2[<span class="hljs-number">0</span>] - p1[<span class="hljs-number">0</span>], n) % n<br>    x = (tmp * tmp - p1[<span class="hljs-number">0</span>] - p2[<span class="hljs-number">0</span>]) % n<br>    y = (tmp * (p1[<span class="hljs-number">0</span>] - x) - p1[<span class="hljs-number">1</span>]) % n<br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">int</span>(x), <span class="hljs-built_in">int</span>(y))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">n, p</span>):<br>    r = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>    tmp = p<br>    <span class="hljs-keyword">while</span> <span class="hljs-number">0</span> &lt; n:<br>        <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">1</span> == <span class="hljs-number">1</span>:<br>            r = add(r, tmp)<br>        n, tmp = n &gt;&gt; <span class="hljs-number">1</span>, add(tmp, tmp)<br>    <span class="hljs-keyword">return</span> r<br>n, e, hint = gen(BITS)<br>pt = (bytes_to_long(flag[:<span class="hljs-built_in">len</span>(flag) // <span class="hljs-number">2</span>]), bytes_to_long(flag[<span class="hljs-built_in">len</span>(flag) // <span class="hljs-number">2</span>:]))<br>c = mul(e, pt)<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br>f.write(<span class="hljs-string">f&quot;n = <span class="hljs-subst">&#123;n&#125;</span>\n&quot;</span>)<br>f.write(<span class="hljs-string">f&quot;e = <span class="hljs-subst">&#123;e&#125;</span>\n&quot;</span>)<br>f.write(<span class="hljs-string">f&quot;h1 = <span class="hljs-subst">&#123;hint[<span class="hljs-number">0</span>]&#125;</span>\n&quot;</span>)<br>f.write(<span class="hljs-string">f&quot;h2 = <span class="hljs-subst">&#123;hint[<span class="hljs-number">1</span>]&#125;</span>\n&quot;</span>)<br>f.write(<span class="hljs-string">f&quot;c = <span class="hljs-subst">&#123;c&#125;</span>\n&quot;</span>)<br>f.close()<br></code></pre></td></tr></table></figure>

<p>初次代码审计，可能并看不出什么，不过这里我们可以发现这样两个情况：</p>
<p>一是生成$e$的方式非常复杂，并且$p,q\equiv 2 \pmod 3$。</p>
<p>二是add、mul函数是二元组的计算，并且看似非常复杂，像坐标的计算</p>
<p>根据条件二，可以判断出这应该是ECC，根据条件一，可以判断出这里用的是KMOV-91算法，相关内容见博客上发布的<strong>ECCNotes3(2021.3.25)</strong></p>
<h3 id="Step-2：二次审计代码，定参数性质"><a href="#Step-2：二次审计代码，定参数性质" class="headerlink" title="Step 2：二次审计代码，定参数性质"></a>Step 2：二次审计代码，定参数性质</h3><p>通过审计代码，我们可以发现：$\dfrac{\ln x}{\ln 2}&#x3D;254,\dfrac{\ln y}{\ln 2}&lt;260,\dfrac{\ln n}{\ln 2}&#x3D;\dfrac{\ln e}{\ln 2}&#x3D;1024$。并且$\dfrac{\ln }{\ln 2}(ex-yn)&#x3D;535$。</p>
<p>由于这里不知道WienerAttack怎么做，不过我们可以将这个特殊化成RSA中低解密指数广播（虽然只有一组）攻击的形式，构造低解密指数攻击的格，就可以把$x$求出来了。（相关方法见文章<strong>VNCTF WriteUp，2021.4.9发布</strong>）</p>
<p>然后根据$y&#x3D;\dfrac{ex}n$，可以很快的求出$y$的值。然后就可以求出余数$k$。</p>
<p>然后我们可以这样进行推导：由<br>$$<br>k&#x3D;y(p+q+1)-z<br>$$<br>可以推出<br>$$<br>k&#x3D;y(p+q+1)-\mathrm{zbound}-[(\phi y-\mathrm{zbound})\mod x]<br>$$<br>其中$\phi&#x3D;(p+1)(q+1)$，其意义是椭圆曲线上的点数，不是RSA中的$\phi&#x3D;(p-1)(q-1)$！</p>
<p>然后我们根据条件，又可以推出<br>$$<br>k&#x3D;y(p+q+1)+{\text{int}(\dfrac{(p-q)\text{int}(\sqrt[4]n+0.5)y}{3(p+q)}})-[\phi y-\mathrm{zbound} \mod x]<br>$$<br>由于最后一项一定小于$x$，而第二项与$\dfrac{(p-q)\text{int}(\sqrt[4]n+0.5)y}{3(p+q)}$真实值不超过$1$。因此上面的式子除以$y$，就是$K&#x3D;p+q+1+\dfrac{(p-q)\text{int}(\sqrt[4]n+0.5)y}{3(p+q)}$的值。而此时的未知量，只剩下了$p,q$。</p>
<p>因此我们可以得到这样的式子：<br>$$<br>p-q&#x3D;\dfrac{3(p+q)(K-1-(p+q))}{\mathrm{int}(\sqrt[4]{n}+0.5)}<br>$$<br>又根据$(p+q)^2-(p-q)^2&#x3D;4n$，假设$p+q&#x3D;s$，之前的结果可以得到这样的结果<br>$$<br>4n&#x3D;s^2-\dfrac{\mathrm{int}(9s^2(K-1-s)^2)}{\mathrm{int}^2(\sqrt[4]n +0.5)}<br>$$<br>然后用二分法求解即可。</p>
<p>求出来之后，就可以知道分解$p,q$，求出解密指数$d$，题目出解。</p>
<p>这里椭圆曲线是$y^2&#x3D;x^3+b$，相关内容见<strong>ECC Notes3</strong>中的KMOV91</p>
<p>上一下解密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>e=<br>n=<br>Cx=<br>Cy=<br>M=matrix(ZZ,[[<span class="hljs-number">2</span>^<span class="hljs-number">512</span>,e],[<span class="hljs-number">0</span>,n]])<br>M=M.LLL()<br>x=(<span class="hljs-built_in">abs</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])&gt;&gt;<span class="hljs-number">512</span>)<br>y=e*x//n<br>k=e*x-y*n<br>K=k//y<br>l,r=<span class="hljs-number">0</span>,K<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">515</span>):<br>    s=(l+r)//<span class="hljs-number">2</span><br>    v=s*s-<span class="hljs-built_in">int</span>(s*s*<span class="hljs-number">9</span>*(K-<span class="hljs-number">1</span>-s)*(K-<span class="hljs-number">1</span>-s))//(<span class="hljs-built_in">round</span>(n**<span class="hljs-number">0.25</span>)*<span class="hljs-built_in">round</span>(n**<span class="hljs-number">0.25</span>))<br>    <span class="hljs-keyword">if</span>(v&lt;<span class="hljs-number">4</span>*n):<br>        l=s<br>    <span class="hljs-keyword">else</span>:<br>        r=s<br>pandq=r<br>d=inverse(e,n+pandq+<span class="hljs-number">1</span>)<br>b=(Cy**<span class="hljs-number">2</span>-Cx**<span class="hljs-number">3</span>)%n<br>E=EllipticCurve(Zmod(n), [<span class="hljs-number">0</span>, b])<br>C=E(Cx,Cy)<br>P=d*C<br>flag=long_to_bytes(P[<span class="hljs-number">0</span>])+long_to_bytes(P[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#CISCN&#123;e91fef4ead7463b13d00bda65f540477&#125;</span><br></code></pre></td></tr></table></figure>

<p>2021虎符CTF得到这道题是这个题目的扩展版,只不过这里$\ln x&#x3D;0.38\ln n$，提供了三组数据，也一样解。</p>
<p><a target="_blank" rel="noopener" href="https://ctf.njupt.edu.cn/597.html#simultaneous">REFERENCE</a></p>
<h2 id="3-XDCTF-RSA"><a href="#3-XDCTF-RSA" class="headerlink" title="3.[XDCTF RSA]"></a>3.[XDCTF RSA]</h2><p>2021年5月7日，做出了shallow出的题目，死而无憾</p>
<p>还是先按照惯例看一下题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>n = p * q<br>e = <span class="hljs-number">65537</span><br><span class="hljs-built_in">print</span>(n)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(bytes_to_long(flag) , e , n))<br>_q = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(q)[<span class="hljs-number">2</span>:][::-<span class="hljs-number">1</span>] , <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(p ^ _q)<br></code></pre></td></tr></table></figure>

<p>题目给出了$e,n$的同时，还给出了$p$的值与$q’$异或之后的值，其中$q’$是$q$的比特位完全反过来对应的值.</p>
<p>之前自己在网上见到过一个题目，条件是$q$的比特位为$p$的比特位倒过来，也就是$p&#x3D;q’$。这就说明那道题是这一题的一个特殊情况：$p \text { xor } q’&#x3D;0$。所以可以认为这两题是同一个题目</p>
<p>所以我们只需要一位一位，同时枚举$p,q$的高位就可以了，这样顺便就能把对应的低位求出来。因此枚举是$256$轮而不是$512$轮。这边还有一点，就是异或后的值不足$512$个比特位，因此我们要对$a$（也就是异或的值）的高位进行补$0$。</p>
<p>然后我们可以就可以开始我们的dfs操作了，不过这里有几个剪枝点可以简单的提一下：</p>
<p>1.根据同余的性质可知：无论在多少进制下，只要两个数的最后$n$位固定下来了，那么这两个数的乘积的最后$n$位也被固定了。因此我们只要发现枚举时两个数乘出来最后的比特位与$n$值对应的比特位不一致，那么我们就把这个状态舍弃掉</p>
<p>2.由于我们是一位一位的从$p,q$的高位开始枚举，因此实际上随着枚举的进行，如果假设中间未被枚举到的数位全是$0$的话，$p,q$的值应该是逐渐变大的。因此在枚举中，如果发现$p,q$两个数的乘积超过了$n$，就又可以说明这一种情况不符合条件了，也需要通过<code>continue</code>将其舍弃，这样我们就可以给枚举值定上限了。</p>
<p>3.与此同时，我们还可以给枚举值定下限。假设我们枚举的时候，中间未被枚举到的位全是$1$，那么我们枚举时就可以认为$p,q$两个值是不断缩小的，而此时我们假设的$p,q$两个数乘积还不到$n$，就说明这种情况也不符合题意，我们可以通过这个方式给枚举值定下限。而如果我们想假设这两个数未被枚举到的比特位全是$1$的话，可以认为是$2^{511-\mathrm{Round}}\mathrm{CurP}$（具体原因可以自己尝试一下）。</p>
<p>这样设置这三个筛选条件，就可以获得$p,q$的值解密了。</p>
<p><del>还有两题实在做不出来，因为自己tcl</del></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> given <span class="hljs-keyword">import</span> e,n,c,a<br>bina=<span class="hljs-built_in">bin</span>(a)[<span class="hljs-number">2</span>:]<br>bina=<span class="hljs-string">&#x27;0&#x27;</span>*(<span class="hljs-number">512</span>-<span class="hljs-built_in">len</span>(bina))+bina<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">P,Q,Round</span>):<br>    <span class="hljs-keyword">if</span> Round==<span class="hljs-number">256</span>:<br>        <span class="hljs-keyword">if</span> P*Q==n:<br>            <span class="hljs-keyword">global</span> p,q<br>            p,q=P,Q<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>            CurP=P+i*(<span class="hljs-number">2</span>**(<span class="hljs-number">511</span>-Round))+(<span class="hljs-built_in">int</span>(bina[Round])^j)*(<span class="hljs-number">2</span>**Round)<br>            CurQ=Q+j*(<span class="hljs-number">2</span>**(<span class="hljs-number">511</span>-Round))+(<span class="hljs-built_in">int</span>(bina[<span class="hljs-number">511</span>-Round])^i)*(<span class="hljs-number">2</span>**Round)<br>            <span class="hljs-keyword">if</span> CurP*CurQ&gt;n:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">if</span>  (CurP+<span class="hljs-number">2</span>**(<span class="hljs-number">511</span>-Round))*((CurQ+<span class="hljs-number">2</span>**(<span class="hljs-number">511</span>-Round)))&lt;n: <br>                <span class="hljs-keyword">continue</span>     <br>            <span class="hljs-keyword">if</span> (CurP*CurQ)%(<span class="hljs-number">2</span>**(Round+<span class="hljs-number">1</span>))!=n%(<span class="hljs-number">2</span>**(Round+<span class="hljs-number">1</span>)):<br>                <span class="hljs-keyword">continue</span><br>            dfs(CurP,CurQ,Round+<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-comment">#------Main Below------#</span><br>p,q=<span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br>dfs(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br><span class="hljs-keyword">assert</span> p!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> q!=<span class="hljs-literal">None</span><br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=inverse(e,phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br></code></pre></td></tr></table></figure>



<h2 id="4-CSAWQual-2019-byte-me"><a href="#4-CSAWQual-2019-byte-me" class="headerlink" title="4.[CSAWQual 2019]byte_me"></a>4.[CSAWQual 2019]byte_me</h2><p>XDCTF中shallow出了一个块密码题，是CBC模式，<del>但自己太菜了没做出来</del>，然后我在buu上找到了一个同样的块密码，不过这里用的是EBC模式，关于块密码题，我会在第三阶段的CTF学习中，会专门在一篇博客中对几种块密码的加密模式进行一个比较详细的阐述.</p>
<p>ECB模式，即电子密码本，对每一块明文逐个加密就可以得到密文（最后一个块要填充）。该模式具有简单、高效的特点，然而缺点也很明显，就是密文很有规律（因为使用的是同一个密钥），容易在主动攻击中被破解。在DES&#x2F;3DES加密中，取用的块长度为8，而在AES加密中，块长度为16。</p>
<p>该模式有个很显著的特点：既不需要计数器也不需要初始向量iv</p>
<p>首先我们看一下加密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pad</span>(<span class="hljs-params">text, block_size</span>):<br>    pad_size = block_size - (<span class="hljs-built_in">len</span>(text) % block_size)<br>    <span class="hljs-keyword">if</span> pad_size == <span class="hljs-number">0</span>:<br>        pad_size = block_size<br>    pad = <span class="hljs-built_in">chr</span>(pad_size) * pad_size<br>    <span class="hljs-keyword">return</span> text + pad<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">random_key</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(<br>        [random.choice(string.ascii_letters + string.digits) <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num)]<br>    ).upper()<br>key = random_key(<span class="hljs-number">16</span>)<br>random_string = random_key(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">15</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ecb_enc</span>(<span class="hljs-params">text</span>):<br>    cipher = AES.new(key, AES.MODE_ECB)<br>    <span class="hljs-keyword">return</span> cipher.encrypt(text)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encryption_oracle</span>(<span class="hljs-params">text, unknown</span>):<br>    text = pad(random_string + text + unknown, <span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">return</span> ecb_enc(text)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">string_length_detect</span>():<br>    str1 = encryption_oracle(<span class="hljs-string">&quot;A&quot;</span> * <span class="hljs-number">16</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    decoded_flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).readline()<br>    <span class="hljs-built_in">print</span>(encryption_oracle(decoded_flag, <span class="hljs-string">&quot;&quot;</span>).encode(<span class="hljs-string">&quot;hex&quot;</span>))<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        userInput = raw_input(<span class="hljs-string">&quot;Tell me something: &quot;</span>)<br>        <span class="hljs-built_in">print</span>(encryption_oracle(<span class="hljs-built_in">str</span>(userInput), decoded_flag).encode(<span class="hljs-string">&quot;hex&quot;</span>))<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    exit(main())<br></code></pre></td></tr></table></figure>

<p>通过代码审计，我们可以得到这样一个关系：设明文为$m$，一个随机前缀$w$（长度在1到15位之间）。一开始给出$w+m$的加密结果$c$（<strong>见下图第一段</strong>），数了一下，一共$128$位，考虑到$w$的长度是1到15位，那么估计$m$的长度应该是32至​48​位之间的样子。也就是需要三个块。而这道题，是对AES-ECB模式的选择明文攻击，对服务器发送字符串$s$，最后服务器返回对$w+s+m$加密的密文</p>
<p>一开始自己没有思路的时候，对服务器发送了字符串<code>a</code>,<code>aa</code>,<code>aaa</code>,<code>aaaa</code>,… …，然后我发现当字符<code>a</code>的个数达到某个值的时候，最前面32位的密文保持不变——经过思考，这不变的32位密文，是随机前缀$w$通过填充字符<code>a</code>至16位时的密文。假设这一段字符<code>a</code>称为字符串$i$，那么我们取使加密结果不再改变的<code>a</code>字符的最小值作为字符串$i$，那么此时第一段加密结果，也就是最前面32位，就是字符串$w+i$的结果，第32至64位是$m$前16位的加密结果，称为$m_1$，再往后就是$m_2,m_3$，分别对应$m$的第17-32位和第33位及以后的加密结果。<strong>见下图第二段</strong></p>
<p>然后，我们可以构造一段长度15，内容为<code>#</code>的字符串，称为$k$串，对服务器发送$i+k$，服务器返回$w+i+k+m$的密文，其中$w+i$这一个长度为16的字符串对应的密文前32位，而密文第 33至48位对应着$k$和$m$第一位的密文。这一次，我们可以对这一位进行爆破。<strong>见下图第三段灰色部分，为爆破的这一位</strong>。如果爆破时的某一个加密结果的33至48位与初始发送的33至48位一致，那么我们就认为这一位成功爆破。并存储下来作为$f$</p>
<p>然后我们就可以把$k$改成14个<code>#</code>，然后13个<code>#</code>，每次发送 $i+k+f$，返回$w+i+k+f+m$的密文。其中$w+i$为16位，$k+f$为16位，不破坏加密的整体性，<strong>见下图第四段和第五段</strong>，棕色是我们已知的$m_1$的部分，灰色是我们爆破的那一位</p>
<p><img src="/2021/05/17/21May1/201.png" srcset="/img/loading.gif" lazyload alt="401"></p>
<p>很快，我们知道了$m_1$的全部，也就是flag的前16位，见下面第六段**(注意下面这张图的标尺与上面一个图不一样！)**</p>
<p>这个时候，我们可以截取$m_1$的最后15位，然后仍然是爆破第整个序列第32位，使这两个地方的加密值相同，可以获得$m_2$的第一位。</p>
<p>然后截取$m_1$的最后14位，13位，这样我们可以知道的$m_2$的内容越来越多… …<strong>见下图第七段</strong></p>
<p>同理，<strong>见下图第八段和第九段，同理可以知道$m_3$的所有内容</strong></p>
<p><img src="/2021/05/17/21May1/202.png" srcset="/img/loading.gif" lazyload alt="402"></p>
<p>最后上一下脚本和运行结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29419</span>)<br>C=sh.recvline(keepends=<span class="hljs-literal">False</span>)<br><span class="hljs-comment">#print(C)</span><br><span class="hljs-comment">#print(len(C))</span><br><span class="hljs-comment">#sh.interactive()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getflag</span>(<span class="hljs-params">sh,L,R</span>):<br>    <span class="hljs-keyword">global</span> suffex,flag<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(i,flag[<span class="hljs-number">15</span>:])<br>        suff=<span class="hljs-string">&#x27;#&#x27;</span>*i<br>        sh.recvuntil(<span class="hljs-string">&#x27;ng: &#x27;</span>)<br>        <span class="hljs-comment">#print(flag+&#x27;\n&#x27;)</span><br>        sh.send(suffex+suff+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>            rightseq=sh.recvline(keepends=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br>            nowch=<span class="hljs-built_in">chr</span>(j)<br>            sh.recvuntil(<span class="hljs-string">&#x27;ng: &#x27;</span>)<br>            sh.send(suffex+flag[-<span class="hljs-number">15</span>:]+nowch+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                getseq=sh.recvline(keepends=<span class="hljs-literal">False</span>)<br>            <span class="hljs-keyword">if</span>(getseq[<span class="hljs-number">32</span>:<span class="hljs-number">64</span>]==rightseq[L:R]):<br>                flag=flag+nowch<br>                <span class="hljs-keyword">break</span><br>flag=<span class="hljs-string">&#x27;#&#x27;</span>*<span class="hljs-number">15</span><br>recvsuff=<span class="hljs-string">&#x27;0123456789abcdef0123456789abcdef&#x27;</span><br>suffex=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    suff=<span class="hljs-string">&#x27;*&#x27;</span>*(i+<span class="hljs-number">1</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;ng: &#x27;</span>)<br>    sh.send(suff+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>        curseq=sh.recvline(keepends=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">if</span>(curseq[:<span class="hljs-number">32</span>]==recvsuff):<br>        suffex=<span class="hljs-string">&#x27;*&#x27;</span>*i<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        recvsuff=curseq[:<span class="hljs-number">32</span>]<br><span class="hljs-built_in">print</span>(suffex)<br>getflag(sh,<span class="hljs-number">32</span>,<span class="hljs-number">64</span>)<br>getflag(sh,<span class="hljs-number">64</span>,<span class="hljs-number">96</span>)<br>getflag(sh,<span class="hljs-number">96</span>,<span class="hljs-number">128</span>)<br></code></pre></td></tr></table></figure>

<p><img src="/2021/05/17/21May1/1.jpg" srcset="/img/loading.gif" lazyload alt="403"></p>
<h2 id="5-CISCN2018-Crackme-Java"><a href="#5-CISCN2018-Crackme-Java" class="headerlink" title="5.[CISCN2018] Crackme Java"></a>5.[CISCN2018] Crackme Java</h2><p>首先看一下题目，刚好最近学了一下java，能够搞懂题目的意思</p>
<p>然后简单的审计一下代码，发现使Elgamal，只不过$c_1,c_2$都是以$32$进制给出来的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.math.BigInteger;<br><span class="hljs-keyword">import</span> java.util.Random;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test0</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">BigInteger</span> <span class="hljs-variable">two</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">BigInteger</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-string">&quot;11360738295177002998495384057893129964980131806509572927886675899422214174408333932150813939357279703161556767193621832795605708456628733877084015367497711&quot;</span>);<br>    <span class="hljs-keyword">static</span> BigInteger h= <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-string">&quot;7854998893567208831270627233155763658947405610938106998083991389307363085837028364154809577816577515021560985491707606165788274218742692875308216243966916&quot;</span>);<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     Alice write the below algorithm for encryption.</span><br><span class="hljs-comment">     The public key &#123;p, h&#125; is broadcasted to everyone.</span><br><span class="hljs-comment">    @param val: The plaintext to encrypt.</span><br><span class="hljs-comment">        We suppose val only contains lowercase letter &#123;a-z&#125; and numeric charactors, and is at most 256 charactors in length.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">pkEnc</span><span class="hljs-params">(String val)</span>&#123;<br>        BigInteger[] ret = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>[<span class="hljs-number">2</span>];<br>        BigInteger bVal=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(val.toLowerCase(),<span class="hljs-number">36</span>);<br>        <span class="hljs-type">BigInteger</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt()+<span class="hljs-string">&quot;&quot;</span>);<br>        ret[<span class="hljs-number">0</span>]=two.modPow(r,p);<br>        ret[<span class="hljs-number">1</span>]=h.modPow(r,p).multiply(bVal);<br>        <span class="hljs-keyword">return</span> ret[<span class="hljs-number">0</span>].toString(<span class="hljs-number">36</span>)+<span class="hljs-string">&quot;==&quot;</span>+ret[<span class="hljs-number">1</span>].toString(<span class="hljs-number">36</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/* Alice write the below algorithm for decryption. x is her private key, which she will never let you know.</span><br><span class="hljs-comment">    public static String skDec(String val,BigInteger x)&#123;</span><br><span class="hljs-comment">        if(!val.contains(&quot;==&quot;))&#123;</span><br><span class="hljs-comment">            return null;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        else &#123;</span><br><span class="hljs-comment">            BigInteger val0=new BigInteger(val.split(&quot;==&quot;)[0],36);</span><br><span class="hljs-comment">            BigInteger val1=new BigInteger(val.split(&quot;==&quot;)[1],36);</span><br><span class="hljs-comment">            BigInteger s=val0.modPow(x,p).modInverse(p);</span><br><span class="hljs-comment">            return val1.multiply(s).mod(p).toString(36);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">   */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;You intercepted the following message, which is sent from Bob to Alice:&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;eag0vit7sboilgcfu0fbkbrmjgs4pzi2oznmqrkey5h1bwicvborngscx050u8vpghi69xqjmotgrtj4vq8fgw9tzi916o034bu==ahcwy7c0qq5cnxdntssqrj972nhvzt5liqlq0cvv0o1fm2ee4205nemuy5tvkda0hyetu5a5xcqqov8exk901z5xebvkcdo3jiq1gj8pkxzhjaeg9z6syu58neijxy56am7d1l9grhgtgkkfc432wm6h3jr8y1xx&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Please figure out the plaintext!&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//eag0vit7sboilgcfu0fbkbrmjgs4pzi2oznmqrkey5h1bwicvborngscx050u8vpghi69xqjmotgrtj4vq8fgw9tzi916o034bu==ahcwy7c0qq5cnxdntssqrj972nhvzt5liqlq0cvv0o1fm2ee4205nemuy5tvkda0hyetu5a5xcqqov8exk901z5xebvkcdo3jiq1gj8pkxzhjaeg9z6syu58neijxy56am7d1l9grhgtgkkfc432wm6h3jr8y1xx</span><br></code></pre></td></tr></table></figure>

<p>注意到$r$是<code>random_integer</code>，说明应该不超过$42$亿，简单枚举一下就可以知道$r$的值了</p>
<p>$r$解出来了就可以知道所有的内容了<del>不过不知道最后应该交上去什么，不过西电大佬dbt是解出来的，不过他也忘记了，因为真的不好改</del></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">if</span>(s[:<span class="hljs-number">5</span>]==<span class="hljs-string">b&#x27;flag&#123;&#x27;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>        <span class="hljs-keyword">if</span>(s[i] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>)):<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>p=<span class="hljs-number">11360738295177002998495384057893129964980131806509572927886675899422214174408333932150813939357279703161556767193621832795605708456628733877084015367497711</span><br>h=<span class="hljs-number">7854998893567208831270627233155763658947405610938106998083991389307363085837028364154809577816577515021560985491707606165788274218742692875308216243966916</span><br>c1=<span class="hljs-string">&#x27;eag0vit7sboilgcfu0fbkbrmjgs4pzi2oznmqrkey5h1bwicvborngscx050u8vpghi69xqjmotgrtj4vq8fgw9tzi916o034bu&#x27;</span><br>c2=<span class="hljs-string">&#x27;ahcwy7c0qq5cnxdntssqrj972nhvzt5liqlq0cvv0o1fm2ee4205nemuy5tvkda0hyetu5a5xcqqov8exk901z5xebvkcdo3jiq1gj8pkxzhjaeg9z6syu58neijxy56am7d1l9grhgtgkkfc432wm6h3jr8y1xx&#x27;</span><br>c1,c2=<span class="hljs-built_in">int</span>(c1,<span class="hljs-number">36</span>),<span class="hljs-built_in">int</span>(c2,<span class="hljs-number">36</span>)<br>r=<span class="hljs-number">1599939680</span><br><span class="hljs-keyword">assert</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,r,p)==c1)<br>e1=<span class="hljs-built_in">pow</span>(h,r,p)<br><span class="hljs-keyword">assert</span> c2%e1==<span class="hljs-number">0</span><br>bval=c2//e1<br>table=<span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span><br>s=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">from</span> base36 <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(dumps(bval))<br><span class="hljs-comment">#ciscncongratulationsthisisdesignedbyalibabasecurity2096022101</span><br></code></pre></td></tr></table></figure>

<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6.Conclusion"></a>6.Conclusion</h2><p>huangx607087 CTF学习的第二阶段至此就结束了。后面准备备考六级和期末考试了。</p>
<p>7月7日，博客会继续更新，第三阶段CTF学习开始，自己争取能够在以后有1次去线下看看各位大佬们的机会吧<del>虽然我知道就算是去了大概率还是去摸鱼的</del>，寒假自己的CTF水平有了个突破，争取这个暑假也能有个突破吧</p>
<p>不知不觉，今天都已经5月18日了，7月7日放暑假，也就是说自己大一就剩不到50天了（草</p>
<p>没想到自己已经走了这么远了啊… …<del>怎么感觉昨天才入学啊woc</del>……</p>
<p>争取到时候能有Am4dalao的一半水平吧（，哎（</p>
<p><del>打CTF能认识dw和dbt两位密码神，死而无憾</del></p>
<p><del>6月28日进入考试周，冲冲冲，争取每门课都能有60——不过我发现自己预习不完了怎么办</del>，我只是不想补考（哎</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTFSeason2/" class="category-chain-item">CTFSeason2</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ExpLog/" class="print-no-link">#ExpLog</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>21May1</div>
      <div>http://example.com/2021/05/17/21May1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>huangx607087</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年5月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/07/10/Explore-MT19937/" title="Explore MT19937">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Explore MT19937</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/09/VNCTF-WriteUp/" title="VNCTF WriteUp">
                        <span class="hidden-mobile">VNCTF WriteUp</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
