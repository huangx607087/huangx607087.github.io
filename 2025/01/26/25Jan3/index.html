

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="huangx607087">
  <meta name="keywords" content="">
  
    <meta name="description" content="huangx607087 1月的切题 30.Introduction一回家就G了，然后休息了几天，两场CTF比赛都没好好看 1.[DASCTF2304] babyhash_revenge1x01 题目大意先瞄一眼题目，这个Hash，和前几天SUCTF那个HASH相似度真高： 12345678910111213141516171819202122232425262728293031323334353">
<meta property="og:type" content="article">
<meta property="og:title" content="25Jan3">
<meta property="og:url" content="http://example.com/2025/01/26/25Jan3/index.html">
<meta property="og:site_name" content="huangx607087&#39;s Blog">
<meta property="og:description" content="huangx607087 1月的切题 30.Introduction一回家就G了，然后休息了几天，两场CTF比赛都没好好看 1.[DASCTF2304] babyhash_revenge1x01 题目大意先瞄一眼题目，这个Hash，和前几天SUCTF那个HASH相似度真高： 12345678910111213141516171819202122232425262728293031323334353">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/1.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/2.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/3.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/4.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/5.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/6.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/7.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/8.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/11.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/10.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/13.png">
<meta property="og:image" content="http://example.com/2025/01/26/25Jan3/14.png">
<meta property="article:published_time" content="2025-01-26T00:12:19.000Z">
<meta property="article:modified_time" content="2025-01-25T15:49:20.760Z">
<meta property="article:author" content="huangx607087">
<meta property="article:tag" content="ExpLog">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2025/01/26/25Jan3/1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>25Jan3 - huangx607087&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>huangx607087</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/friends/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/site/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>更新日志</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="25Jan3"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-01-26 08:12" pubdate>
          2025/01/26 08:12:19 
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          64 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">25Jan3</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="huangx607087-1月的切题-3"><a href="#huangx607087-1月的切题-3" class="headerlink" title="huangx607087 1月的切题 3"></a>huangx607087 1月的切题 3</h1><h2 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0.Introduction"></a>0.Introduction</h2><p>一回家就G了，然后休息了几天，两场CTF比赛都没好好看</p>
<h2 id="1-DASCTF2304-babyhash-revenge"><a href="#1-DASCTF2304-babyhash-revenge" class="headerlink" title="1.[DASCTF2304] babyhash_revenge"></a>1.[DASCTF2304] babyhash_revenge</h2><h3 id="1x01-题目大意"><a href="#1x01-题目大意" class="headerlink" title="1x01 题目大意"></a>1x01 题目大意</h3><p>先瞄一眼题目，这个Hash，和前几天SUCTF那个HASH相似度真高：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socketserver<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> next_prime<br><br>banner = <span class="hljs-string">br&#x27;&#x27;&#x27;</span><br><span class="hljs-string"> _____     ______     ______     ______     ______   ______  </span><br><span class="hljs-string">/\  __-.  /\  __ \   /\  ___\   /\  ___\   /\__  _\ /\  ___\ </span><br><span class="hljs-string">\ \ \/\ \ \ \  __ \  \ \___  \  \ \ \____  \/_/\ \/ \ \  __\ </span><br><span class="hljs-string"> \ \____-  \ \_\ \_\  \/\_____\  \ \_____\    \ \_\  \ \_\   </span><br><span class="hljs-string">  \/____/   \/_/\/_/   \/_____/   \/_____/     \/_/   \/_/   </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>flag = <span class="hljs-string">b&#x27;xxx&#x27;</span><br>n0 = <span class="hljs-number">30798082519452208630254982405300548841337042015746308462162479889627080155514391987610153873334549377764946092629701</span><br>g = <span class="hljs-number">91289086035117540959154051117940771730039965839291520308840839624996039016929</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LCG</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.n = next_prime(<span class="hljs-number">2</span>**<span class="hljs-number">240</span>)<br>        <span class="hljs-variable language_">self</span>.a = getRandomNBitInteger(<span class="hljs-number">85</span>)<br>        <span class="hljs-variable language_">self</span>.seed = randint(<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.n-<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.seed = (<span class="hljs-variable language_">self</span>.seed ** <span class="hljs-number">3</span> * <span class="hljs-variable language_">self</span>.a + randint(-<span class="hljs-number">2</span>**<span class="hljs-number">230</span>, <span class="hljs-number">2</span>**<span class="hljs-number">230</span>) + randint(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>)) % <span class="hljs-variable language_">self</span>.n<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.seed<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gift</span>():<br>    lcg = LCG()<br>    outputs = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>        outputs.append(<span class="hljs-built_in">int</span>(lcg.<span class="hljs-built_in">next</span>()))<br>    <span class="hljs-keyword">return</span> outputs, lcg.a<br><br>gift, a = gift()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">str1,str2</span>):<br>    key = <span class="hljs-built_in">bin</span>(a)[<span class="hljs-number">2</span>:]<br>    test = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key)):<br>        <span class="hljs-keyword">if</span> key[i] == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            test.append(str1[i] == str2[i])<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">all</span>(test)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hash</span>(<span class="hljs-params">msg</span>):<br>    key = <span class="hljs-built_in">bin</span>(a)[<span class="hljs-number">2</span>:]<br>    n = n0<br>    msg = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">ord</span>,msg))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(msg)):<br>        <span class="hljs-keyword">if</span> key[i] == <span class="hljs-string">&#x27;1&#x27;</span>:<br>            n = g * (<span class="hljs-number">2</span> * n + msg[i])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        n = n &amp; ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">383</span>) - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> (n - <span class="hljs-number">0xdeedbeef114514</span>) % (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">100</span>)<br><br>MENU = <span class="hljs-string">br&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;OPTION&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(socketserver.BaseRequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_recvall</span>(<span class="hljs-params">self</span>):<br>        BUFF_SIZE = <span class="hljs-number">2048</span><br>        data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            part = <span class="hljs-variable language_">self</span>.request.recv(BUFF_SIZE)<br>            data += part<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(part) &lt; BUFF_SIZE:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">return</span> data.strip()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, msg, newline=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> newline:<br>                msg += <span class="hljs-string">b&#x27;\n&#x27;</span><br>            <span class="hljs-variable language_">self</span>.request.sendall(msg)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recv</span>(<span class="hljs-params">self, prompt=<span class="hljs-string">b&#x27;SERVER &lt;INPUT&gt;: &#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.send(prompt, newline=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._recvall()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">self</span>):<br>        rounds = <span class="hljs-number">1000</span><br>        pseudo_prime = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(prompt=<span class="hljs-string">b&#x27;[+] Plz Tell Me your number: &#x27;</span>))<br>        <span class="hljs-keyword">if</span> isPrime(pseudo_prime):<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nNo! it&#x27;s a prime, go away!&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rounds):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">pow</span>(randint(<span class="hljs-number">2</span>, pseudo_prime), pseudo_prime - <span class="hljs-number">1</span>, pseudo_prime) != <span class="hljs-number">1</span>:<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nYou failed in round &quot;</span> + <span class="hljs-built_in">str</span>(i + <span class="hljs-number">1</span>).encode() + <span class="hljs-string">b&#x27;, bye~~&#x27;</span>)<br>                <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nCongratulations, you have passed the proof_of_work!\n&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">self</span>):<br>        signal.alarm(<span class="hljs-number">300</span>)<br>        step1 = <span class="hljs-variable language_">self</span>.proof_of_work()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> step1:<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-variable language_">self</span>.send(banner)<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nNew challenge now! Please give me 2 diff strings whose hashes are the same~~&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Here is my gift for you: \n&#x27;</span> + <span class="hljs-built_in">str</span>(gift).encode())<br>        string1 = <span class="hljs-variable language_">self</span>.recv().decode()<br>        string2 = <span class="hljs-variable language_">self</span>.recv().decode()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(string1) &lt; <span class="hljs-number">70</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(string2) &lt; <span class="hljs-number">70</span>:<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nNo! Too short!&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> check(string1,string2):<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nNo! I do not like!&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-keyword">if</span> string1 == string2:<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nNo! They are the same one!&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hash</span>(string1) == <span class="hljs-built_in">hash</span>(string2):<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;\nGood job~ Here you are!&#x27;</span>)<br>            <span class="hljs-variable language_">self</span>.send(flag)<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;\nConnection has been closed.&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.request.close()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    HOST, PORT = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">9999</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;HOST:POST &quot;</span> + HOST+<span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(PORT))<br>    server = ForkedServer((HOST, PORT), Task)<br>    server.allow_reuse_address = <span class="hljs-literal">True</span><br>    server.serve_forever()<br><br></code></pre></td></tr></table></figure>

<h3 id="1x02-解题过程"><a href="#1x02-解题过程" class="headerlink" title="1x02 解题过程"></a>1x02 解题过程</h3><p>首先先过<code>proof_of_work</code>，发现是一个伪素数的测试，要求给一个合数 $n$，但要求随机 $a$ 均满足 $a^{n-1}\equiv 1\pmod n$。很明显的卡米歇尔数。但这边 $a$ 是随机取的，因此这个卡米歇尔数的素因子要比较大，才能保证 $a$ 和 $n$ 互素。</p>
<p>构造方法很简单：若 $6k+1,12k+1,18k+1$ 均为素数，那么 $n&#x3D;(6k+1)(12k+1)(18k+1)$ 为卡米歇尔数，这个其实也在SUCTF那个mathgame中到了，不过那个mathgame第三问不能算个题，因此就没有写在blog中了。因此，当 $k$ 达到 $100$ 位后，$n$ 和 $a$ 不互素的概率是可以忽略不计的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> getrandbits<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findfakePrime</span>():<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>        a=getrandbits(<span class="hljs-number">100</span>)<br>        p,q,r=<span class="hljs-number">6</span>*a+<span class="hljs-number">1</span>,<span class="hljs-number">12</span>*a+<span class="hljs-number">1</span>,<span class="hljs-number">18</span>*a+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span>(isPrime(p)&amp;isPrime(q)&amp;isPrime(r)):<br>            <span class="hljs-keyword">return</span> p*q*r<br>findfakePrime()<br><span class="hljs-comment"># 10s--25s</span><br><span class="hljs-comment"># 148809159554409110476163772315329170997830985215359063220293349706160369860802335922266079601</span><br></code></pre></td></tr></table></figure>

<p>然后看他的Hash函数：很明显，这里有 $a$ 是不知道的，那就需要先把 $a$ 求出来。这边 LCG 的参数为：$y&#x3D;ax^3+b_i$，其中 $b_i$ 为 $230$ 位的随机数，模数为 $240$ 位，给了 $30$ 组数据，求 $a$，这里 $a$ 是 $85$ 位，因此这边相当于一个LCG已知高位，求整个LCG的题。</p>
<p>那么尝试求 $a$ （肯定是三十组数据全用的，这边以三组为例，看个构造过程）</p>
<p><img src="/2025/01/26/25Jan3/1.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<p>对中间矩阵进行LLL，测个界，最终最短向量大概率是 $a$。</p>
<p>有了 $a$ 之后，就可以按照前面那个题的方法，找出一组碰撞，攻击题目中的Hash了。但这边他的要求比较奇怪：如果 $a$ 的对应比特为 $1$，才放入Hash中计算，但又要求 $a$ 对应比特为 $0$ 的位要保持一致，并且要求给出的字符为可见字符。</p>
<p>回顾一下那个题的构造方法：</p>
<p><img src="/2025/01/26/25Jan3/2.png" srcset="/img/loading.gif" lazyload alt="2"></p>
<p>那么直接把SUHash那个找碰撞的函数拿过来用，但注意这边构造的位数为 $a$ 的 $1$ 比特数（大概 $40$ 多），并且找到一组就OK了。</p>
<p>我这边最终构造的结果为：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP</span><br><span class="hljs-attribute">RPPPPTQSPONPPPPPPPPPKPOPOPPOOONPYPNKLNPPOPPPPPQQSQLPPNPPPPPPPQOQOPPPPPPPRRPPSRPPPPPPP</span><br></code></pre></td></tr></table></figure>

<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span> <br>sh=remote(<span class="hljs-string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="hljs-number">26391</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;148809159554409110476163772315329170997830985215359063220293349706160369860802335922266079601&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;[&#x27;</span>)<br>arr=<span class="hljs-built_in">eval</span>(<span class="hljs-string">b&#x27;[&#x27;</span>+sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>p=next_prime(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">240</span>)<br>A=[arr[i]**<span class="hljs-number">3</span>%p <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">29</span>)]<br>B=[arr[<span class="hljs-number">1</span>+i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">29</span>)]<br>M=[[p*(i==j) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>)]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>)]<br>M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>],M[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>**(<span class="hljs-number">230</span>-<span class="hljs-number">85</span>),<span class="hljs-number">2</span>**<span class="hljs-number">230</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">29</span>):<br>    M[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>+i]=A[i]<br>    M[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>+i]=B[i]<br>M=matrix(ZZ,M)<br>M3L=M.LLL()<br>vec=M3L[<span class="hljs-number">0</span>]<br>a=<span class="hljs-built_in">abs</span>(vec[<span class="hljs-number">0</span>])<br><span class="hljs-keyword">assert</span> a%(<span class="hljs-number">2</span>**(<span class="hljs-number">230</span>-<span class="hljs-number">85</span>))==<span class="hljs-number">0</span><br>a=(vec[<span class="hljs-number">0</span>])&gt;&gt;(<span class="hljs-number">230</span>-<span class="hljs-number">85</span>)<br><span class="hljs-built_in">print</span>(a)<br>difflen=<span class="hljs-built_in">bin</span>(a).count(<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-built_in">print</span>(difflen)<br>n0 = <span class="hljs-number">30798082519452208630254982405300548841337042015746308462162479889627080155514391987610153873334549377764946092629701</span><br>g = <span class="hljs-number">91289086035117540959154051117940771730039965839291520308840839624996039016929</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">H</span>(<span class="hljs-params">msg</span>):<br>    key = <span class="hljs-built_in">bin</span>(a)[<span class="hljs-number">2</span>:]<br>    n = n0<br>    msg = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">ord</span>,msg))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(msg)):<br>        <span class="hljs-comment">#print(i)</span><br>        <span class="hljs-keyword">if</span> key[i] == <span class="hljs-string">&#x27;1&#x27;</span>:<br>            n = g * (<span class="hljs-number">2</span> * n + msg[i])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        n = n &amp; ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">383</span>) - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> (n - <span class="hljs-number">0xdeedbeef114514</span>) % (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">100</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getcollision</span>(<span class="hljs-params">n</span>):<br>    M=[[i==j <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>    M[-<span class="hljs-number">1</span>][-<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">128</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        M[i][-<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>**(n-i)*Integer(<span class="hljs-built_in">pow</span>(g,n-i,<span class="hljs-number">2</span>**<span class="hljs-number">128</span>))%(<span class="hljs-number">2</span>**<span class="hljs-number">128</span>)<br>    M=matrix(ZZ,M)<br>    M3L=M.LLL()<br>    vec=[]<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> M3L:<br>        <span class="hljs-keyword">if</span>(v[-<span class="hljs-number">1</span>]==<span class="hljs-number">0</span>):<br>            vec.append(v)<br>    <span class="hljs-keyword">return</span> vec<br>detla=getcollision(difflen)[<span class="hljs-number">0</span>]<br>s=<span class="hljs-built_in">bytes</span>([<span class="hljs-number">80</span>]*<span class="hljs-number">85</span>)<br>t=[<span class="hljs-number">80</span>]*<span class="hljs-number">85</span><br>cur=<span class="hljs-number">0</span><br>table=<span class="hljs-built_in">bin</span>(a)[<span class="hljs-number">2</span>:]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">85</span>):<br>    <span class="hljs-keyword">if</span>(table[i]==<span class="hljs-string">&#x27;1&#x27;</span>):<br>        t[i]+=detla[cur]<br>        cur+=<span class="hljs-number">1</span><br>t=<span class="hljs-built_in">bytes</span>(t)<br><span class="hljs-built_in">print</span>(s)<br><span class="hljs-built_in">print</span>(t)<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(s)<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(t)<br><span class="hljs-built_in">print</span>(sh.recvall(timeout=<span class="hljs-number">500</span>))<br><span class="hljs-comment">#DASCTF&#123;S0rry_But_this_1s_My_revenge&#125;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-DASCTF2410-easy-xor–7solves"><a href="#2-DASCTF2410-easy-xor–7solves" class="headerlink" title="2.[DASCTF2410]easy_xor–7solves"></a>2.[DASCTF2410]easy_xor–7solves</h2><h3 id="2x01-题目大意"><a href="#2x01-题目大意" class="headerlink" title="2x01 题目大意"></a>2x01 题目大意</h3><p>先看眼题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sage</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">msg</span>):<br>    p = getPrime(<span class="hljs-number">256</span>)<br>    n = <span class="hljs-number">2</span>^<span class="hljs-number">512</span><br>    x = msg[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">7</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> msg:<br>        x = <span class="hljs-built_in">int</span>(x*p % n)<br>        x ^^= i<br>    <span class="hljs-keyword">return</span> x ^^ <span class="hljs-built_in">len</span>(msg) ,p<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">prime_to_matrix</span>(<span class="hljs-params">p , n</span>):<br>    <br>    binary_rep = <span class="hljs-built_in">bin</span>(p)[<span class="hljs-number">2</span>:].zfill(n^<span class="hljs-number">2</span>)<br>    matrix = Matrix(GF(<span class="hljs-number">2</span>), n, n, [<span class="hljs-built_in">int</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> binary_rep])<br>    <br>    <span class="hljs-keyword">return</span> matrix<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">matrix_to_prime</span>(<span class="hljs-params">matrix, n</span>):<br><br>    binary_rep = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">str</span>(matrix[i, j]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n))<br>    p = <span class="hljs-built_in">int</span>(binary_rep, <span class="hljs-number">2</span>)<br>    <br>    <span class="hljs-keyword">return</span> p<br><br>key = os.urandom(<span class="hljs-number">16</span>)<br>key_list = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> key]<br>c,p = encrypt(key_list)<br><br>P = prime_to_matrix(p,<span class="hljs-number">16</span>)<br><br>q = getPrime(<span class="hljs-number">256</span>) <br>Q = prime_to_matrix(q,<span class="hljs-number">16</span>)<br><br>R = P*Q<br>r = matrix_to_prime(R,<span class="hljs-number">16</span>)<br><br>s = p^^r<br>S = prime_to_matrix(s,<span class="hljs-number">16</span>)<br><br>array_q = []<br>t = q<br><span class="hljs-keyword">while</span> t &gt; <span class="hljs-number">0</span>:<br>    array_q.append(t%<span class="hljs-number">256</span>)<br>    t = t//<span class="hljs-number">256</span><br><br>m = <span class="hljs-built_in">len</span>(array_q)<br>A = matrix(ZZ,m,m)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span>  <span class="hljs-built_in">range</span>(m):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        A[i,j] = randint(<span class="hljs-number">65537</span>//<span class="hljs-number">2</span>,<span class="hljs-number">65537</span>)<br><br>x = matrix(ZZ,[array_q])<br>x = x.T<br>e = matrix(ZZ,m,<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    e[i,<span class="hljs-number">0</span>] = randint(<span class="hljs-number">1</span>,<span class="hljs-number">256</span>)<br>b = A*x + e  <br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;out.txt&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-string">f&quot;c = <span class="hljs-subst">&#123;c&#125;</span>\n&quot;</span>)<br>    f.write(<span class="hljs-string">f&quot;S = <span class="hljs-subst">&#123;S&#125;</span>\n&quot;</span>)<br>    f.write(<span class="hljs-string">f&quot;A = <span class="hljs-subst">&#123;A&#125;</span>\n&quot;</span>)<br>    f.write(<span class="hljs-string">f&quot;b = <span class="hljs-subst">&#123;b&#125;</span>\n&quot;</span>)<br>    <br>flag = <span class="hljs-string">&quot;CBCTF&#123;&quot;</span>+sha256(key).hexdigest()+<span class="hljs-string">&quot;&#125;&quot;</span><br><br></code></pre></td></tr></table></figure>

<p>题目要求 $key$，为一个长度为 $16$ 的字符串，给出了 <code>c=enc(key,p)</code>，其中 $p$ 为 $256$ 位素数，并生成了另一个 $256$ 位的素数 $q$。</p>
<p>随后将 $p,q$ 逐比特转化为 $P,Q$ 两个 $16\times16$ 的 $\mathbb F_2$ 上矩阵，并计算 $R&#x3D;PQ$，又将 $R$ 逐比特转化为 $256$ 位的数值 $r$，并计算 $s&#x3D;p\oplus r$，最终转化成了矩阵 $S$。</p>
<p>而对于 $q$，又将 $q$ 转化为了 $256$ 进制的形式，得到了 $\vec x$，并最终计算了 $\vec b&#x3D;A\vec x+\vec e$。</p>
<h3 id="2x02-题目分析"><a href="#2x02-题目分析" class="headerlink" title="2x02 题目分析"></a>2x02 题目分析</h3><p>拿到第一步就发现， $\vec b&#x3D;A\vec x+\vec e$ 这一步没有带模数，可以尝试直接解并获得 $q$。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">RF600=RealField(<span class="hljs-number">600</span>)<br>A=matrix(RF600,A)<br>b=vector(RF600,[b[i][<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(b))])<br>x=A.solve_right(b)<br>xreg=[x[i].<span class="hljs-built_in">round</span>() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))]<br>q=<span class="hljs-built_in">sum</span>([xreg[i]*<span class="hljs-number">256</span>**i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xreg))])<br><span class="hljs-built_in">print</span>(q)<br><span class="hljs-comment">#82562676145944350609535127612846198515707028561842371207246482755300888479199</span><br></code></pre></td></tr></table></figure>

<p>拿到 $q$ 之后，那下面就是求 $p$。可以发现，从 $R$ 到 $r$ 再计算 $s&#x3D;p\oplus r$ 这一步骤意义不大，相当于 $\mathbb F_2$ 矩阵计算 $S&#x3D;PQ+P$，也就是 $S&#x3D;P(Q+E)$，那么 $P&#x3D;S(Q+E)^{-1}$ 就能够得到 $p$ 了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">Q=prime_to_matrix(q,<span class="hljs-number">16</span>)<br>E=identity_matrix(GF(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)<br>S=Matrix(GF(<span class="hljs-number">2</span>),S)<br>P=S*(Q+E)**-<span class="hljs-number">1</span><br>p=matrix_to_prime(P,<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-comment">#67257864135528287293221481195193537429491893060495096187717252518567940812773</span><br></code></pre></td></tr></table></figure>

<p>拿到 $p$ 之后，由于已知 key 的长度为 $16$，因此先给 $c$ 异或上 $16$，并且继续将 $\oplus m_i$ 看作 $+\delta_i$ 去推式子（仍然以三位为例）<br>$$<br>c&#x3D;p^2(128p+1)\delta_0+p\delta_1+\delta_2<br>$$<br>由此类推可以得到 $15$ 位的情况，这边就不多说了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">c=<span class="hljs-number">3235165504936419327001182958857604252407894106191511594689199770239529482330201776634335054024549532136197669522057846845936856432300465191006002492337710</span><br>c=c^^<span class="hljs-number">16</span><br>y=[<span class="hljs-built_in">pow</span>(p,i,<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">512</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>)]<br>y=[(-c)%(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">512</span>)]+y+[p**<span class="hljs-number">15</span>*(<span class="hljs-number">128</span>*p+<span class="hljs-number">1</span>)%(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">512</span>)]<br>y=matrix(ZZ,y[::-<span class="hljs-number">1</span>]).T<br>M=block_matrix(ZZ,[<br>    [identity_matrix(<span class="hljs-number">17</span>),y],<br>    [zero_matrix(<span class="hljs-number">1</span>,<span class="hljs-number">17</span>),<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">512</span>]<br>])<br>M3L=M.LLL()<br><span class="hljs-built_in">print</span>(M3L)<br></code></pre></td></tr></table></figure>

<p>但是LLL之后，观察 M3L 的前两行，我们期待的是 $(\delta_0,\delta_1,…,\delta_{15},1,0)$，但却得到了这样两个向量，第二个向量的倒数第三个分量为 $-11$，最后一个分量为 $12$。因此需要将第二个向量的最后一个分量清零，也就是实际的答案为 $\vec v_2-12\vec v_1$。好在幸运的是，这个线性关系还是很显然的，不然如果看出一个不显然的线性关系，又要继续推式子了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">[   <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>]<br>[ <span class="hljs-number">254</span>  -<span class="hljs-number">26</span>  <span class="hljs-number">151</span>  -<span class="hljs-number">81</span>   <span class="hljs-number">47</span> -<span class="hljs-number">159</span> -<span class="hljs-number">145</span>  -<span class="hljs-number">30</span> -<span class="hljs-number">167</span>  -<span class="hljs-number">61</span> -<span class="hljs-number">137</span> -<span class="hljs-number">183</span>  -<span class="hljs-number">85</span>  -<span class="hljs-number">30</span>   <span class="hljs-number">61</span>  -<span class="hljs-number">11</span>    <span class="hljs-number">1</span>   <span class="hljs-number">12</span>]<br></code></pre></td></tr></table></figure>

<p>那么最后就可以得到最终结果了。（xs，为啥这个题只有 7 解，因为太套娃了吗？然后10月考过这个题，12月CISCN又考？）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">vec=M3L[<span class="hljs-number">1</span>]-<span class="hljs-number">12</span>*M3L[<span class="hljs-number">0</span>]<br>s=[vec[<span class="hljs-number">0</span>]]+[-<span class="hljs-number">1</span>]*<span class="hljs-number">15</span><br>mask=(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">512</span>)-<span class="hljs-number">1</span><br>x=<span class="hljs-built_in">int</span>(vec[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">7</span>)<br>x = <span class="hljs-built_in">int</span>(x*p&amp;mask)<br>x ^^= vec[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">16</span>):<br>    x=<span class="hljs-built_in">int</span>((x*p)&amp;mask)<br>    xbar=x+vec[i]<br>    chi=xbar^^x<br>    x=xbar<br>    s[i]=chi<br><span class="hljs-built_in">print</span>(s)<br><span class="hljs-built_in">print</span>(x==c)<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br>flag = <span class="hljs-string">&quot;CBCTF&#123;&quot;</span>+sha256(<span class="hljs-built_in">bytes</span>(s)).hexdigest()+<span class="hljs-string">&quot;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#[254, 42, 175, 177, 83, 227, 179, 34, 255, 67, 137, 185, 245, 230, 197, 107]</span><br><span class="hljs-comment">#True</span><br><span class="hljs-comment">#CBCTF&#123;0d3f156b0c831817e366a437fc80c0e2c14a5e36ebd5c27f9ad835dd9d6a3855&#125;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-DASCTF-2408-ezShamir"><a href="#3-DASCTF-2408-ezShamir" class="headerlink" title="3.[DASCTF 2408] ezShamir"></a>3.[DASCTF 2408] ezShamir</h2><p>题目比较简单，还是先看一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> getrandbits<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256, md5<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shamir</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, pbits, noise_bit, n, m</span>):<br>        <span class="hljs-variable language_">self</span>.pbits = pbits<br>        <span class="hljs-variable language_">self</span>.noise_bit = noise_bit<br>        <span class="hljs-variable language_">self</span>.n = n<br>        <span class="hljs-variable language_">self</span>.m = m<br>        <span class="hljs-variable language_">self</span>.p = getPrime(pbits)<br>        P.&lt;x&gt; = PolynomialRing(Zmod(<span class="hljs-variable language_">self</span>.p))<br>        <span class="hljs-variable language_">self</span>.poly = P([bytes_to_long(sha256(os.urandom(<span class="hljs-number">32</span>)).digest()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n)])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample</span>(<span class="hljs-params">self</span>):<br>        t = getrandbits(<span class="hljs-variable language_">self</span>.pbits)<br>        y = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.poly(t))<br>        noise = getrandbits(noise_bit)<br>        <span class="hljs-keyword">return</span> (t, y | noise)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_msg</span>(<span class="hljs-params">self</span>):<br>        res = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.m):<br>            res.append(<span class="hljs-variable language_">self</span>.sample())<br>        <span class="hljs-keyword">return</span> res<br><br>pbits = <span class="hljs-number">400</span><br>noise_bit = <span class="hljs-number">32</span><br>n = <span class="hljs-number">100</span><br>m = <span class="hljs-number">75</span><br><br>shamir = Shamir(pbits, noise_bit, n, m)<br>coefficient = shamir.poly()<br>key = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(coefficient)[<span class="hljs-number">1</span>:]])<br>key = md5(key.encode()).digest()<br>aes = AES.new(key = key, mode = AES.MODE_ECB)<br>ct = aes.encrypt(pad(flag, <span class="hljs-number">16</span>))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;data.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-built_in">str</span>(shamir.p)+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    f.write(<span class="hljs-built_in">str</span>(shamir.get_msg())+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    f.write(<span class="hljs-built_in">str</span>(bytes_to_long(ct))+<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>题目给出了 $p$ 和 $75$ 组 $(x,y)$，但 $y&#x3D;f(x)$ 的结果由于或上了一个 $32$ 比特的随机数，因此是带有误差的，要求求 $f(x)$ 的系数。</p>
<p>还是将 $f(x) \mathrm{bitor}\space \delta$ 看作 $f(x)+\delta$，那么我们有 $y&#x3D;f(x)+\delta$，也就是 $-\delta &#x3D;f(x)-y$。</p>
<p>那么可以有这样的关系表达式：</p>
<p><img src="/2025/01/26/25Jan3/3.png" srcset="/img/loading.gif" lazyload alt="3"></p>
<p>其中 $V$ 的表示如下（以 $4\times 4$ 为例）：</p>
<p><img src="/2025/01/26/25Jan3/4.png" srcset="/img/loading.gif" lazyload alt="4"></p>
<p>不过注意到，由于 $a$ 是 $256$ 比特， $\delta$ 是 $32$ 比特，因此需要乘一个平衡系数矩阵 $B&#x3D;\mathrm{diag}(\vec 1_{n},2^{256},2^{224}\times \vec {1} _m)$，对 $MB$ 进行LLL，然后LLL之后，再给 $B$ 除掉，找中间值为 $1$ 的那一行就OK。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">1914861180127910915217161496032452354459288330404267938814385633318816795789745430689392291853522228462459760259540145551</span><br>D= <span class="hljs-comment">#75组(x,y=f(x)+delta)</span><br>c=<span class="hljs-number">14058554635665083618818231958810639805770645952778992611953881143316377164307777281092527452513347998950720853358361</span><br>n,m=<span class="hljs-number">100</span>,<span class="hljs-number">75</span><br>V=[]<br>Y=[]<br><span class="hljs-keyword">for</span> x,y <span class="hljs-keyword">in</span> D:<br>    V.append([<span class="hljs-built_in">pow</span>(x,i,p) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)])<br>    Y.append(y)<br>V=Matrix(ZZ,V)<br>Y=Matrix(ZZ,Y)<br>M=block_matrix(ZZ,[<br>    [identity_matrix(n),zero_matrix(n,<span class="hljs-number">1</span>),V.T],<br>    [zero_matrix(<span class="hljs-number">1</span>,n),<span class="hljs-number">1</span>,-Y],<br>    [zero_matrix(m,n),zero_matrix(m,<span class="hljs-number">1</span>),p*identity_matrix(m)]<br>])<br>B=diagonal_matrix([<span class="hljs-number">1</span>]*n+[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">256</span>]+[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">224</span>]*m)<br>M=M*B<br><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out122.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br>f.write(<span class="hljs-built_in">str</span>(datetime.now())+<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-comment">#2025-01-21 22:26:49.809221</span><br><br>M3L=M.LLL()<br>f.write(<span class="hljs-built_in">str</span>(datetime.now())+<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-comment">#2025-01-21 23:57:37.928773</span><br><br>M3L=M3L*B**-<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> M3L:<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(vec[n])==<span class="hljs-number">1</span>):<br>        f.write(<span class="hljs-built_in">str</span>(vec)+<span class="hljs-string">&quot;\n&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>coef=vec[:n]*vec[n]<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256, md5<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br>key = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> coef[<span class="hljs-number">1</span>:]])<br>key = md5(key.encode()).digest()<br>aes = AES.new(key = key, mode = AES.MODE_ECB)<br>f.write(<span class="hljs-built_in">str</span>(aes.decrypt(long_to_bytes(c))))<br>f.close()<br><span class="hljs-comment">#DASCTF&#123;3617af36-7869-6939-3a09-bb8038aea171&#125;\x04\x04\x04\x04</span><br></code></pre></td></tr></table></figure>

<p>挂在服务器上跑的，真没想到 $176\times 176$ 的矩阵要跑 $91$ 分钟（听说flatter只要八分钟）。</p>
<h2 id="4-DASCTF-2203-meet-me-in-the-middle"><a href="#4-DASCTF-2203-meet-me-in-the-middle" class="headerlink" title="4.[DASCTF 2203]meet me in the middle"></a>4.[DASCTF 2203]meet me in the middle</h2><p>题目看着很长，其实也就是一个DSA，每次签名给出  $r,s$ 外，还给出了随机数 $k$ 中间的比特，高 $30$ 比特和低 $30$ 比特被忽略了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">import</span> socketserver<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> DSA<br><br>table = string.ascii_letters + string.digits<br>BANNER = <span class="hljs-string">br&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DigitalSignatureAlgorithm</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key</span>):<br>        <span class="hljs-variable language_">self</span>.p = key.p<br>        <span class="hljs-variable language_">self</span>.q = key.q<br>        <span class="hljs-variable language_">self</span>.g = key.g<br>        <span class="hljs-variable language_">self</span>.y = key.y<br>        <span class="hljs-variable language_">self</span>.x = key.x<br>        <span class="hljs-variable language_">self</span>.k = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">self, m</span>):<br>        k = random.StrongRandom().randint(<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.q - <span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.k.append(k)<br>        h = bytes_to_long(sha256(m).digest())<br>        r = <span class="hljs-built_in">pow</span>(<span class="hljs-variable language_">self</span>.g, k, <span class="hljs-variable language_">self</span>.p) % <span class="hljs-variable language_">self</span>.q<br>        s = inverse(k, <span class="hljs-variable language_">self</span>.q) * (h + <span class="hljs-variable language_">self</span>.x * r) % <span class="hljs-variable language_">self</span>.q<br>        <span class="hljs-keyword">return</span> r, s<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">self, m, signature</span>):<br>        r, s = signature<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">not</span> (<span class="hljs-number">1</span> &lt;= r &lt;= <span class="hljs-variable language_">self</span>.q - <span class="hljs-number">1</span>)) <span class="hljs-keyword">or</span> (<span class="hljs-keyword">not</span> (<span class="hljs-number">1</span> &lt;= s &lt;= <span class="hljs-variable language_">self</span>.q - <span class="hljs-number">1</span>)):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        z = bytes_to_long(sha256(m).digest())<br>        w = inverse(s, <span class="hljs-variable language_">self</span>.q)<br>        u1 = (z * w) % <span class="hljs-variable language_">self</span>.q<br>        u2 = (r * w) % <span class="hljs-variable language_">self</span>.q<br>        v = (<span class="hljs-built_in">pow</span>(<span class="hljs-variable language_">self</span>.g, u1, <span class="hljs-variable language_">self</span>.p) * <span class="hljs-built_in">pow</span>(<span class="hljs-variable language_">self</span>.y, u2, <span class="hljs-variable language_">self</span>.p)) % <span class="hljs-variable language_">self</span>.p % <span class="hljs-variable language_">self</span>.q<br>        <span class="hljs-keyword">return</span> r == v<br><br><br>myDSA = DigitalSignatureAlgorithm(DSA.generate(<span class="hljs-number">1024</span>))<br>MENU = <span class="hljs-string">br&#x27;&#x27;&#x27;</span><br><span class="hljs-string">[1] Sign.</span><br><span class="hljs-string">[2] Verify.</span><br><span class="hljs-string">[3] Get_public_key.</span><br><span class="hljs-string">[4] Get_sth_in_the_middle</span><br><span class="hljs-string">[5] Exit.</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(socketserver.BaseRequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_recvall</span>(<span class="hljs-params">self</span>):<br>        BUFF_SIZE = <span class="hljs-number">2048</span><br>        data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            part = <span class="hljs-variable language_">self</span>.request.recv(BUFF_SIZE)<br>            data += part<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(part) &lt; BUFF_SIZE:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">return</span> data.strip()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, msg, newline=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> newline:<br>                msg += <span class="hljs-string">b&#x27;\n&#x27;</span><br>            <span class="hljs-variable language_">self</span>.request.sendall(msg)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recv</span>(<span class="hljs-params">self, prompt=<span class="hljs-string">b&#x27;[-] &#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.send(prompt, newline=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._recvall()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">self</span>):<br>        proof = (<span class="hljs-string">&#x27;&#x27;</span>.join([random.choice(table) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>)])).encode()<br>        sha = sha256(proof).hexdigest().encode()<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;[+] sha256(XXXX+&quot;</span> + proof[<span class="hljs-number">4</span>:] + <span class="hljs-string">b&quot;) == &quot;</span> + sha)<br>        XXXX = <span class="hljs-variable language_">self</span>.recv(prompt=<span class="hljs-string">b&#x27;[+] Plz Tell Me XXXX :&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(XXXX) != <span class="hljs-number">4</span> <span class="hljs-keyword">or</span> sha256(XXXX + proof[<span class="hljs-number">4</span>:]).hexdigest().encode() != sha:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">self</span>):<br>        m1 = <span class="hljs-string">b&#x27;What you want to know&#x27;</span><br>        m2 = <span class="hljs-string">b&#x27;My dear lone warrior&#x27;</span><br>        signature1 = myDSA.sign(m1)<br>        signature2 = myDSA.sign(m2)<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Your signature1 is:&#x27;</span> + <span class="hljs-built_in">str</span>(signature1).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Your signature2 is:&#x27;</span> + <span class="hljs-built_in">str</span>(signature2).encode())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">self</span>):<br>        m = <span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;message:&#x27;</span>)<br>        r = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;r:&#x27;</span>))<br>        s = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;s:&#x27;</span>))<br>        signature = (r, s)<br>        <span class="hljs-keyword">if</span> m == <span class="hljs-string">b&quot;I&#x27;m Admin.I want flag.&quot;</span>:<br>            <span class="hljs-keyword">if</span> myDSA.verify(m, signature):<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Hello there.This is what you want.&#x27;</span>)<br>                flag = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>).read()<br>                <span class="hljs-variable language_">self</span>.send(flag.encode())<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Who are U?Get out!&#x27;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Who are U?Get out!&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_public_key</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;p = &#x27;</span> + <span class="hljs-built_in">str</span>(myDSA.p).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;q = &#x27;</span> + <span class="hljs-built_in">str</span>(myDSA.q).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;g = &#x27;</span> + <span class="hljs-built_in">str</span>(myDSA.g).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;y = &#x27;</span> + <span class="hljs-built_in">str</span>(myDSA.y).encode())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sth_in_the_middle</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(myDSA.k) == <span class="hljs-number">2</span>:<br>            middle_k0 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(myDSA.k[<span class="hljs-number">0</span>])[<span class="hljs-number">2</span>:][<span class="hljs-number">30</span>:-<span class="hljs-number">30</span>], <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-number">30</span><br>            middle_k1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(myDSA.k[<span class="hljs-number">1</span>])[<span class="hljs-number">2</span>:][<span class="hljs-number">30</span>:-<span class="hljs-number">30</span>], <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-number">30</span><br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;middle_k0&#x27;</span> + <span class="hljs-built_in">str</span>(middle_k0).encode())<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;middle_k1&#x27;</span> + <span class="hljs-built_in">str</span>(middle_k1).encode())<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;The time has not come.&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">self</span>):<br>        signal.alarm(<span class="hljs-number">60</span>)<br>        <span class="hljs-variable language_">self</span>.send(BANNER)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.proof_of_work():<br>            <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Oops,you are wrong. Bye~&#x27;</span>)<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable language_">self</span>.send(MENU)<br>            option = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(prompt=<span class="hljs-string">b&#x27;Give me your option:&#x27;</span>))<br>            <span class="hljs-keyword">if</span> option == <span class="hljs-number">1</span>:<br>                <span class="hljs-variable language_">self</span>.sign()<br>            <span class="hljs-keyword">elif</span> option == <span class="hljs-number">2</span>:<br>                <span class="hljs-variable language_">self</span>.verify()<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> option == <span class="hljs-number">3</span>:<br>                <span class="hljs-variable language_">self</span>.get_public_key()<br>            <span class="hljs-keyword">elif</span> option == <span class="hljs-number">4</span>:<br>                <span class="hljs-variable language_">self</span>.sth_in_the_middle()<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-variable language_">self</span>.request.close()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    HOST, PORT = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">5000</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;HOST:POST &quot;</span> + HOST + <span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(PORT))<br>    server = ForkedServer((HOST, PORT), Task)<br>    server.allow_reuse_address = <span class="hljs-literal">True</span><br>    server.serve_forever()<br><br></code></pre></td></tr></table></figure>



<p>那么看着很显然，就要从 $k$ 泄露的比特入手，我们可以得到线性关系式：<br>$$<br>ks\equiv h+xr\pmod q<br>$$<br>由于是两条消息，那就是 $k_1s_1-xr_1-h_1-u_1q&#x3D;0$ 和 $k_2s_2-xr_2-h_2-u_2q&#x3D;0$</p>
<p>对上面的式子，区分 $z&#x3D;k_H,y&#x3D;k_L$ 和 $k&#x3D;k_M$，也就是：<br>$$<br>2^az+k+y-xr-h-uq&#x3D;0<br>$$<br>注意到 $k$ 在被去掉低 $30$ 位之后，又重新乘上了 $2^{30}$，所以不需要系数。尝试构造线性关系：</p>
<p><img src="/2025/01/26/25Jan3/5.png" srcset="/img/loading.gif" lazyload alt="5"></p>
<p>确定一下平衡系数：$z,y$ 都是 $30$ 位，$x$ 是 $160$ 位，那么 $B&#x3D;\mathrm{diag}(2^{130},2^{130},2^{130},2^{130},1,2^{800},2^{800},2^{160})$ 。两个 $2^{800}$ 是因为对应的位置为 $0$，因此乘上一个大数可以大力出奇迹（bushi），对 上面的矩阵乘上 $B$，LLL 后再除以 $B$ ，然后找最后三个数字为 $0,0,1$ 的向量就是目标向量。</p>
<p>这么做了一下，看着推导的式子没有问题，LLL后除以 $B$ 没有出现分数，说明数量级是对的，但规约出来的向量的前 4 个分量都是 $33\sim35$ 位，和 $30$ 位有所距离。因此，问题应该是出自 $x$ 这里，考虑消掉 $x$。</p>
<p>消 $x$ 可以得到：<br>$$<br>2^{a_1}s_1r_2z_1-2^{a_2}s_2r_1z_2+s_1r_2y_1-s_2r_1y_2+C-uq&#x3D;0<br>$$<br>其中 $C&#x3D;k_1s_1r_2-h_1r_2-k_2s_2r_1+h_2r_1$。因此，我们的式子就简化，并且 $(z_1,z_2,y_1,y_2)$ 均为 $30$ 位，因此平衡系数也可以小一点：</p>
<p><img src="/2025/01/26/25Jan3/6.png" srcset="/img/loading.gif" lazyload alt="6"></p>
<p>这样只需要给第五列乘 $2^{30}$，最后一列乘 $2^{800}$ 即可，我们就可以得到最终的 $z_1,z_2,y_1,y_2$，恢复 $k$ 的所有比特，然后求出私钥 $x$ 并得到最终的签名就OK了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;sdebug&#x27;</span> <br>sh=remote(<span class="hljs-string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="hljs-number">25739</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;sha256(XXXX+&#x27;</span>)<br>s16=sh.recvuntil(<span class="hljs-string">b&#x27;)&#x27;</span>)[:-<span class="hljs-number">1</span>]<br>sh.recvuntil(<span class="hljs-string">b&#x27;==&#x27;</span>)<br>s64=sh.recvline(keepends=<span class="hljs-literal">False</span>).strip()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getyzm</span>(<span class="hljs-params">s16,s64</span>):<br>	table=<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table:<br>		<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> table:<br>			<span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> table:<br>				<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> table:<br>					<span class="hljs-keyword">if</span>(sha256((i+j+k+l+s16).encode()).hexdigest()==s64):<br>						<span class="hljs-keyword">return</span> i+j+k+l<br><span class="hljs-built_in">print</span>(s16)<br><span class="hljs-built_in">print</span>(s64)<br>yzm=getyzm(s16.decode(),s64.decode())<br>sh.sendline(yzm.encode())<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;1&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;s:&#x27;</span>)<br>r1,s1=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>sh.recvuntil(<span class="hljs-string">b&#x27;s:&#x27;</span>)<br>r2,s2=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br><span class="hljs-built_in">print</span>(r1,s1)<br><span class="hljs-built_in">print</span>(r2,s2)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;3&#x27;</span>)<br>arr=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>	sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>	arr.append(<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>)))<br>p,q,g,y=arr<br><span class="hljs-built_in">print</span>(p,q,g,y)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;4&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;middle_k0&#x27;</span>)<br>k1m=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>sh.recvuntil(<span class="hljs-string">b&#x27;middle_k1&#x27;</span>)<br>k2m=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;:040x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(k1m),<span class="hljs-string">&#x27;&#123;:040x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(k2m))<br>a1,a2=k1m.bit_length(),k2m.bit_length()<br>m1 = <span class="hljs-string">b&#x27;What you want to know&#x27;</span><br>m2 = <span class="hljs-string">b&#x27;My dear lone warrior&#x27;</span><br>h1=bytes_to_long(sha256(m1).digest())<br>h2=bytes_to_long(sha256(m2).digest())<br><br><br><br>Ax1=<span class="hljs-number">2</span>**a1*s1*r2%q<br>Ax2=(-<span class="hljs-number">2</span>**a2*s2*r1)%q<br>Ay1=s1*r2%q<br>Ay2=(-s2*r1)%q<br>C=(k1m*s1*r2-h1*r2-k2m*s2*r1+h2*r1)%q<br>K=<span class="hljs-number">2</span>**<span class="hljs-number">500</span><br>M=matrix([<br>	[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,Ax1],<br>	[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,Ax2],<br>	[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,Ay1],<br>	[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,Ay2],<br>	[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,-C],<br>	[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,q],<br>])<br>B=diagonal_matrix([<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">30</span>,<span class="hljs-number">2</span>**<span class="hljs-number">500</span>])<br>M3L=(M*B).LLL()*(B**-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> M3L:<br>	<span class="hljs-keyword">if</span>(vec[-<span class="hljs-number">1</span>]==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">abs</span>(vec[-<span class="hljs-number">2</span>])==<span class="hljs-number">1</span>):<br>		<span class="hljs-keyword">break</span><br>z1,z2,y1,y2=(<span class="hljs-built_in">abs</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> vec[:<span class="hljs-number">4</span>])<br>k1=z1*<span class="hljs-number">2</span>**a1+k1m+y1<br>k2=z2*<span class="hljs-number">2</span>**a2+k2m+y2<br><br>x=(k1*s1-h1)*inverse(r1,q)%q<br>xchk=(k2*s2-h2)*inverse(r2,q)%q<br><span class="hljs-built_in">print</span>(x,xchk)<br><span class="hljs-keyword">assert</span> x==xchk<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(g,x,p)==y<br><br><br>msg=long_to_bytes(<span class="hljs-number">0x49276d2041646d696e2e492077616e7420666c61672e</span>)<br><br>h3=bytes_to_long(sha256(msg).digest())<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;2&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;e:&#x27;</span>)<br>sh.send(msg)<br><span class="hljs-comment">#k=1</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;r:&#x27;</span>)<br>g1=g%p%q<br>sh.sendline(<span class="hljs-built_in">str</span>(g1).encode())<br>sh.recvuntil(<span class="hljs-string">b&#x27;s:&#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>((h3+x*g1)%q).encode())<br><span class="hljs-built_in">print</span>(sh.recvall(timeout=<span class="hljs-number">600</span>))<br></code></pre></td></tr></table></figure>

<p>突然发现，几个DSA翻来覆去就那一个线性关系式，感觉好像开始套路化了，基本都是用这个固定的线性关系式LLL的。。。</p>
<h2 id="5-VNCTF2022-Are-You-Admin-1"><a href="#5-VNCTF2022-Are-You-Admin-1" class="headerlink" title="5.[VNCTF2022] Are You Admin 1"></a>5.[VNCTF2022] Are You Admin 1</h2><p>又是一个DSA：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> secretkey,flag,ezmath_flag<br><span class="hljs-keyword">import</span> socketserver<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(secretkey)) == <span class="hljs-number">169</span><br><br>table = string.ascii_letters+string.digits<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PseudoRandomNumbersGenerators</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,seed1,seed2</span>):<br>        <span class="hljs-variable language_">self</span>.state_a = seed1<br>        <span class="hljs-variable language_">self</span>.state_b = seed2<br>        <span class="hljs-variable language_">self</span>.a = getRandomNBitInteger(<span class="hljs-number">160</span>)<br>        <span class="hljs-variable language_">self</span>.b = getRandomNBitInteger(<span class="hljs-number">160</span>)<br>        <span class="hljs-variable language_">self</span>.c = getRandomNBitInteger(<span class="hljs-number">160</span>)<br>        <span class="hljs-variable language_">self</span>.M = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">512</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">GetNext</span>(<span class="hljs-params">self</span>):<br>        ret = (<span class="hljs-variable language_">self</span>.state_a * <span class="hljs-variable language_">self</span>.a + <span class="hljs-variable language_">self</span>.state_b * <span class="hljs-variable language_">self</span>.b + <span class="hljs-variable language_">self</span>.c) % <span class="hljs-variable language_">self</span>.M<br>        <span class="hljs-variable language_">self</span>.state_a = <span class="hljs-variable language_">self</span>.state_b<br>        <span class="hljs-variable language_">self</span>.state_b = ret<br>        <span class="hljs-keyword">return</span> ret<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">GetSomethingUseful</span>(<span class="hljs-params">self,admin</span>):<br>        <span class="hljs-keyword">if</span> admin == <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.a,<span class="hljs-variable language_">self</span>.b,<span class="hljs-variable language_">self</span>.c<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;You can&#x27;t get anything here!Get out!&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">choice</span>(<span class="hljs-params">self,<span class="hljs-built_in">input</span></span>):<br>        length = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">input</span>)<br>        tmp = <span class="hljs-variable language_">self</span>.GetNext() % length<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>[tmp]<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DigitalSignatureAlgorithm</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,RANDOM</span>):<br>        <span class="hljs-variable language_">self</span>.p = <span class="hljs-number">8945295668911819059540208265461979177678201229057426412681001447446107919117765962027889488459965388254641301806100385155760254966914075104367813869235667</span><br>        <span class="hljs-variable language_">self</span>.q = <span class="hljs-number">4472647834455909529770104132730989588839100614528713206340500723723053959558882981013944744229982694127320650903050192577880127483457037552183906934617833</span><br>        <span class="hljs-variable language_">self</span>.g = <span class="hljs-number">3</span><br>        <span class="hljs-variable language_">self</span>.Random = RANDOM<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">self, m, y, sig</span>):<br>        r, s = sig<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">not</span> (<span class="hljs-number">1</span> &lt;= r &lt;= <span class="hljs-variable language_">self</span>.q - <span class="hljs-number">1</span>)) <span class="hljs-keyword">or</span> (<span class="hljs-keyword">not</span> (<span class="hljs-number">1</span> &lt;= s &lt;= <span class="hljs-variable language_">self</span>.q - <span class="hljs-number">1</span>)): <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        z = bytes_to_long(sha256(m).digest())<br>        w = inverse(s, <span class="hljs-variable language_">self</span>.q)<br>        u1 = (z * w) % <span class="hljs-variable language_">self</span>.q<br>        u2 = (r * w) % <span class="hljs-variable language_">self</span>.q<br>        v = (<span class="hljs-built_in">pow</span>(<span class="hljs-variable language_">self</span>.g, u1, <span class="hljs-variable language_">self</span>.p) * <span class="hljs-built_in">pow</span>(y, u2, <span class="hljs-variable language_">self</span>.p)) % <span class="hljs-variable language_">self</span>.p % <span class="hljs-variable language_">self</span>.q<br>        <span class="hljs-keyword">return</span> r == v<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">self, m , x</span>):<br>        z = bytes_to_long(sha256(m).digest())<br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            k = <span class="hljs-variable language_">self</span>.Random.GetNext() % <span class="hljs-variable language_">self</span>.q <br>            r = <span class="hljs-built_in">pow</span>(<span class="hljs-variable language_">self</span>.g , k, <span class="hljs-variable language_">self</span>.p) % <span class="hljs-variable language_">self</span>.q<br>            s = (inverse(k, <span class="hljs-variable language_">self</span>.q) * (z + x * r)) % <span class="hljs-variable language_">self</span>.q<br>            <span class="hljs-keyword">if</span> (s != <span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> (r != <span class="hljs-number">0</span>) :<br>                <span class="hljs-keyword">return</span> (r, s)<br><br>RANDOM = PseudoRandomNumbersGenerators(getPrime(<span class="hljs-number">120</span>),getPrime(<span class="hljs-number">120</span>))<br>DSA = DigitalSignatureAlgorithm(RANDOM)<br>x = secretkey<br>y = <span class="hljs-built_in">pow</span>(DSA.g,x,DSA.p)<br><br>MENU = <span class="hljs-string">br&#x27;&#x27;&#x27;</span><br><span class="hljs-string">[S]ign.</span><br><span class="hljs-string">[V]erify(or get flag).</span><br><span class="hljs-string">[I]dentify.</span><br><span class="hljs-string">[E]xit.</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(socketserver.BaseRequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_recvall</span>(<span class="hljs-params">self</span>):<br>        BUFF_SIZE = <span class="hljs-number">2048</span><br>        data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            part = <span class="hljs-variable language_">self</span>.request.recv(BUFF_SIZE)<br>            data += part<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(part) &lt; BUFF_SIZE:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">return</span> data.strip()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, msg, newline=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> newline:<br>                msg += <span class="hljs-string">b&#x27;\n&#x27;</span><br>            <span class="hljs-variable language_">self</span>.request.sendall(msg)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recv</span>(<span class="hljs-params">self, prompt=<span class="hljs-string">b&#x27;&#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.send(prompt, newline=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._recvall()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">self</span>):<br>        proof = (<span class="hljs-string">&#x27;&#x27;</span>.join([RANDOM.choice(table)<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)])).encode()<br>        sha = sha256(proof).hexdigest().encode()<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&quot;[+] sha256(XXXX+&quot;</span> + proof[<span class="hljs-number">4</span>:] + <span class="hljs-string">b&quot;) == &quot;</span> + sha )<br>        XXXX = <span class="hljs-variable language_">self</span>.recv(prompt = <span class="hljs-string">b&#x27;[+] Plz Tell Me XXXX :&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(XXXX) != <span class="hljs-number">4</span> <span class="hljs-keyword">or</span> sha256(XXXX + proof[<span class="hljs-number">4</span>:]).hexdigest().encode() != sha:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">self</span>):<br>        m0 = <span class="hljs-string">b&#x27;dawn&#x27;</span><br>        m1 = <span class="hljs-string">b&#x27;whisper&#x27;</span><br>        m2 = <span class="hljs-string">b&#x27;want flag&#x27;</span><br>        sign0 = DSA.sign(m0,x)<br>        sign1 = DSA.sign(m1,x)<br>        sign2 = DSA.sign(m2,x)<br><br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;sign of (dawn) is: &#x27;</span>      + <span class="hljs-built_in">str</span>(sign0).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;sign of (whisper) is: &#x27;</span>   + <span class="hljs-built_in">str</span>(sign1).encode())<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;sign of (want flag) is: &#x27;</span> + <span class="hljs-built_in">str</span>(sign2).encode())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">identify</span>(<span class="hljs-params">self</span>):<br>        rec_key = <span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;flag of ezmath is :&#x27;</span>)<br>        ret = RANDOM.GetSomethingUseful(rec_key == ezmath_flag)<br>        <span class="hljs-variable language_">self</span>.send(<span class="hljs-built_in">str</span>(ret).encode())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">self</span>):<br>        msg = <span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;msg:&#x27;</span>)<br>        r = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;r:&#x27;</span>))<br>        s = <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;s:&#x27;</span>))<br>        sig = (r,s)<br>        <span class="hljs-keyword">if</span> msg == <span class="hljs-string">b&quot;I&#x27;m Admin.Plz give me flag!&quot;</span>:<br>            <span class="hljs-keyword">if</span> DSA.verify(msg,y,sig):<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Yes Sir!Thank you Sir!&#x27;</span>)<br>                <span class="hljs-keyword">return</span> flag<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Who are U?Get out!&#x27;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> DSA.verify(msg,y,sig):<br>                <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Yeah!You sign successfully!&#x27;</span>)<br>                <span class="hljs-keyword">return</span> os.urandom(<span class="hljs-number">32</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">self</span>):<br>        proof = <span class="hljs-variable language_">self</span>.proof_of_work()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> proof:<br>            <span class="hljs-variable language_">self</span>.request.close()<br>        signal.alarm(<span class="hljs-number">60</span>)<br>        chance = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable language_">self</span>.send(MENU)<br>            option = <span class="hljs-variable language_">self</span>.recv(<span class="hljs-string">b&#x27;\n==plz give me your option==\n[IN]:&#x27;</span>)<br>            <span class="hljs-keyword">if</span> option == <span class="hljs-string">b&#x27;S&#x27;</span>:<br>                <span class="hljs-keyword">if</span> chance == <span class="hljs-number">0</span>:<br>                    <span class="hljs-variable language_">self</span>.sign()<br>                    chance += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;ERROR! You only have one time!&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> option == <span class="hljs-string">b&#x27;V&#x27;</span>:<br>                ret = <span class="hljs-variable language_">self</span>.verify()<br>                <span class="hljs-keyword">if</span> ret :<br>                    <span class="hljs-variable language_">self</span>.send(<span class="hljs-string">b&#x27;Your Flag is :&#x27;</span> + ret)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> option == <span class="hljs-string">b&#x27;I&#x27;</span>:<br>                <span class="hljs-variable language_">self</span>.identify()<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-variable language_">self</span>.request.close()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    HOST, PORT = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">10004</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;HOST:POST &quot;</span> + HOST+<span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(PORT))<br>    server = ForkedServer((HOST, PORT), Task)<br>    server.allow_reuse_address = <span class="hljs-literal">True</span><br>    server.serve_forever() <br><br></code></pre></td></tr></table></figure>

<p>从题目中可以得到的信息为：私钥 $x$ 为 $167$ 比特，随机数 $k$ 为 LCG 生成，其表达式为 $x_2&#x3D;ax_0+bx_1+c$，题目会给出 $3$ 条内容的签名结果。</p>
<p>不过需要注意的是，LCG 的模数为 $2^{512}$，而 $q$ 为 $511$ 位素数。 $x_0,x_1$ 两个种子值为 $120$ 位，$a,b,c$ 系数为 $160$ 位，那么我们可以分析出：$k_0,k_1$ 的数量级分别为 $2^{281},2^{441}$ ，而 $k_2$ 经过了取模，并且使用时还经历了两次取模，先模 $2^{512}$ 再模 $q$。不过好在，由于 $q$ 是 $511$ 位素数，这就意味着对 $2^{512}$ 取模后，最多只会减去 $2$ 个 $q$。</p>
<p>题目中的 $a,b,c$ 其实是给出的，那个验证的flag题目给出了，可以忽略这一部分。</p>
<p>那么做了这么多DSA了，里面线性关系式，还是很明显的：我们有三组 $k_is_i-xr_i-u_iq&#x3D;h_i$，其中 $i&#x3D;0,1,2$ 。和一组 $ak_0+bk_1+c-2^{512}u_3-u_4q&#x3D;0$ 。其中 $u_4$ 取值为 $0,1,2$。那么可以构造一个 $9\times9$ 的线性关系矩阵，乘上平衡系数，就OK了。</p>
<p>然后LLL没得到任何结果，调了 $k_{0,1,2}$ 的数量级也没啥用。但线性关系肯定是没问题的，一个很普通的DSA，你还能有别的线性关系吗？</p>
<p>卡了3h，然后看到了这个：<a target="_blank" rel="noopener" href="https://tanglee.top/2022/02/12/VNCTF2022-Crypto-WriteUp/">VNCTF2022 Crypto WriteUp | tl2cents blog (tanglee.top)</a>，发现这个题要用CVP解。因为线性关系就那么一个，解不出来说明目标向量并非短向量，但如果能够抓住目标向量的显著特征，那么可以考虑CVP，其构造的矩阵是这样的（LLL前需要转置一下，因为Sage是行向量）</p>
<p><img src="/2025/01/26/25Jan3/7.png" srcset="/img/loading.gif" lazyload alt="7"></p>
<p>可以发现他这边的平衡系数很有意思：我们刚才分析了，他这个 $n_5$ 相当于我上面的 $u_5$，其取值只有 $0,1,2$，数量级为 $2$，而$x,k_0,k_1,k_2$ 的数量级分别为 $2^{169},q,q,q$，（P.S. $x$ 的数量级为 $2^{167}$），因此这样平衡之后，其他的数值就基本为 $1$ 了。</p>
<p>此外，LLL之后，向量之间有不错的正交性，因此CVP可以通过简单的舍入法去调整，我们只需要求出格中距离 $(h_0,h_1,h_2,-c,1,1,1,1,1)$ 最近的向量就OK了，得到的向量中可能有私钥 $x$。</p>
<p>本地测了一波，测试使用的私钥为：<br>$$<br>x&#x3D;174847216550444586801265996907385021425341123437671<br>$$<br>这是一个素数。如果LLL能够直接得到私钥，那么根据素数的性质和Sage中基本都用分数表示的特点，我们可以在LLL后，在矩阵中直接得到私钥 $x$，但测试后发现，LLL的结果找不到私钥 $x$。</p>
<p><img src="/2025/01/26/25Jan3/8.png" srcset="/img/loading.gif" lazyload alt="8"></p>
<p>而求CVP的函数也很简单，就是再来一次施密特正交化，对于目标向量 $\vec w$ 和格中向量 $\vec g$，每次对 $\vec w$ 减去 $\left\lfloor\dfrac{\vec w\cdot \vec g}{\vec g^2}\right\rceil \vec g$ 即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">BabaisClosestPlaneAlgorithm</span>(<span class="hljs-params">L, w</span>):<br>    G, _ = L.gram_schmidt()<br>    t = w<br>    i = L.nrows() - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> i &gt;= <span class="hljs-number">0</span>:<br>        w -= <span class="hljs-built_in">round</span>((w*G[i]) / G[i].norm() ** <span class="hljs-number">2</span>) * L[i]<br>        i -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> t - w<br></code></pre></td></tr></table></figure>

<p>在得到这个之后，那么最后解题也就不难了，感觉这个题难点就是CVP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>sh=remote(<span class="hljs-string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="hljs-number">25626</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;sha256(XXXX+&#x27;</span>)<br>s16=sh.recvuntil(<span class="hljs-string">b&#x27;)&#x27;</span>)[:-<span class="hljs-number">1</span>]<br>sh.recvuntil(<span class="hljs-string">b&#x27;==&#x27;</span>)<br>s64=sh.recvline(keepends=<span class="hljs-literal">False</span>).strip()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getyzm</span>(<span class="hljs-params">s16,s64</span>):<br>	table=<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table:<br>		<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> table:<br>			<span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> table:<br>				<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> table:<br>					<span class="hljs-keyword">if</span>(sha256((i+j+k+l+s16).encode()).hexdigest()==s64):<br>						<span class="hljs-keyword">return</span> i+j+k+l<br><span class="hljs-built_in">print</span>(s16)<br><span class="hljs-built_in">print</span>(s64)<br>yzm=getyzm(s16.decode(),s64.decode())<br>sh.sendline(yzm.encode())<br>sh.recvuntil(<span class="hljs-string">b&#x27;[IN]:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;I&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;vnctf&#123;m4th_5tr#c7Ur3_c4n_b3_e@s&amp;!&#125;&#x27;</span>)<br>a,b,c=<span class="hljs-built_in">eval</span>(sh.recvline())<br>sh.recvuntil(<span class="hljs-string">b&#x27;[IN]:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;S&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;is:&#x27;</span>)<br>r1,s1=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>).strip())<br>sh.recvuntil(<span class="hljs-string">b&#x27;is:&#x27;</span>)<br>r2,s2=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>).strip())<br>sh.recvuntil(<span class="hljs-string">b&#x27;is:&#x27;</span>)<br>r3,s3=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>).strip())<br>q=<span class="hljs-number">4472647834455909529770104132730989588839100614528713206340500723723053959558882981013944744229982694127320650903050192577880127483457037552183906934617833</span><br>m1 = <span class="hljs-string">b&#x27;dawn&#x27;</span><br>m2 = <span class="hljs-string">b&#x27;whisper&#x27;</span><br>m3 = <span class="hljs-string">b&#x27;want flag&#x27;</span><br>h1,h2,h3=[bytes_to_long(sha256(i).digest()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [m1,m2,m3]]<br><span class="hljs-built_in">print</span>(h1,h2,h3)<br>M = matrix(<br>    [<br>        [-r1, s1,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,  q, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [-r2,  <span class="hljs-number">0</span>, s2,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, q, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [-r3,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,  s3,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, q, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>,  a,  b,  -<span class="hljs-number">1</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>**<span class="hljs-number">512</span>,q],<br>        [Rational(<span class="hljs-string">f&#x27;2/<span class="hljs-subst">&#123;<span class="hljs-number">2</span>**<span class="hljs-number">169</span>&#125;</span>&#x27;</span>),  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>, Rational(<span class="hljs-string">f&#x27;2/<span class="hljs-subst">&#123;q&#125;</span>&#x27;</span>),  <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, Rational(<span class="hljs-string">f&#x27;2/<span class="hljs-subst">&#123;q&#125;</span>&#x27;</span>),   <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, Rational(<span class="hljs-string">f&#x27;2/<span class="hljs-subst">&#123;q&#125;</span>&#x27;</span>),  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br>    ]).T<br><br><br>M=matrix(M)<br>M3L=M.LLL()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">BabaisClosestPlaneAlgorithm</span>(<span class="hljs-params">L, w</span>):<br>    G, _ = L.gram_schmidt()<br>    t = w<br>    i = L.nrows() - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> i &gt;= <span class="hljs-number">0</span>:<br>        w -= <span class="hljs-built_in">round</span>((w*G[i]) / G[i].norm() ** <span class="hljs-number">2</span>) * L[i]<br>        i -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> t - w<br><br><br>C = vector([h1, h2, h3, -c, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>])  <span class="hljs-comment"># target vector</span><br>A = BabaisClosestPlaneAlgorithm(M3L, C)<br><span class="hljs-built_in">print</span>(A)<br>x = A[<span class="hljs-number">4</span>] / Rational(<span class="hljs-string">f&#x27;2/<span class="hljs-subst">&#123;<span class="hljs-number">2</span>**<span class="hljs-number">169</span>&#125;</span>&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(x)<br>g=<span class="hljs-number">3</span><br>k=<span class="hljs-number">1</span><br>r=g<br>msg=<span class="hljs-string">b&quot;I&#x27;m Admin.Plz give me flag!&quot;</span><br>h=bytes_to_long(sha256(msg).digest())<br>s=((h + x * r))% q<br>sh.recvuntil(<span class="hljs-string">b&#x27;[IN]:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">b&#x27;V&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">b&#x27;msg:&#x27;</span>)<br>sh.sendline(msg)<br>sh.recvuntil(<span class="hljs-string">b&#x27;r:&#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(r).encode())<br>sh.recvuntil(<span class="hljs-string">b&#x27;s:&#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(s).encode())<br><span class="hljs-built_in">print</span>(sh.recvall(timeout=<span class="hljs-number">500</span>))<br><span class="hljs-comment">#print(s)</span><br><span class="hljs-comment">#print(M3L)</span><br><span class="hljs-comment">#sh.interactive()</span><br></code></pre></td></tr></table></figure>



<h2 id="6-VNCTF2022-crypto-sign-in-4"><a href="#6-VNCTF2022-crypto-sign-in-4" class="headerlink" title="6.[VNCTF2022] crypto_sign_in_4"></a>6.[VNCTF2022] crypto_sign_in_4</h2><p>先看一眼题目：</p>
<p>题目给出了素数 $p$，其中 $2$ 在 $\mathbb F_p$ 的阶为素数，然后题目允许你选择一个 $m$，然后回给你返回 $c_1&#x3D;2^x$ 和 $c_2&#x3D;2^{mx}$，其中 $x$ 未知。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> getrandbits<br><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> *<br>welcome=<span class="hljs-string">&quot;Welcome to VNCTF 2023!Hope you can enjoy this challenge!&quot;</span><br>description=<span class="hljs-string">&#x27;&#x27;&#x27;These days DengFeng want to provide a surprise for Deebato.\n</span><br><span class="hljs-string">So he come up with an idea...\n</span><br><span class="hljs-string">That is...\n</span><br><span class="hljs-string">Designing a DLP!\n</span><br><span class="hljs-string">Namely Deebato Love Problem!&#x27;&#x27;&#x27;</span><br>begin=<span class="hljs-string">&#x27;&#x27;&#x27;So let&#x27;s go!\n</span><br><span class="hljs-string">In 1997, I learned to drive a car...\n&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(welcome)<br>    <span class="hljs-built_in">print</span>(description)<br>    <span class="hljs-built_in">print</span>(begin)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>():<br>    a=<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        p=getPrime(<span class="hljs-number">90</span>)<br>        order=GF(p)(a).multiplicative_order()<br>        <span class="hljs-keyword">if</span> isPrime(<span class="hljs-built_in">int</span>(order)):<br>            <span class="hljs-keyword">return</span> a,p,order<br>            <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_msg</span>(<span class="hljs-params">m,a,p,order</span>):<br>    secret=getrandbits(<span class="hljs-number">85</span>)<br>    c1=<span class="hljs-built_in">pow</span>(a,secret,p)<br>    c2=<span class="hljs-built_in">pow</span>(a,<span class="hljs-built_in">pow</span>(secret,m,order),p)<br>    <span class="hljs-keyword">return</span> secret,c1,c2<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    alarm(<span class="hljs-number">300</span>)<br>    hello()<br>    a,p,order=gen()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OOOOOOh!I will give you something useful!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;a = <span class="hljs-subst">&#123;a&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;p = <span class="hljs-subst">&#123;p&#125;</span>&quot;</span>)<br>    m=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please give me your choice:&quot;</span>))<br>    secret,c1,c2=get_msg(m,a,p,order)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OK,here is my gift.&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c1 = <span class="hljs-subst">&#123;c1&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c2 = <span class="hljs-subst">&#123;c2&#125;</span>&quot;</span>)<br>    ticket=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please give me the secret:&quot;</span>))<br>    <span class="hljs-keyword">if</span> ticket==secret:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OKOK,it seems that you know Deebato Love Problem well.Here is my flag&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;flag&#123;&#x27;</span>+<span class="hljs-built_in">str</span>(uuid4())+<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry!You don&#x27;t understand Deebato Love Problem not at all!I can&#x27;t give you flag!&quot;</span>)<br><br><br><span class="hljs-keyword">try</span>:<br>    main()<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error : <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>



<p>题目还给出了提示：</p>
<blockquote>
<p>Hint1: cheon discrete log attack</p>
</blockquote>
<p>根据关键词 Google 了一圈，发现 eprint 上编号为 2008-300 的论文给出了算法：</p>
<p><img src="/2025/01/26/25Jan3/11.png" srcset="/img/loading.gif" lazyload alt="11"></p>
<p>不过需要注意的是：这里 $P$ 是椭圆曲线上的点，而我们这边是乘法群上的运算，因此 $\alpha P$ 应该写为 $2^\alpha$，然后 $p$ 在算法中表示的是 $P$ 的阶数，但题目中 $p$ 是模数，$2$ 在 $\mathbb F_p$ 上的阶为素数，在这里我们设 $2$ 在 $\mathbb F_p$ 上的阶为 $q$。</p>
<p>那么在实际编程的时候， 上面所有的 $p$ 都要换成 $q$，$P$ 换成 $2$，$P_1,P_2$ 对应 $c_1,c_2$。因此，我们需要在 $\mathbb F_q$ 上找到原根 $g$，且将 $q-1$ 尽可能地分解成两个近似相等的数值（不一定是素数），其中一个作为 $d$，用于BSGS。 $p$ 是 $90$ 位，$q$ 可能略低于 $90$ 位，那么这样算下来，复杂度大概就在 $2^{22}$ 左右了，题目的限时为 5 分钟，基本可以接受。</p>
<p>并且，$q$ 长度不超过 $90$ 意味着我们可以高效对 $q -1$ 分解来获取 $d$，以及寻找 $q$ 的原根。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">findd</span>(<span class="hljs-params">x</span>):<br>    L=[]<br>    fcp=<span class="hljs-built_in">list</span>(factor(x-<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">for</span> u,v <span class="hljs-keyword">in</span> fcp:<br>        L=L+v*[u]<br>    xbits=x.nbits()<br>    bound=xbits&gt;&gt;<span class="hljs-number">1</span><br>    d=Integer(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> L:<br>        dbits=d.nbits()<br>        dibits=(d*i).nbits()<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(dbits-bound)&lt;<span class="hljs-built_in">abs</span>(dibits-bound)):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;factor 1: of <span class="hljs-subst">&#123;dbits&#125;</span>/<span class="hljs-subst">&#123;xbits&#125;</span> bits:<span class="hljs-subst">&#123;d&#125;</span>&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;factor 2: of <span class="hljs-subst">&#123;((x-<span class="hljs-number">1</span>)//d).nbits()&#125;</span>/<span class="hljs-subst">&#123;xbits&#125;</span> bits:<span class="hljs-subst">&#123;(x-<span class="hljs-number">1</span>)//d&#125;</span>&#x27;</span>)<br>            <span class="hljs-keyword">return</span> d,(x-<span class="hljs-number">1</span>)//d,dbits,((x-<span class="hljs-number">1</span>)//d).nbits()<br>        <span class="hljs-keyword">else</span>:<br>            d=d*i<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findgen</span>(<span class="hljs-params">prime</span>):<br>    <span class="hljs-keyword">assert</span> isPrime(prime)<br>    g=<span class="hljs-number">1</span><br>    fcp=<span class="hljs-built_in">list</span>(factor(prime-<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>        g=g+<span class="hljs-number">1</span><br>        res=<span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> x,_ <span class="hljs-keyword">in</span> fcp:<br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">pow</span>(g,(prime-<span class="hljs-number">1</span>)//x,prime)==<span class="hljs-number">1</span>):<br>                res=<span class="hljs-literal">False</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span>(res==<span class="hljs-literal">True</span>):<br>            <span class="hljs-keyword">return</span> g<br>sh.recvuntil(<span class="hljs-string">b&#x27;a =&#x27;</span>)<br>a=<span class="hljs-built_in">eval</span>(sh.recvline())<br>sh.recvuntil(<span class="hljs-string">b&#x27;p =&#x27;</span>)<br>p=<span class="hljs-built_in">eval</span>(sh.recvline())<br><span class="hljs-built_in">print</span>(a,p)<br>q=GF(p)(a).multiplicative_order()<br>d,_,bits1,bits2=findd(q)<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">max</span>(bits1,bits2)&gt;<span class="hljs-number">47</span>):<br>    sh.close()<br>    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;Find bits <span class="hljs-subst">&#123;<span class="hljs-built_in">max</span>(bits1,bits2)&#125;</span> that exceed 47!&quot;</span>)<br>g0=findgen(q)<br></code></pre></td></tr></table></figure>

<p>然后就是两个 BSGS 了，注意 BSGS 存入字典的方式，别存倒了就OK！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#BSGS1</span><br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br>D=<span class="hljs-built_in">dict</span>()<br>ginv=<span class="hljs-built_in">pow</span>(g,q-<span class="hljs-number">2</span>,q)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d1)):<br>    u=i<br>    v=<span class="hljs-built_in">pow</span>(c2,<span class="hljs-built_in">pow</span>(ginv,i,q),p)<br>    D[v]=u<br>u1,v1=<span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d1)):<br>    v=<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-built_in">pow</span>(g,d1*i,q),p)<br>    <span class="hljs-keyword">if</span>(D.get(v,<span class="hljs-literal">None</span>)):<br>        u1,v1=D.get(v,<span class="hljs-literal">None</span>),i<br>        <span class="hljs-built_in">print</span>(u1,v1)<br>        <span class="hljs-keyword">break</span><br><span class="hljs-comment">#BSGS2</span><br>k0=d1*v1+u1<br>d2=<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>+sqrt(d).n())<br>D=<span class="hljs-built_in">dict</span>()<br>g0inv=<span class="hljs-built_in">pow</span>(g0,q-<span class="hljs-number">2</span>,q)<br>p1divd=(p-<span class="hljs-number">1</span>)//d<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d2)):<br>    u=i<br>    v=<span class="hljs-built_in">pow</span>(c1,<span class="hljs-built_in">pow</span>(g0inv,u*p1divd,q),p)<br>    D[v]=u<br>u2,v2=<span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d2)):<br>    v=<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-built_in">pow</span>(g0,k0+d2*i*p1divd,q),p)<br>    <span class="hljs-keyword">if</span>(D.get(v,<span class="hljs-literal">None</span>)):<br>        u2,v2=D.get(v,<span class="hljs-literal">None</span>),i<br>        <span class="hljs-built_in">print</span>(u2,v2)<br>        <span class="hljs-keyword">break</span><br>ans=<span class="hljs-built_in">pow</span>(g0,k0+(d2*v2+u2)*p1divd,q)<br></code></pre></td></tr></table></figure>

<p>由于远程环境G了，那么就本地测一下，这里可以多次尝试，确保 $q-1$ 被均匀分解，如果做不到可以重连换一组数据。 </p>
<p>当然，也可以多次自动重连，直到成功再结束程序，平均下来，大概尝试 20 次能有一次成功（不知为啥，发现有的时候在最后一步也不一定成功）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27; </span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findd</span>(<span class="hljs-params">x</span>):<br>    L=[]<br>    fcp=<span class="hljs-built_in">list</span>(factor(x-<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">for</span> u,v <span class="hljs-keyword">in</span> fcp:<br>        L=L+v*[u]<br>    xbits=x.nbits()<br>    bound=xbits&gt;&gt;<span class="hljs-number">1</span><br>    d=Integer(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> L:<br>        dbits=d.nbits()<br>        dibits=(d*i).nbits()<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(dbits-bound)&lt;<span class="hljs-built_in">abs</span>(dibits-bound)):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;factor 1: of <span class="hljs-subst">&#123;dbits&#125;</span>/<span class="hljs-subst">&#123;xbits&#125;</span> bits:<span class="hljs-subst">&#123;d&#125;</span>&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;factor 2: of <span class="hljs-subst">&#123;((x-<span class="hljs-number">1</span>)//d).nbits()&#125;</span>/<span class="hljs-subst">&#123;xbits&#125;</span> bits:<span class="hljs-subst">&#123;(x-<span class="hljs-number">1</span>)//d&#125;</span>&#x27;</span>)<br>            <span class="hljs-keyword">return</span> d,(x-<span class="hljs-number">1</span>)//d,dbits,((x-<span class="hljs-number">1</span>)//d).nbits()<br>        <span class="hljs-keyword">else</span>:<br>            d=d*i<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findgen</span>(<span class="hljs-params">prime</span>):<br>    <span class="hljs-keyword">assert</span> isPrime(prime)<br>    g=<span class="hljs-number">1</span><br>    fcp=<span class="hljs-built_in">list</span>(factor(prime-<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>        g=g+<span class="hljs-number">1</span><br>        res=<span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> x,_ <span class="hljs-keyword">in</span> fcp:<br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">pow</span>(g,(prime-<span class="hljs-number">1</span>)//x,prime)==<span class="hljs-number">1</span>):<br>                res=<span class="hljs-literal">False</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span>(res==<span class="hljs-literal">True</span>):<br>            <span class="hljs-keyword">return</span> g<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">sh</span>):<br>    <br>    sh.recvuntil(<span class="hljs-string">b&#x27;a =&#x27;</span>)<br>    a=<span class="hljs-built_in">eval</span>(sh.recvline())<br>    sh.recvuntil(<span class="hljs-string">b&#x27;p =&#x27;</span>)<br>    p=<span class="hljs-built_in">eval</span>(sh.recvline())<br>    <span class="hljs-built_in">print</span>(a,p)<br>    q=GF(p)(a).multiplicative_order()<br>    <br>            <br>    d,_,bits1,bits2=findd(q)<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">max</span>(bits1,bits2)&gt;=<span class="hljs-number">47</span>):<br>        sh.close()<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;Find bits <span class="hljs-subst">&#123;<span class="hljs-built_in">max</span>(bits1,bits2)&#125;</span> that exceed 47!&quot;</span>)<br>    sh.recvuntil(<span class="hljs-string">b&#x27;ce:&#x27;</span>)<br>    sh.sendline(<span class="hljs-built_in">str</span>(d).encode())<br>    sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>    c1=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>    sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>    c2=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>    <span class="hljs-built_in">print</span>(c1,c2)<br>    g0=findgen(q)<br>    g=<span class="hljs-built_in">pow</span>(g0,d,q)<br>    d1=(sqrt((q-<span class="hljs-number">1</span>)/d))<br>    d1=<span class="hljs-built_in">int</span>(d1.n()+<span class="hljs-number">0.5</span>)<br>    <span class="hljs-comment">#---------BSGS1---------</span><br>    D=<span class="hljs-built_in">dict</span>()<br>    ginv=<span class="hljs-built_in">pow</span>(g,q-<span class="hljs-number">2</span>,q)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d1)):<br>        u=i<br>        v=<span class="hljs-built_in">pow</span>(c2,<span class="hljs-built_in">pow</span>(ginv,i,q),p)<br>        D[v]=u<br>    u1,v1=<span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d1)):<br>        v=<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-built_in">pow</span>(g,d1*i,q),p)<br>        <span class="hljs-keyword">if</span>(D.get(v,<span class="hljs-literal">None</span>)):<br>            u1,v1=D.get(v,<span class="hljs-literal">None</span>),i<br>            <span class="hljs-built_in">print</span>(u1,v1)<br>            <span class="hljs-keyword">break</span><br>    k0=d1*v1+u1<br>    d2=<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>+sqrt(d).n())<br>    D=<span class="hljs-built_in">dict</span>()<br>    g0inv=<span class="hljs-built_in">pow</span>(g0,q-<span class="hljs-number">2</span>,q)<br>    p1divd=(p-<span class="hljs-number">1</span>)//d<br>    <span class="hljs-comment">#---------BSGS2---------</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d2)):<br>        u=i<br>        v=<span class="hljs-built_in">pow</span>(c1,<span class="hljs-built_in">pow</span>(g0inv,u*p1divd,q),p)<br>        D[v]=u<br>    u2,v2=<span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(d2)):<br>        v=<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-built_in">pow</span>(g0,k0+d2*i*p1divd,q),p)<br>        <span class="hljs-keyword">if</span>(D.get(v,<span class="hljs-literal">None</span>)):<br>            u2,v2=D.get(v,<span class="hljs-literal">None</span>),i<br>            <span class="hljs-built_in">print</span>(u2,v2)<br>            <span class="hljs-keyword">break</span><br>    ans=<span class="hljs-built_in">pow</span>(g0,k0+(d2*v2+u2)*p1divd,q)<br>    <br>    sh.sendline(<span class="hljs-built_in">str</span>(ans).encode())<br>    <span class="hljs-built_in">print</span>(sh.recvall(timeout=<span class="hljs-number">600</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run2</span>():<br>    sh=<span class="hljs-literal">None</span><br>    <span class="hljs-keyword">try</span>:<br>        sh=process([<span class="hljs-string">&#x27;sage&#x27;</span>,<span class="hljs-string">&#x27;task9.sage&#x27;</span>])<br>        run(sh)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">except</span>:<br>        sh.close()<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>Tim=<span class="hljs-number">0</span><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>    Tim+=<span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Running on <span class="hljs-subst">&#123;Tim&#125;</span>th time&#x27;</span>)<br>    <span class="hljs-keyword">if</span>(run2()):<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p><img src="/2025/01/26/25Jan3/10.png" srcset="/img/loading.gif" lazyload alt="10"></p>
<p>这种论文题，感觉主要还是论文实现。</p>
<h2 id="9-总结"><a href="#9-总结" class="headerlink" title="9.总结"></a>9.总结</h2><p>BUU继续上分ing，当年自己最高好像是Crypto区第 6 来着？然后两年没打，跌到了 35，寒假才重新回来继续打，上到了 15 名！</p>
<p>xs，这时间跨度，也没谁了</p>
<p><img src="/2025/01/26/25Jan3/13.png" srcset="/img/loading.gif" lazyload alt="13"></p>
<p>还有，Explore MT19937 经过 3 年半，更新了一些内容，补充了任意 19937 个比特的情况，具体请访问那篇博文内容。</p>
<p><img src="/2025/01/26/25Jan3/14.png" srcset="/img/loading.gif" lazyload alt="14"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTFSeason4/" class="category-chain-item">CTFSeason4</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ExpLog/" class="print-no-link">#ExpLog</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>25Jan3</div>
      <div>http://example.com/2025/01/26/25Jan3/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>huangx607087</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年1月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/01/ECCNotes4/" title="ECCNotes4">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ECCNotes4</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/01/15/25Jan2/" title="25Jan2">
                        <span class="hidden-mobile">25Jan2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
