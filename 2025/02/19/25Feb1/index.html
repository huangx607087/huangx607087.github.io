

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="huangx607087">
  <meta name="keywords" content="">
  
    <meta name="description" content="huangx607087 2月的切题 10.Introduction近期遇到了几个比较有意思的题目，来看一看！ 顺便挂三个令我废透脑筋的题目 1.DASCTF2408-ezSignin1x01 题目简单分析先来看一下题目： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484">
<meta property="og:type" content="article">
<meta property="og:title" content="25Feb1">
<meta property="og:url" content="http://example.com/2025/02/19/25Feb1/index.html">
<meta property="og:site_name" content="huangx607087&#39;s Blog">
<meta property="og:description" content="huangx607087 2月的切题 10.Introduction近期遇到了几个比较有意思的题目，来看一看！ 顺便挂三个令我废透脑筋的题目 1.DASCTF2408-ezSignin1x01 题目简单分析先来看一下题目： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/1.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/2.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/2b.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/2c.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/2d.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/3.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/12.png">
<meta property="og:image" content="http://example.com/2025/02/19/25Feb1/13.png">
<meta property="article:published_time" content="2025-02-19T05:50:36.000Z">
<meta property="article:modified_time" content="2025-02-19T08:07:53.946Z">
<meta property="article:author" content="huangx607087">
<meta property="article:tag" content="ExpLog">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2025/02/19/25Feb1/1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>25Feb1 - huangx607087&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>huangx607087</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/friends/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/site/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>更新日志</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="25Feb1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-19 13:50" pubdate>
          2025/02/19 13:50:36 
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          56 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">25Feb1</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="huangx607087-2月的切题-1"><a href="#huangx607087-2月的切题-1" class="headerlink" title="huangx607087 2月的切题 1"></a>huangx607087 2月的切题 1</h1><h2 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0.Introduction"></a>0.Introduction</h2><p>近期遇到了几个比较有意思的题目，来看一看！</p>
<p><del>顺便挂三个令我废透脑筋的题目</del></p>
<h2 id="1-DASCTF2408-ezSignin"><a href="#1-DASCTF2408-ezSignin" class="headerlink" title="1.DASCTF2408-ezSignin"></a>1.DASCTF2408-ezSignin</h2><h3 id="1x01-题目简单分析"><a href="#1x01-题目简单分析" class="headerlink" title="1x01 题目简单分析"></a>1x01 题目简单分析</h3><p>先来看一下题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">import</span> hashlib<br><br>p = <span class="hljs-number">174523845247570741054964008585718839267</span><br>E = EllipticCurve(GF(p), [<span class="hljs-number">0</span>, <span class="hljs-number">486662</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>])<br>G=E(<span class="hljs-number">2247961404505753398791635923994899528</span>, <span class="hljs-number">108711418033303501028455466081133667288</span>)<br>n=G.order()<br>Cofactor = E.order() // n<br>f = <span class="hljs-number">128</span>+<span class="hljs-number">1</span><br>lambda_ = <span class="hljs-number">100</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">retbar</span>(<span class="hljs-params">P</span>):<br>    index = (f + <span class="hljs-number">1</span>) // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">int</span>(P[<span class="hljs-number">0</span>]) % (<span class="hljs-number">2</span> ^ index) + <span class="hljs-number">2</span> ^ index) % n<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">genkey</span>():<br>    w = randint(<span class="hljs-number">1</span>, n - <span class="hljs-number">1</span>)<br>    W = w * G<br>    <span class="hljs-keyword">return</span> (w, W)<br><br>B_pri_w, B_pub_W = genkey()<br><span class="hljs-built_in">print</span>(B_pub_W[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>])<br><br>LS = []<br>LR = []<br>BR = []<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Exchange</span>(<span class="hljs-params">i</span>):<br>    A_pri_w, A_pub_W = genkey()<br>    A_pri_r, A_pub_R = genkey()<br>    B_pri_r, B_pub_R = genkey()<br><br>    sa = (A_pri_r + retbar(A_pub_R) * A_pri_w) % n<br>    sb = (B_pri_r + retbar(B_pub_R) * B_pri_w) % n<br><br>    Ka = Cofactor * (B_pub_R + retbar(B_pub_R) * B_pub_W) * sa<br>    Kb = Cofactor * (A_pub_R + retbar(A_pub_R) * A_pub_W) * sb<br><br>    <span class="hljs-keyword">assert</span> (Ka == Kb)<br><br>    leakageS = sb &gt;&gt; lambda_<br>    leakageR = B_pri_r &gt;&gt; lambda_<br><br>    LS.append(leakageS), LR.append(leakageR)<br>    BR.append(B_pub_R[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>])<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>): Exchange(i)<br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LS=&quot;</span>, LS)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LR=&quot;</span>, LR)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;BR=&quot;</span>, BR)<br>H=hashlib.md5()<br>H.update(long_to_bytes(B_pri_w))<br>key=H.hexdigest().encode()<br>aes = AES.new(key,AES.MODE_ECB)<br><span class="hljs-built_in">print</span>(aes.encrypt(flag))<br><br></code></pre></td></tr></table></figure>

<p>乍一看，是一个之前做烂掉的ECDH的密钥交换协议，题目给出了 B 的公钥 $xG$，每一次密钥交换的 <code>sb,B_pri_r</code> 的高位，以及完整的 <code>B_pub_R</code> 的点，并且这边的线性关系式也很简单，$B_{pub,r}$ 给出后，$f(B_{pub,r})$ 也下能当与作为定值给出了。<br>$$<br>s_B&#x3D;B_{pri,r}+f(B_{pub,r})w_B<br>$$<br>为了方便展示，我们设 <code>LS,LR,BR</code> 分别记为为 $S,R,P$，其中 $S_{i}&#x3D;2^{100}s_i+x_i,R_i&#x3D;2^{100}r_i+y_i$，B 的固定私钥为 $w$。但实际上，<code>LS,LR</code> 中存放的其实是 $s_i$ 和 $r_i$，$x_i$ 和 $y_i$ 是右移被省略的内容。</p>
<p>那么上面的等式就可以写为：<br>$$<br>2^{100}s_i+x_i\equiv 2^{100}r_i+y_i-f(P)w \pmod n<br>$$<br>整理一下：<br>$$<br>x_i-y_i&#x3D;2^{100}(r_i-s_i)-f(P_i)w-k_in<br>$$<br>如果把 $x_i-y_i$ 当作整体，那就是：<br>$$<br>z_i&#x3D;2^{100}(r_i-s_i)-f(P_i)w-k_in<br>$$<br>设 $A_i&#x3D;r_i-s_i,B_i&#x3D;f(P_i)$，逻辑就出来了：<br>$$<br>z_i&#x3D;2^{100}A_i-wB_i-k_in<br>$$<br>所以构造矩阵如下：</p>
<p><img src="/2025/02/19/25Feb1/1.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<p>由于 $w$ 是 $128$ 位，$z$ 是 $100$ 位，那么需要乘平衡系数为 $\mathrm{diag}(2^{128},1,2^{28},2^{28},2^{28})$，然后LLL求解。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> hashlib<br><br>p = <span class="hljs-number">174523845247570741054964008585718839267</span><br>E = EllipticCurve(GF(p), [<span class="hljs-number">0</span>, <span class="hljs-number">486662</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>])<br>G=E(<span class="hljs-number">2247961404505753398791635923994899528</span>, <span class="hljs-number">108711418033303501028455466081133667288</span>)<br>n=G.order()<br>H=E(<span class="hljs-number">56142839234500040174315077324489019612</span>, <span class="hljs-number">143186177525574678948140963663687495447</span>)<br>LS= [<span class="hljs-number">12160779</span>, <span class="hljs-number">70634852</span>, <span class="hljs-number">136488679</span>, <span class="hljs-number">93279448</span>, <span class="hljs-number">51769705</span>, <span class="hljs-number">99408367</span>, <span class="hljs-number">94011238</span>, <span class="hljs-number">46255543</span>, <span class="hljs-number">136054320</span>, <span class="hljs-number">126842658</span>]<br>LR= [<span class="hljs-number">117789932</span>, <span class="hljs-number">85602320</span>, <span class="hljs-number">136131278</span>, <span class="hljs-number">85538539</span>, <span class="hljs-number">33115646</span>, <span class="hljs-number">15821127</span>, <span class="hljs-number">122073977</span>, <span class="hljs-number">40205177</span>, <span class="hljs-number">40509142</span>, <span class="hljs-number">121833940</span>]<br>BR= [(<span class="hljs-number">43128875586771925869851532015581155657</span>, <span class="hljs-number">108714366549720544283054523544596695631</span>), (<span class="hljs-number">166053844834143846221197595138208659402</span>, <span class="hljs-number">9389299139547698081250285594708260233</span>), (<span class="hljs-number">83160043610860066750778648875060399604</span>, <span class="hljs-number">160655466348101518011620435983302563358</span>), (<span class="hljs-number">18306927902958362110653472691194540502</span>, <span class="hljs-number">141566997533915037448387258113883793369</span>), (<span class="hljs-number">124719869188706449552550102421264489653</span>, <span class="hljs-number">111266021208672789646176095367638959348</span>), (<span class="hljs-number">62115794167524204331339724293036031704</span>, <span class="hljs-number">24476842210910012261000793337134128911</span>), (<span class="hljs-number">57017187772347635647835418540384524017</span>, <span class="hljs-number">149273114828279413180900590599119201032</span>), (<span class="hljs-number">141865913804035015431129030802262884043</span>, <span class="hljs-number">11219445710980991629921733217597739715</span>), (<span class="hljs-number">35994282847505215202392163277052083355</span>, <span class="hljs-number">5366425669461724819918825109516828913</span>), (<span class="hljs-number">72621299937996657982583201267406651177</span>, <span class="hljs-number">39297013522202608324989011761142875947</span>)]<br>C=<span class="hljs-string">b&#x27;\xd7\x8c\xf1Yx\x05W\x8ckq\xfdb\xd5\x81K&quot;\xe7q\x88\x18\xedq\x9f\xcap\x1cTB\xc9)\xe1c\xf4~\x7f\xccwh\xfe\t\xbf\xb2!\xde\x84\xeeO\x0f8\xd1\xac\xbc\x1c \xf0F\x0c\x00\xc9\xa7\x9e\x06\xdan&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">retbar</span>(<span class="hljs-params">P</span>):<br>    index = <span class="hljs-number">130</span>//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">int</span>(P[<span class="hljs-number">0</span>]) % (<span class="hljs-number">2</span> ** index) + <span class="hljs-number">2</span> ** index) % n<br>A=[<span class="hljs-number">2</span>**<span class="hljs-number">100</span>*(LS[i]-LR[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>B=[-retbar(BR[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>M=block_matrix([<br>    [identity_matrix(<span class="hljs-number">2</span>),matrix([A,B])],<br>    [zero_matrix(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),n*identity_matrix(<span class="hljs-number">10</span>)]<br>])<br>B=diagonal_matrix([<span class="hljs-number">2</span>**<span class="hljs-number">128</span>,<span class="hljs-number">1</span>]+[<span class="hljs-number">2</span>**<span class="hljs-number">28</span>]*<span class="hljs-number">10</span>)<br>M3L=((M*B).LLL())*(B**-<span class="hljs-number">1</span>)<br>vec=<span class="hljs-literal">None</span><br><span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> M3L:<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(vec[<span class="hljs-number">0</span>])==<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">break</span><br>x=<span class="hljs-built_in">int</span>(vec[<span class="hljs-number">0</span>]*vec[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;:032x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(x))<br><span class="hljs-comment">#00e2e6517a7ca4a6fdeeacca2fa34781</span><br></code></pre></td></tr></table></figure>

<p>这么做貌似确实没有什么问题，我们得到的参数的数量级也对，检查了一下行列式的值，也基本符合要求。但尝试用解出来的 $w$ 解密flag，竟然不对？！</p>
<h3 id="1x02-给-wG-的作用"><a href="#1x02-给-wG-的作用" class="headerlink" title="1x02 给 $wG$ 的作用"></a>1x02 给 $wG$ 的作用</h3><p>注意到题目给出了 $wG$ 的值，这个值我们还没有用到。</p>
<p>不管了，测一下它的代码，果然，发现了玄机：最终解出来的 $w$ 和实际的 $w_B$ 有 $±2^{33}$ 数量级的误差，这就导致目标向量其实并不是我们解出来的最短向量。（这个测试的代码可以自己写一个，这个题我是2月1日做的，测试的代码丢了就不发了，自己运行它题目中的代码，输出 $w_B$，再运行上面的解题代码，计算那两个值的差就OK）。</p>
<p>换句话说，$w_B$ 的低 $34$ 位我们不知道，这个值直接枚举太大了，考虑对未知部分进行bsgs，这样才能得到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">xbar=(x&gt;&gt;<span class="hljs-number">34</span>)&lt;&lt;<span class="hljs-number">34</span><br>K=H-xbar*G<br>D=<span class="hljs-built_in">dict</span>()<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br>P=E(<span class="hljs-number">0</span>)<br>G2=G*<span class="hljs-number">2</span>**<span class="hljs-number">17</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">17</span>)):<br>    D[P]=i<br>    P=P+G2<br>P=E(<span class="hljs-number">0</span>)<br>Ktmp=K<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">17</span>)):<br>    u=D.get(Ktmp,<span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">if</span>(u):<br>        v=i<br>        <span class="hljs-built_in">print</span>(u,v)<br>        <span class="hljs-keyword">break</span><br>    Ktmp-=G<br>x=xbar+(u&lt;&lt;<span class="hljs-number">17</span>)+v<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;:032x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(xbar))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;:032x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(x))<br><span class="hljs-comment">#60999 17385</span><br><span class="hljs-comment">#00e2e6517a7ca4a6fdeeacc800000000</span><br><span class="hljs-comment">#00e2e6517a7ca4a6fdeeacc9dc8e43e9</span><br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br>key=md5(long_to_bytes(x)).hexdigest().encode()<br>aes = AES.new(key,AES.MODE_ECB)<br><span class="hljs-built_in">print</span>(aes.decrypt(C))<br><span class="hljs-comment">#b&#x27;DASCTF&#123;C0ngRatul4tion5_On_y0ur_SuCc3ssfuL_S1gN_1n&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>看来有的时候测一下题目代码还是有必要的:)，签个到还真不容易呢。。。</p>
<h2 id="2-VNCTF2025-sh1kaku-fw"><a href="#2-VNCTF2025-sh1kaku-fw" class="headerlink" title="2.[VNCTF2025]sh1kaku_fw"></a>2.[VNCTF2025]sh1kaku_fw</h2><h3 id="2x01-题目代码"><a href="#2x01-题目代码" class="headerlink" title="2x01 题目代码"></a>2x01 题目代码</h3><p>又是一个LWE的题目，来看一下代码！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime <br><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> nextprime<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_handle_timeout</span>(<span class="hljs-params">signum, frame</span>):<br>    <span class="hljs-keyword">raise</span> TimeoutError(<span class="hljs-string">&#x27;function timeout&#x27;</span>)<br><br>timeout = <span class="hljs-number">450</span><br>signal.signal(signal.SIGALRM, _handle_timeout)<br>signal.alarm(timeout)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uniform_sample</span>(<span class="hljs-params">n, bound, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.randrange(-bound, bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">choice_sample</span>(<span class="hljs-params">n, L, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.choice(L) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>n = <span class="hljs-number">197</span><br>m = <span class="hljs-number">19700</span><br>q = getPrime(<span class="hljs-number">20</span>)<br><br>e_L = [random.randrange(<span class="hljs-number">0</span>, q-<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br>R_s = random.SystemRandom()<br>R_e = random.SystemRandom()<br><br>s = np.array(uniform_sample(n, q//<span class="hljs-number">2</span>, R_s))<br>e = np.array(choice_sample(m,  e_L, R_e))<br><br>seed = os.urandom(<span class="hljs-number">16</span>)<br>R_A = random<br>R_A.seed(seed)<br>A = np.array([uniform_sample(n, q, R_A) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m)])<br>b = (A.dot(s) + e) % q<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;q = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;e_L = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;seed.<span class="hljs-built_in">hex</span>() = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;b.tolist() = &#125;</span>&quot;</span>) <br>s_ = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Give me s: &quot;</span>)<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">if</span> s_ == <span class="hljs-built_in">str</span>(s.tolist()):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Congratulations! You have signed in successfully.&quot;</span>)<br>    <span class="hljs-built_in">print</span>((<span class="hljs-string">&#x27;flag&#123;success at_&#x27;</span>+<span class="hljs-built_in">str</span>(datetime.now())+<span class="hljs-string">&#x27;&#125;&#x27;</span>).replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>))<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry, you cannot sign in.&quot;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="2x02-题目分析"><a href="#2x02-题目分析" class="headerlink" title="2x02 题目分析"></a>2x02 题目分析</h3><p>可以看到题目中给出了一个 $197\times19700$ 的矩阵 $A$，模数 $q$，目标向量 $\vec b$ 和 误差 $e$ 可能的取值。</p>
<p>对于 $A\cdot \vec s+\vec e&#x3D;b$，如果把矩阵 $A$ 拆成 $19700$ 个行向量，那么每个行向量都有 $\vec a_i\cdot \vec s+e_i&#x3D;b$，也就是 $b-\vec a_i\cdot \vec s-e_i&#x3D;0$。</p>
<p>由于 $e_i$ 只有两种取值 $e_1,e_2$，那么必定有 $b-\vec a_i\cdot \vec s-e_1&#x3D;0$ 或者 $b-\vec a_i\cdot \vec s-e_2&#x3D;0$。既然两个成立一个，那乘起来就一定有<br>$$<br>(b-\vec a_i\cdot \vec s-e_1)(b-\vec a_i\cdot \vec s-e_2)&#x3D;0<br>$$<br>这个方法在25Jan1中解NTRU时也用到过。</p>
<p>既然这样，那么我们要做的就是展开 $\vec a_i\cdot \vec s$，然后这里可以构成一个关于 $s_0,s_1,…s_{196}$ 的多项式。由于是两个相乘，那就会有 $197$ 个一次项 $s_0\sim s_{196}$，$197$ 个平方项 $s_0^2\sim s_{196}^2$ 以及 $197\times98$ 个交叉项 $s_0s_1,…,s_{195}s_{196}$，共 $19700$ 项，将这些变量线性化，看作 $19700$ 个一次的未知数，那我们刚好可以利用题目给出的条件，构造 $19700$ 个线性方程组解这 $19700$ 个未知数。</p>
<p>根据推导，方程左边构造的对应的系数如下：</p>
<table>
<thead>
<tr>
<th>未知数</th>
<th>系数</th>
</tr>
</thead>
<tbody><tr>
<td>$s_i,\space0\le i\lt197$</td>
<td>$F_i&#x3D;-2ba_i+(e_1+e_2)a_i-e_1e_2$</td>
</tr>
<tr>
<td>$s_i^2,\space0\le i\lt197$</td>
<td>$G_i&#x3D;a_i^2$</td>
</tr>
<tr>
<td>$s_is_j,\space0\le i\lt j\lt197$</td>
<td>$H_{(i,j)}&#x3D;2a_ia_j$</td>
</tr>
</tbody></table>
<p>而方程的右边，就是没有 $s$ 的部分，那就是 $-b^2+b(e_1+e_2)-e_1e_2$。</p>
<p>这样，对于 $A$ 中的每个行向量，都可以构造一个这样的线性方程组：<br>$$<br>\sum_{i&#x3D;0}^{196}\left(F_is_i\right)+\sum_{i&#x3D;0}^{196}\left(G_is_i^2\right)+\sum_{i&#x3D;0}^{195}\sum_{j&#x3D;i+1}^{196}\left(H_{(i,j)}s_is_j\right)\equiv -b^2+b(e_1+e_2)-e_1e_2\pmod q<br>$$</p>
<h3 id="2x03-解题细节"><a href="#2x03-解题细节" class="headerlink" title="2x03 解题细节"></a>2x03 解题细节</h3><p>因为分析过程自己已经接触过，所以这一步很顺利，但为了保证正确性，先写个代码测一下：</p>
<p>数据生成代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime <br><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> nextprime<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uniform_sample</span>(<span class="hljs-params">n, bound, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.randrange(-bound, bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">choice_sample</span>(<span class="hljs-params">n, L, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.choice(L) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>n = <span class="hljs-number">8</span><br><span class="hljs-comment">#n=45</span><br><span class="hljs-comment">#n = 197</span><br>m = <span class="hljs-number">2</span>*n+((n-<span class="hljs-number">1</span>)*n)//<span class="hljs-number">2</span><br>q = getPrime(<span class="hljs-number">20</span>)<br><br>e_L = [random.randrange(<span class="hljs-number">0</span>, q-<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]<br>R_s = random.SystemRandom()<br>R_e = random.SystemRandom()<br><br>s = np.array(uniform_sample(n, q//<span class="hljs-number">2</span>, R_s))<br>e = np.array(choice_sample(m,  e_L, R_e))<br><br>seed = os.urandom(<span class="hljs-number">16</span>)<br>R_A = random<br>R_A.seed(seed)<br>A = np.array([uniform_sample(n, q, R_A) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m)])<br>b = (A.dot(s) + e) % q<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;q = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;e_L = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;seed.<span class="hljs-built_in">hex</span>() = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;b.tolist() = &#125;</span>&quot;</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;s.tolist() =&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uniform_sample</span>(<span class="hljs-params">n, bound, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.randrange(-bound, bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>n = <span class="hljs-number">8</span><br><span class="hljs-comment"># n = 197</span><br>m = <span class="hljs-number">2</span>*n+((n-<span class="hljs-number">1</span>)*n)//<span class="hljs-number">2</span><br><br>q = <span class="hljs-number">608383</span><br>eL = [<span class="hljs-number">98779</span>, <span class="hljs-number">155323</span>]<br>seed = <span class="hljs-number">0x73d8484f0895b86fc626b3d2a7c9ebd4</span><br>b = [<span class="hljs-number">28366</span>, <span class="hljs-number">263794</span>, <span class="hljs-number">516785</span>, <span class="hljs-number">140422</span>, <span class="hljs-number">94800</span>, <span class="hljs-number">135315</span>, <span class="hljs-number">574033</span>, <span class="hljs-number">522331</span>, <span class="hljs-number">292172</span>, <span class="hljs-number">341996</span>, <span class="hljs-number">601981</span>, <span class="hljs-number">546391</span>, <span class="hljs-number">85872</span>, <span class="hljs-number">492583</span>, <span class="hljs-number">30138</span>, <span class="hljs-number">3278</span>, <span class="hljs-number">301462</span>, <span class="hljs-number">411086</span>, <span class="hljs-number">151442</span>, <span class="hljs-number">247950</span>, <span class="hljs-number">580873</span>, <span class="hljs-number">468430</span>, <span class="hljs-number">132926</span>, <span class="hljs-number">247908</span>, <span class="hljs-number">174415</span>, <span class="hljs-number">465168</span>, <span class="hljs-number">382582</span>, <span class="hljs-number">16723</span>, <span class="hljs-number">540657</span>, <span class="hljs-number">158201</span>, <span class="hljs-number">259050</span>, <span class="hljs-number">350638</span>, <span class="hljs-number">193228</span>, <span class="hljs-number">521987</span>, <span class="hljs-number">429135</span>, <span class="hljs-number">554774</span>, <span class="hljs-number">273844</span>, <span class="hljs-number">281732</span>, <span class="hljs-number">591536</span>, <span class="hljs-number">267711</span>, <span class="hljs-number">605959</span>, <span class="hljs-number">582472</span>, <span class="hljs-number">491069</span>, <span class="hljs-number">140874</span>]<br>s_debug =[-<span class="hljs-number">63716</span>, -<span class="hljs-number">295937</span>, <span class="hljs-number">294401</span>, <span class="hljs-number">183923</span>, <span class="hljs-number">36465</span>, <span class="hljs-number">241521</span>, -<span class="hljs-number">43816</span>, <span class="hljs-number">217716</span>]<br>R_A = random<br>R_A.seed(long_to_bytes(seed))<br>A = np.array([uniform_sample(n, q, R_A) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m)]).tolist()<br>A=Matrix(GF(q),A)<br>vecb=vector(GF(q),b)<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br>STIME=datetime.now()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(STIME))<br>M=[]<br>y=[]<br>e1,e2=eL<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm_notebook(<span class="hljs-built_in">range</span>(m)):<br>    veca=A[i]<br>    bi=vecb[i]<br>    y.append(bi*bi-bi*(e1+e2)+e1*e2)<br>    vecline=[]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        vecline.append(<span class="hljs-number">2</span>*bi*A[i][j]-(e1+e2)*A[i][j])<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        vecline.append(A[i][j]**<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(j+<span class="hljs-number">1</span>,n):<br>            vecline.append(-<span class="hljs-number">2</span>*A[i][j]*A[i][k])<br>    M.append(vecline)<br>M=Matrix(GF(q),M)<br>y=vector(GF(q),y)<br>ans=M.solve_right(y)<br>s=(ans[:n])<br>s_debug=vector(GF(q),s_debug)<br><span class="hljs-built_in">print</span>(s)<br><span class="hljs-built_in">print</span>(s==s_debug)<br>TTIME=datetime.now()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(TTIME))<br><span class="hljs-built_in">print</span>(TTIME-STIME)<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">(544667, 312446, 294401, 183923, 36465, 241521, 564567, 217716)</span><br><span class="hljs-string">True</span><br><span class="hljs-string">2025-02-18 22:04:57.003973</span><br><span class="hljs-string">0:00:00.489371</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<p>在本机测了一组 $n&#x3D;8$ 和 $n&#x3D;20$ 都没有问题，看来算法是对的。那就直接上 $n&#x3D;197$，但这真是炸裂的存在啊！</p>
<p><img src="/2025/02/19/25Feb1/2.png" srcset="/img/loading.gif" lazyload alt="2"></p>
<p>因为自己windows用的是sage9.3，不妨在虚拟机上跑sage10.4：也就快了一丢丢而已。。。</p>
<p><img src="/2025/02/19/25Feb1/2b.png" srcset="/img/loading.gif" lazyload alt="2b"></p>
<p>然后自己问了下出题人dbt，最后一句话引起了我注意：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns">huangx6<span class="hljs-number">07087 2025</span>/<span class="hljs-number">2/10 17:47</span>:<span class="hljs-number">06</span><br>那个题建矩阵用的啥版本sage？<br><br>crypto-fwshikaku <span class="hljs-number">2025/2/10</span> <span class="hljs-number">17</span>:<span class="hljs-number">49</span>:<span class="hljs-number">51</span><br>你这复杂度吓人<br><br>crypto-fwshikaku <span class="hljs-number">2025/2/10</span> <span class="hljs-number">17</span>:<span class="hljs-number">50</span>:<span class="hljs-number">06</span><br><span class="hljs-number">10</span>.<span class="hljs-number">5</span>我感觉版本关系不大啊<br><br>crypto-fwshikaku <span class="hljs-number">2025/2/10</span> <span class="hljs-number">17</span>:<span class="hljs-number">50</span>:<span class="hljs-number">12</span><br>就python内置list啊<br><br></code></pre></td></tr></table></figure>

<p>终于，罪魁祸首找到了，原来sage模 $q$ 有限域太慢了！：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">R_A = random<br>R_A.seed(long_to_bytes(seed))<br>A = np.array([uniform_sample(n, q, R_A) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m)]).tolist()<br><span class="hljs-comment">#A=Matrix(GF(q),A)  #deleted</span><br><span class="hljs-comment">#vecb=vector(GF(q),b) #deleted</span><br>vecb=b.copy() <span class="hljs-comment">#new added</span><br></code></pre></td></tr></table></figure>

<p>速度果然快起来了，并且快了50倍，好家伙。。。</p>
<p><img src="/2025/02/19/25Feb1/2c.png" srcset="/img/loading.gif" lazyload alt="2c"></p>
<p>然而这么做爆内存了（虚拟机内存已经被我调到了 16GB），现在打CTF没高配还不行了是吧，是不是下一台电脑得买 64G 的了？</p>
<p><img src="/2025/02/19/25Feb1/2d.png" srcset="/img/loading.gif" lazyload alt="2d"></p>
<p>原来一个int在python中占28字节，那还得再优化一下，用numpy优化成 4 字节，这样内存爆得总算不那么夸张了。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">M=np.zeros((<span class="hljs-number">19700</span>,<span class="hljs-number">19700</span>),dtype=np.int32)<br>y=[<span class="hljs-number">0</span>]*m<br>e1,e2=eL<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(m)):<br>    veca=A[i]<br>    bi=vecb[i]<br>    y[i]=(bi*bi-bi*(e1+e2)+e1*e2)%q<br>    cur=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        M[i][cur]=(<span class="hljs-number">2</span>*bi*A[i][j]-(e1+e2)*A[i][j])%q<br>        cur+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        M[i][cur]=(A[i][j]**<span class="hljs-number">2</span>)%q<br>        cur+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(j+<span class="hljs-number">1</span>,n):<br>            M[i][cur]=(-<span class="hljs-number">2</span>*A[i][j]*A[i][k])%q<br>            cur+=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>不过这个在本地测试的时候，还是跑了 15 分钟，时间还是有点偏长了，原题只有7.5分钟，但解方程组作为正解，这还真不好简化掉。</p>
<p><img src="/2025/02/19/25Feb1/3.png" srcset="/img/loading.gif" lazyload alt="3"></p>
<p>注意到这里构造矩阵用了 7 分钟，考虑多进程加速：开 4 个进程同步写数据构造矩阵，这样构造矩阵的时间就缩短到了 2 分 20 秒。，耗时大概十二分半，那么我们还有三分钟时间接收和发送数据。由于这个题的交互量不大，因此这个时间也算是够了。</p>
<h3 id="2x04-exp"><a href="#2x04-exp" class="headerlink" title="2x04 exp"></a>2x04 exp</h3><p>最终完成的代码如下，4进程耗时 13 分钟，本地把时间调成了 900 秒做的，实在想不出还有什么优化方法了。。。（也看不到出题人的exp）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uniform_sample</span>(<span class="hljs-params">n, bound, SecureRandom</span>):<br>    <span class="hljs-keyword">return</span> [SecureRandom.randrange(-bound, bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>n = <span class="hljs-number">197</span><br>m = <span class="hljs-number">2</span>*n+((n-<span class="hljs-number">1</span>)*n)//<span class="hljs-number">2</span><br><span class="hljs-built_in">print</span>(m%<span class="hljs-number">4</span>)<br>sh=process([<span class="hljs-string">&#x27;sage&#x27;</span>,<span class="hljs-string">&#x27;sh1kaku_fw_server.sage&#x27;</span>])<br>sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>q = <span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>eL = <span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>seed=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br>sh.recvuntil(<span class="hljs-string">b&#x27;=&#x27;</span>)<br>b=<span class="hljs-built_in">eval</span>(sh.recvline(keepends=<span class="hljs-literal">False</span>))<br><span class="hljs-comment"># sh.recvuntil(b&#x27;=&#x27;)</span><br><span class="hljs-comment"># s_debug=eval(sh.recvline(keepends=False))</span><br>R_A = random<br>R_A.seed(<span class="hljs-built_in">bytes</span>.fromhex(seed))<br>A = np.array([uniform_sample(n, q, R_A) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m)]).tolist()<br>vecb=b.copy()<br>e1,e2=eL<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> multiprocessing <span class="hljs-keyword">as</span> mp<br><span class="hljs-keyword">from</span> multiprocessing.shared_memory <span class="hljs-keyword">import</span> SharedMemory<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(datetime.now())<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_to_k</span>(<span class="hljs-params">start_row, end_row, shm_name, shm_name2,shape,shape2, dtype</span>):<br>    <span class="hljs-comment"># 连接到共享内存</span><br>    existing_shm = SharedMemory(name=shm_name)<br>    existing_shm2 = SharedMemory(name=shm_name2)<br>    K = np.ndarray(shape, dtype=dtype, buffer=existing_shm.buf)<br>    B = np.ndarray(shape2, dtype=dtype, buffer=existing_shm2.buf)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm_notebook(<span class="hljs-built_in">range</span>(start_row,end_row)):<br>        bi=vecb[i]<br>        B[i]=(-bi*bi+bi*(e1+e2)-e1*e2)%q<br>        cur=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            K[i][cur]=(-<span class="hljs-number">2</span>*bi*A[i][j]+(e1+e2)*A[i][j])%q<br>            cur+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            K[i][cur]=(A[i][j]**<span class="hljs-number">2</span>)%q<br>            cur+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(j+<span class="hljs-number">1</span>,n):<br>                K[i][cur]=(<span class="hljs-number">2</span>*A[i][j]*A[i][k])%q<br>                cur+=<span class="hljs-number">1</span><br>    existing_shm.close() <br><br><br><span class="hljs-comment"># m=19700</span><br>num_processes = <span class="hljs-number">4</span><br>rows_per_process = m//<span class="hljs-number">4</span><br>shape = (m, m)<br>shape2= (m)<br>dtype = np.int32<br><br><span class="hljs-comment"># 创建共享内存</span><br>shm = SharedMemory(create=<span class="hljs-literal">True</span>, size=np.prod(shape) * np.dtype(dtype).itemsize)<br>shm2 = SharedMemory(create=<span class="hljs-literal">True</span>, size=np.prod(shape2) * np.dtype(dtype).itemsize)<br>K = np.ndarray(shape, dtype=dtype, buffer=shm.buf)<br>B = np.ndarray(shape2,dtype=dtype, buffer=shm2.buf)<br>processes = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_processes):<br>    start_row = i * rows_per_process<br>    end_row = start_row + rows_per_process<br>    p = mp.Process(target=write_to_k, args=(start_row, end_row, shm.name,shm2.name , shape, shape2, dtype))<br>    processes.append(p)<br>    p.start()<br><br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:<br>    p.join()<br><span class="hljs-built_in">print</span>(datetime.now())<br><br><span class="hljs-comment"># K=Matrix(GF(q),K)</span><br>M=Matrix(GF(q),K)<br>y=vector(GF(q),B)<br><span class="hljs-built_in">print</span>(datetime.now())<br>ans=M.solve_right(y)<br><span class="hljs-built_in">print</span>(datetime.now())<br>s2=(ans[:n])<br><span class="hljs-comment"># s_debug=vector(GF(q),s_debug)</span><br><span class="hljs-built_in">print</span>(s2)<br><span class="hljs-built_in">print</span>(datetime.now())<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>s=[Integer(s2[i]) <span class="hljs-keyword">if</span> s2[i]&lt;(q//<span class="hljs-number">2</span>) <span class="hljs-keyword">else</span> Integer(s2[i])-Integer(q) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s2))]<br>sh.sendline(<span class="hljs-built_in">str</span>(s).encode())<br><span class="hljs-built_in">print</span>(sh.recvall(timeout=<span class="hljs-number">8</span>).decode())<br><span class="hljs-built_in">print</span>(datetime.now())<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[x] Starting local process &#x27;/home/huangx607087/mambaforge/envs/sage/bin/sage&#x27;</span><br><span class="hljs-string">[+] Starting local process &#x27;/home/huangx607087/mambaforge/envs/sage/bin/sage&#x27;: pid 264101</span><br><span class="hljs-string">2025-02-19 09:15:47.298775</span><br><span class="hljs-string">2025-02-19 09:18:24.058344</span><br><span class="hljs-string">2025-02-19 09:22:58.562647</span><br><span class="hljs-string">2025-02-19 09:27:38.079743</span><br><span class="hljs-string">(413089, 182407, 281293, 514536, 416848, 162144, 111292, 567942, 105638, 320217, 597752, 148614, 475740, 104923, 168548, 419776, 331148, 480665, 27938, 144285, 536717, 23041, 407741, 535865, 292620, 296206, 263837, 411101, 178021, 459126, 582200, 356604, 260864, 107465, 198975, 603533, 614391, 399204, 281846, 656596, 336371, 43032, 469948, 485132, 292949, 551266, 481705, 627344, 294383, 16843, 351274, 499494, 400866, 16300, 397952, 418611, 329186, 171588, 126742, 35187, 227634, 47279, 558263, 274274, 176943, 213254, 136124, 458182, 207387, 110241, 561213, 643075, 37905, 81904, 541660, 591129, 252387, 442913, 59602, 291489, 16114, 33889, 42797, 178984, 170978, 125577, 44397, 84513, 42300, 190430, 131960, 171794, 438727, 575807, 132652, 483489, 537433, 148391, 295287, 611719, 433771, 511639, 429386, 96772, 149829, 391049, 203110, 134839, 614783, 116974, 563429, 625857, 583438, 296242, 287114, 567163, 311443, 300000, 319030, 157568, 340472, 574056, 58440, 504748, 659358, 158919, 513009, 450907, 372321, 505831, 160026, 450642, 598087, 385168, 351908, 608844, 282572, 345722, 528174, 464689, 476965, 642386, 235728, 498266, 341476, 84067, 177778, 590226, 41793, 286838, 98328, 123973, 354428, 101602, 362267, 6228, 519006, 43713, 314830, 37731, 479235, 46098, 147882, 455284, 472502, 508348, 408861, 509481, 50884, 609377, 5300, 625054, 139267, 436879, 7235, 344990, 388357, 645294, 314985, 497667, 663837, 527331, 13209, 457430, 574164, 460940, 171654, 38269, 124149, 583682, 216156, 356979, 571283, 665300, 411729, 172241, 320462)</span><br><span class="hljs-string">2025-02-19 09:27:38.080569</span><br><span class="hljs-string">[x] Receiving all data</span><br><span class="hljs-string">[x] Receiving all data: 1B</span><br><span class="hljs-string">[x] Receiving all data: 95B</span><br><span class="hljs-string">[+] Receiving all data: Done (95B)</span><br><span class="hljs-string">[*] Process &#x27;/home/huangx607087/mambaforge/envs/sage/bin/sage&#x27; stopped with exit code 0 (pid 264101)</span><br><span class="hljs-string"> Congratulations! You have signed in successfully.</span><br><span class="hljs-string">flag&#123;success_at_2025-02-19_09:27:38.082088&#125;</span><br><span class="hljs-string">2025-02-19 09:27:38.292391</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-N1CTF-junior-StrangeCurve"><a href="#3-N1CTF-junior-StrangeCurve" class="headerlink" title="3.[N1CTF_junior]StrangeCurve"></a>3.[N1CTF_junior]StrangeCurve</h2><h3 id="3x01-题目代码"><a href="#3x01-题目代码" class="headerlink" title="3x01 题目代码"></a>3x01 题目代码</h3><p>先看一眼题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br>FLAG = <span class="hljs-string">&#x27;flag&#123;&#x27;</span>+<span class="hljs-built_in">str</span>(uuid4())+<span class="hljs-string">&#x27;&#125;&#x27;</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(FLAG, <span class="hljs-built_in">str</span>):<br>    FLAG = FLAG.encode()<br><span class="hljs-comment"># print(FLAG)</span><br>ells = [*primes(<span class="hljs-number">3</span>, <span class="hljs-number">102</span>)] + [<span class="hljs-number">149</span>]<br>mxe = <span class="hljs-number">6</span><br>p = <span class="hljs-number">4</span> * prod(ells) - <span class="hljs-number">1</span><br>Fp = GF(p)<br>Fp2 = GF(p ** <span class="hljs-number">2</span>)<br>base = EllipticCurve(Fp2, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>])<br>privkey = [randint(<span class="hljs-number">0</span>, mxe) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> ells]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;testans&#x27;</span>+(<span class="hljs-built_in">str</span>(datetime.now())[<span class="hljs-number">11</span>:-<span class="hljs-number">7</span>]),<span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-built_in">str</span>(FLAG)+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    f.write(<span class="hljs-built_in">str</span>(privkey))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_montgomery</span>(<span class="hljs-params">E: EllipticCurve</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    Ep = E.change_ring(Fp).short_weierstrass_model()<br>    a, b = Fp(Ep.a4()), Fp(Ep.a6())<br>    P.&lt;x&gt; = PolynomialRing(Fp)<br>    r = (x^<span class="hljs-number">3</span> + a*x + b).roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    s = sqrt(<span class="hljs-number">3</span> * r^<span class="hljs-number">2</span> + a)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_square(s):<br>        s = -s<br>    A = <span class="hljs-number">3</span> * r / s<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(Fp(A))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = base<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">round</span> == r) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br><br>key = sha256(<span class="hljs-built_in">str</span>(privkey).encode()).digest()<br>cipher = AES.new(key = key, mode = AES.MODE_ECB)<br>ct = cipher.encrypt(pad(FLAG, <span class="hljs-number">16</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;This is your flag: <span class="hljs-subst">&#123;ct.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    r = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Get your Curve &gt;&quot;</span>).strip())<br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span> &lt;= r &lt; <span class="hljs-number">16</span><br>    E = action(privkey.copy(), r)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(to_montgomery(E)))<br><br></code></pre></td></tr></table></figure>

<h3 id="3x02-题目分析"><a href="#3x02-题目分析" class="headerlink" title="3x02 题目分析"></a>3x02 题目分析</h3><p>这个题目实现的是CSIDH的过程，但对CSIDH做了改动，我们注意action函数中的这一部分：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    P = E.lift_x(Fp.random_element())<br>    <span class="hljs-keyword">if</span> randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">round</span> == r) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p>我们会发现，在第round轮中，有一半概率使得CISDH中取的 $P$ 点的 $y$ 值在 $\mathbb F_{p^2}$ 而不是 $\mathbb F_{p}$ 上，回顾刚学过的 CISDH，这会导致在第round轮同源的方向变为原来的反方向。如果原来的密钥为 $[3,0,3,2,1,4]$，那么理想情况下，密钥的变化应当为：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">round</span> <span class="hljs-number">0</span>:[+,<span class="hljs-number">0</span>,+,+,+,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">1</span>:[+,<span class="hljs-number">0</span>,+,+,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">2</span>:[+,<span class="hljs-number">0</span>,+,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">3</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">sum</span>:   <span class="hljs-meta"> [3,0,3,2,1,4]</span><br></code></pre></td></tr></table></figure>

<p>假设round&#x3D;2时发生了翻转，那么实际情况就是</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">round</span> <span class="hljs-number">0</span>:[+,<span class="hljs-number">0</span>,+,+,+,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">1</span>:[+,<span class="hljs-number">0</span>,+,+,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">2</span>:[-,<span class="hljs-number">0</span>,-,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-]<br><span class="hljs-attribute">round</span> <span class="hljs-number">3</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">sum</span>:   <span class="hljs-meta"> [1,0,1,2,1,2]</span><br></code></pre></td></tr></table></figure>

<p>也就是说，如果发生翻转，那么第 $2$ 轮中，所有密钥值大于 $2$ 的私钥分量都会逆着走一步，这样和正确的密钥就相差了 $2$ 步。用更加严谨的说法就是：设正确的共享值为 $V$，那么第 $k$ 轮若发生翻转，则最终的共享值为 $[(\prod_{e_i&gt;k}\ell_i)^{-2}]V$ 。</p>
<p>但我们需要注意一个问题，由于在CSIDH中，对于不同的 $\ell$，$P$ 是随机取一个阶为 $\ell$ 的电脑点，因此对于每个 $\ell$，均有 $1&#x2F;\ell$ 的概率取到无穷远点 $\mathcal O$，这就会导致这一轮提前结束，但不会影响到最终结果（在 $\ell$ 较小的时候该情况出现较多）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">P *= (p + <span class="hljs-number">1</span>) // k<br><span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>    <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">continue</span><br>    Q = k // l * P<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure>

<p>这个过程也可以用下面的示意图表示，虽然最终结果一样，但轮数多了 1 轮。不过这种错误可以用多次取样规避。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">round</span> <span class="hljs-number">0</span>:[+,<span class="hljs-number">0</span>,+,+,+,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">1</span>:[+,<span class="hljs-number">0</span>,+,+,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">2</span>:[+,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">not</span> Q,contiune!<br><span class="hljs-attribute">round</span> <span class="hljs-number">3</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">round</span> <span class="hljs-number">4</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,+]<br><span class="hljs-attribute">sum</span>:   <span class="hljs-meta"> [3,0,3,2,1,4]</span><br></code></pre></td></tr></table></figure>

<p>但就算出现上面这种情况，由于私钥的最大值为 $6$，而题目允许输入的最大值为 $15$。经过测试发现，round的值几乎不会超过 $11$，因此可以先发送 $15$，获取正确的共享秘密值 （也就是蒙哥马利参数 $a_{15}$），然后多次测试 $5,4,3,2,1,0$，取次最大概率（因为最大概率是 $a_{15}$，该概率占到一半，测了一下，取样 $600$ 次基本就可以得到理想状态下的 $a_5,…,a_0$ 值）。</p>
<p>然后看了一下 <a target="_blank" rel="noopener" href="https://wleukocytec.github.io/2025/02/11/2025-n1junior-crypto/">出题人的博客</a>，他给出的做法是MITM，也就是中间相遇攻击，但没有给出进一步的细节。然后我就以为是从 $a_{15},a_{5},a_{4},a_{3}$ 走一个过程，然后再从 $a_{0},a_1,a_2,a_3$ 走一个过程，找相同的 $a_3$。考虑到私钥是 $0\sim6$ 的取值，且私钥长度为 $26$，因此可以赌每个值出现次数不超过 $5$，每一轮需要枚举 $83000$ 多次，耗时三小时，即使开四进程也要 40 分钟一轮，$1000$ 次的成功概率约为 $180$ 次。</p>
<h3 id="3x03-正确做法"><a href="#3x03-正确做法" class="headerlink" title="3x03 正确做法"></a>3x03 正确做法</h3><p>然后我问了一下出题人，结果发现是从 $a_{15}$ 出发，每次分别只考虑一个值。在理想情况下，设 $e&#x3D;[6,0,6,2,5,4,6,3]$，那么我们有：<br>$$<br>a_{5}&#x3D;[-2,0,-2,0,0,0,-2,0]a_{15}<br>$$<br>我们可以对半找一个中间值 $a_{5,15}$，满足：<br>$$<br>a_{5,15}&#x3D;[-2,0,-2,0,0,0,0,0]<br>$$<br>这样，从 $a_{15}$ 去逆推 $a_{5,15}$，只需要考虑后半部分，从 $a_5$ 去正推 $a_{5,15}$，只需要去推前半部分，两边枚举的复杂度就会降低到原来的一半。</p>
<p>可以直接利用他的action，把round设置成9999去正推。而逆推根据CSIDH的加三等价性，也就是 <code>[3+i for i in privkey]</code> ，那么可以把不需要逆推的部分设置成3，需要逆推的部分设置成1。对应代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">round</span> == r) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q,algorithm=<span class="hljs-string">&#x27;factored&#x27;</span>)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br><span class="hljs-keyword">for</span> ai <span class="hljs-keyword">in</span> [a5,a4,a3,a2,a1,a0]:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp K:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>    D=<span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        priv=[<span class="hljs-number">2</span>*<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]+[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span><br>        Et=action(priv.copy(),<span class="hljs-number">9999</span>,ai)<br>        x=to_montgomery(Et)<br>        D[x]=i<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        priv=[<span class="hljs-number">3</span>]*<span class="hljs-number">13</span>+[<span class="hljs-number">3</span>-<span class="hljs-number">2</span>*(<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j))) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]<br>        Et=action(priv.copy(),<span class="hljs-number">9999</span>,a15)<br>        at=to_montgomery(Et)<br>        x=D.get(at,<span class="hljs-number">0</span>)+D.get(p-at,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span>(x):<br>            <span class="hljs-built_in">print</span>(i,x)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p>但这样第二个步骤会走得很慢。因为priv中有很多 $3$，意味着程序至少要走三轮。</p>
<p>所以可以把action这么改，这样就反过来走了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">actioninv</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp): <span class="hljs-comment">#changed!</span><br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-comment">#complete the same as action below.</span><br></code></pre></td></tr></table></figure>



<h3 id="3x04-exp"><a href="#3x04-exp" class="headerlink" title="3x04 exp"></a>3x04 exp</h3><h4 id="3-4-1-初步exp"><a href="#3-4-1-初步exp" class="headerlink" title="3.4.1 初步exp"></a>3.4.1 初步exp</h4><p>根据3x03的分析，初步给出exp。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 1:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>sh=process([<span class="hljs-string">&#x27;sage&#x27;</span>,<span class="hljs-string">&#x27;task16.sage&#x27;</span>])<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>ciph=sh.recvline(keepends=<span class="hljs-literal">False</span>).strip()<br><span class="hljs-built_in">print</span>(ciph)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">x,tmz</span>):        <br>    D=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(tmz)):<br>        sh.recvuntil(<span class="hljs-string">b&#x27;&gt;&#x27;</span>)<br>        sh.sendline(<span class="hljs-built_in">str</span>(x).encode())<br>        res=sh.recvline(keepends=<span class="hljs-literal">False</span>).decode()<br>        D.append(<span class="hljs-built_in">eval</span>(res))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cmp</span>(<span class="hljs-params">arg</span>):<br>        <span class="hljs-keyword">return</span> -arg[<span class="hljs-number">1</span>]<br>    R=<span class="hljs-built_in">sorted</span>([(i,D.count(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(D)],key=cmp)<br>    <span class="hljs-keyword">return</span> R<br>D15=get(<span class="hljs-number">15</span>,<span class="hljs-number">50</span>)<br>D5=get(<span class="hljs-number">5</span>,<span class="hljs-number">600</span>)<br>D4=get(<span class="hljs-number">4</span>,<span class="hljs-number">600</span>)<br>D3=get(<span class="hljs-number">3</span>,<span class="hljs-number">600</span>)<br>D2=get(<span class="hljs-number">2</span>,<span class="hljs-number">600</span>)<br>D1=get(<span class="hljs-number">1</span>,<span class="hljs-number">600</span>)<br>D0=get(<span class="hljs-number">0</span>,<span class="hljs-number">600</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 2:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br><br>sh.close()<br>a15=D15[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>a5,a4,a3,a2,a1,a0=[arr[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> arr <span class="hljs-keyword">in</span> [D5,D4,D3,D2,D1,D0]]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a15=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a5=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a4=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a3=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a2=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a1=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a0=&#125;</span>&#x27;</span>)<br>ells = [*primes(<span class="hljs-number">3</span>, <span class="hljs-number">102</span>)] + [<span class="hljs-number">149</span>]<br>p = <span class="hljs-number">4</span> * prod(ells) - <span class="hljs-number">1</span><br>Fp=GF(p)<br>Fp2=GF(p**<span class="hljs-number">2</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_montgomery</span>(<span class="hljs-params">E: EllipticCurve</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    Ep = E.change_ring(Fp).short_weierstrass_model()<br>    a, b = Fp(Ep.a4()), Fp(Ep.a6())<br>    P.&lt;x&gt; = PolynomialRing(Fp)<br>    r = (x^<span class="hljs-number">3</span> + a*x + b).roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    s = sqrt(<span class="hljs-number">3</span> * r^<span class="hljs-number">2</span> + a)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_square(s):<br>        s = -s<br>    A = <span class="hljs-number">3</span> * r / s<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(Fp(A))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">round</span> == r) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q,algorithm=<span class="hljs-string">&#x27;factored&#x27;</span>)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">actioninv</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q,algorithm=<span class="hljs-string">&#x27;factored&#x27;</span>)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br><span class="hljs-keyword">for</span> ai <span class="hljs-keyword">in</span> [a5,a4,a3,a2,a1,a0]:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp K:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>    D=<span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        priv=[<span class="hljs-number">2</span>*<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]+[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span><br>        Et=action(priv.copy(),<span class="hljs-number">9999</span>,ai)<br>        x=to_montgomery(Et)<br>        D[x]=i<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        priv=[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span>+[<span class="hljs-number">2</span>*(<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j))) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]<br>        Et=actioninv(priv.copy(),<span class="hljs-number">9999</span>,a15)<br>        at=to_montgomery(Et)<br>        x=D.get(at,<span class="hljs-number">0</span>)+D.get(p-at,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span>(x):<br>            <span class="hljs-built_in">print</span>(i,x)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 3:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br></code></pre></td></tr></table></figure>

<p> 运行结果，耗时约 2h。</p>
<p><img src="/2025/02/19/25Feb1/12.png" srcset="/img/loading.gif" lazyload alt="12"></p>
<p>程序每一轮输出结果为：$(2,1056),(166,5160),(174,5164),(702,5548),(1022,5565),(2046,6079)$，那么整合这些结果和flag的密文，就可以解密了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">L=[(<span class="hljs-number">2</span>,<span class="hljs-number">1056</span>),(<span class="hljs-number">166</span>,<span class="hljs-number">5160</span>),(<span class="hljs-number">174</span>,<span class="hljs-number">5164</span>),(<span class="hljs-number">702</span>,<span class="hljs-number">5548</span>),(<span class="hljs-number">1022</span>,<span class="hljs-number">5565</span>),(<span class="hljs-number">2046</span>,<span class="hljs-number">6079</span>)]<br>A=[<span class="hljs-number">0</span>]*<span class="hljs-number">26</span><br><span class="hljs-keyword">for</span> l,r <span class="hljs-keyword">in</span> L:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>):<br>        A[<span class="hljs-number">13</span>+i]+=<span class="hljs-built_in">bool</span>(l&amp;(<span class="hljs-number">1</span>&lt;&lt;i))<br>        A[i]+=<span class="hljs-built_in">bool</span>(r&amp;(<span class="hljs-number">1</span>&lt;&lt;i))<br><br><span class="hljs-built_in">print</span>(A)<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> *<br><br>key = sha256(<span class="hljs-built_in">str</span>(A).encode()).digest()<br>ciph=<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;999a830887d47267ddb021c16136d055ac729f8f689ba382d471aa6721ebf0380c381f66123cd4042bb561f9ad2f0cdf&#x27;</span>)<br>aes=AES.new(key,AES.MODE_ECB)<br>msg=aes.decrypt(ciph)<br><span class="hljs-built_in">print</span>(unpad(msg,<span class="hljs-number">16</span>))<br><span class="hljs-comment">#flag&#123;5a8f0629-d05c-441b-9b4c-17caf1b7b838&#125;</span><br></code></pre></td></tr></table></figure>

<p>但我们可以看到上面的进度条：这一部分那我们建立字典还是消耗了非常长的时间。</p>
<h4 id="3-4-2-exp"><a href="#3-4-2-exp" class="headerlink" title="3.4.2 exp++"></a>3.4.2 exp++</h4><p>回顾刚才的思路不难注意到：$a_{15}$ 到 $a_{5}$ 的枚举中，我们所有私钥值 $e_i&gt;5$ 的部分会被标记出来；而 $a_{15}$ 和 $a_{4}$ 的枚举中，所有私钥值 $e_i&gt;4$ 的部分会被标记出来。后者标记的内容是完全包含前者的。因此可以进一步设置两个状态标记，消除掉不符合的情况，也就是 $a_4$ 的标记没有包含 $a_5$ 的情况，我们在这种情况下直接 <code>contiue</code> 掉，不做 <code>action</code> 以加速过程。</p>
<p>这一部分代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">Hpos,Hneg=<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>L=[]<br><span class="hljs-keyword">for</span> ai <span class="hljs-keyword">in</span> [a5,a4,a3,a2,a1,a0]:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp K:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>    D=<span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        <span class="hljs-keyword">if</span>((Hpos&amp;i)!=Hpos):<br>            <span class="hljs-keyword">continue</span><br>        priv=[<span class="hljs-number">2</span>*<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]+[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span><br>        Et=action(priv.copy(),<span class="hljs-number">9999</span>,ai)<br>        x=to_montgomery(Et)<br>        D[x]=i<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        <span class="hljs-keyword">if</span>((Hneg&amp;i)!=Hneg):<br>            <span class="hljs-keyword">continue</span><br>        priv=[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span>+[<span class="hljs-number">2</span>*(<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j))) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]<br>        Et=actioninv(priv.copy(),<span class="hljs-number">9999</span>,a15)<br>        at=to_montgomery(Et)<br>        x=D.get(at,<span class="hljs-number">0</span>)+D.get(p-at,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span>(x):<br>            <span class="hljs-built_in">print</span>(i,x)<br>            L.append((i,x))<br>            Hneg,Hpos=i,x<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p>那么完整的改善后的EXP就是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> *<br>STIME=datetime.now()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 1:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>sh=process([<span class="hljs-string">&#x27;sage&#x27;</span>,<span class="hljs-string">&#x27;task16.sage&#x27;</span>])<br>sh.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>ciph=sh.recvline(keepends=<span class="hljs-literal">False</span>).strip().decode()<br><span class="hljs-built_in">print</span>(ciph)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">x,tmz</span>):        <br>    D=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(tmz)):<br>        sh.recvuntil(<span class="hljs-string">b&#x27;&gt;&#x27;</span>)<br>        sh.sendline(<span class="hljs-built_in">str</span>(x).encode())<br>        res=sh.recvline(keepends=<span class="hljs-literal">False</span>).decode()<br>        D.append(<span class="hljs-built_in">eval</span>(res))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cmp</span>(<span class="hljs-params">arg</span>):<br>        <span class="hljs-keyword">return</span> -arg[<span class="hljs-number">1</span>]<br>    R=<span class="hljs-built_in">sorted</span>([(i,D.count(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(D)],key=cmp)<br>    <span class="hljs-keyword">return</span> R<br>D15=get(<span class="hljs-number">15</span>,<span class="hljs-number">50</span>)<br>D5=get(<span class="hljs-number">5</span>,<span class="hljs-number">600</span>)<br>D4=get(<span class="hljs-number">4</span>,<span class="hljs-number">600</span>)<br>D3=get(<span class="hljs-number">3</span>,<span class="hljs-number">600</span>)<br>D2=get(<span class="hljs-number">2</span>,<span class="hljs-number">600</span>)<br>D1=get(<span class="hljs-number">1</span>,<span class="hljs-number">600</span>)<br>D0=get(<span class="hljs-number">0</span>,<span class="hljs-number">600</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 2:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br><br>sh.close()<br>a15=D15[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>a5,a4,a3,a2,a1,a0=[arr[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> arr <span class="hljs-keyword">in</span> [D5,D4,D3,D2,D1,D0]]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a15=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a5=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a4=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a3=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a2=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a1=&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a0=&#125;</span>&#x27;</span>)<br>ells = [*primes(<span class="hljs-number">3</span>, <span class="hljs-number">102</span>)] + [<span class="hljs-number">149</span>]<br>p = <span class="hljs-number">4</span> * prod(ells) - <span class="hljs-number">1</span><br>Fp=GF(p)<br>Fp2=GF(p**<span class="hljs-number">2</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_montgomery</span>(<span class="hljs-params">E: EllipticCurve</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    Ep = E.change_ring(Fp).short_weierstrass_model()<br>    a, b = Fp(Ep.a4()), Fp(Ep.a6())<br>    P.&lt;x&gt; = PolynomialRing(Fp)<br>    r = (x^<span class="hljs-number">3</span> + a*x + b).roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    s = sqrt(<span class="hljs-number">3</span> * r^<span class="hljs-number">2</span> + a)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_square(s):<br>        s = -s<br>    A = <span class="hljs-number">3</span> * r / s<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(Fp(A))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">round</span> == r) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q,algorithm=<span class="hljs-string">&#x27;factored&#x27;</span>)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">actioninv</span>(<span class="hljs-params">key: <span class="hljs-built_in">list</span>, r: <span class="hljs-built_in">int</span>,ma2:<span class="hljs-built_in">int</span></span>) -&gt; EllipticCurve:<br>    E = EllipticCurve(Fp2,[<span class="hljs-number">0</span>,ma2,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">round</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">any</span>(key):<br>        E._order = (p + <span class="hljs-number">1</span>) ** <span class="hljs-number">2</span><br>        k = prod([l <span class="hljs-keyword">for</span> l, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ells, key) <span class="hljs-keyword">if</span> e &gt; <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            P = E.lift_x(Fp.random_element())<br>            <span class="hljs-keyword">if</span> randint(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) != (P.xy()[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Fp):<br>                <span class="hljs-keyword">break</span><br>        P *= (p + <span class="hljs-number">1</span>) // k<br>        <span class="hljs-keyword">for</span> i, (l, e) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ells, key)):<br>            <span class="hljs-keyword">if</span> e == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br>            Q = k // l * P<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Q:<br>                <span class="hljs-keyword">continue</span><br>            Q._order = l<br>            phi = E.isogeny(Q,algorithm=<span class="hljs-string">&#x27;factored&#x27;</span>)<br>            E, P = phi.codomain(), phi(P)<br>            key[i] -= <span class="hljs-number">1</span><br>            k //= l<br>        <span class="hljs-built_in">round</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br>Hpos,Hneg=<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>L=[]<br><span class="hljs-keyword">for</span> ai <span class="hljs-keyword">in</span> [a5,a4,a3,a2,a1,a0]:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp K:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>    D=<span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        <span class="hljs-keyword">if</span>((Hpos&amp;i)!=Hpos):<br>            <span class="hljs-keyword">continue</span><br>        priv=[<span class="hljs-number">2</span>*<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]+[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span><br>        Et=action(priv.copy(),<span class="hljs-number">9999</span>,ai)<br>        x=to_montgomery(Et)<br>        D[x]=i<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**<span class="hljs-number">13</span>)):<br>        <span class="hljs-keyword">if</span>((Hneg&amp;i)!=Hneg):<br>            <span class="hljs-keyword">continue</span><br>        priv=[<span class="hljs-number">0</span>]*<span class="hljs-number">13</span>+[<span class="hljs-number">2</span>*(<span class="hljs-built_in">bool</span>(i&amp;(<span class="hljs-number">1</span>&lt;&lt;j))) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>)]<br>        Et=actioninv(priv.copy(),<span class="hljs-number">9999</span>,a15)<br>        at=to_montgomery(Et)<br>        x=D.get(at,<span class="hljs-number">0</span>)+D.get(p-at,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span>(x):<br>            <span class="hljs-built_in">print</span>(i,x)<br>            L.append((i,x))<br>            Hneg,Hpos=i,x<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(ciph)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Timestamp 3:&#x27;</span>,<span class="hljs-built_in">str</span>(datetime.now()))<br>A=[<span class="hljs-number">0</span>]*<span class="hljs-number">26</span><br><span class="hljs-keyword">for</span> l,r <span class="hljs-keyword">in</span> L:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>):<br>        A[<span class="hljs-number">13</span>+i]+=<span class="hljs-built_in">bool</span>(l&amp;(<span class="hljs-number">1</span>&lt;&lt;i))<br>        A[i]+=<span class="hljs-built_in">bool</span>(r&amp;(<span class="hljs-number">1</span>&lt;&lt;i))<br><span class="hljs-built_in">print</span>(A)<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> *<br>key = sha256(<span class="hljs-built_in">str</span>(A).encode()).digest()<br>ciph=<span class="hljs-built_in">bytes</span>.fromhex(ciph)<br>aes=AES.new(key,AES.MODE_ECB)<br>msg=aes.decrypt(ciph)<br><span class="hljs-built_in">print</span>(unpad(msg,<span class="hljs-number">16</span>))<br><span class="hljs-built_in">print</span>(datetime.now()-STIME)<br></code></pre></td></tr></table></figure>

<p>运行结果，还是缩短了一点时间的：</p>
<p><img src="/2025/02/19/25Feb1/13.png" srcset="/img/loading.gif" lazyload alt="13"></p>
<h2 id="9-总结"><a href="#9-总结" class="headerlink" title="9.总结"></a>9.总结</h2><p>不得不说有的题是真的难:(，需要的trick一时半会还真想不到，得去多积累。。。</p>
<p>2，3两个题官方只给了思路，没有给exp，在这里也算自己写了一下exp，或许记忆更深刻吧</p>
<p>后面准备再看看鸡块佬的那个 New Year Ring 4中的trick，那也是个RLWE的多项式构造，虽然他博客里面讲得很清楚了，但不自己写代码实现以下，或者测一下，可能还是不会太理解。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTFSeason4/" class="category-chain-item">CTFSeason4</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ExpLog/" class="print-no-link">#ExpLog</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>25Feb1</div>
      <div>http://example.com/2025/02/19/25Feb1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>huangx607087</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月19日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/21/Hgame25/" title="Hgame25">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Hgame25</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/01/ECCNotes4/" title="ECCNotes4">
                        <span class="hidden-mobile">ECCNotes4</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
